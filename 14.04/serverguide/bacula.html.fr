<!DOCTYPE html>
<html lang=fr>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Bacula</title>
<link rel="stylesheet" type="text/css" href="fr.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guide du serveur Ubuntu">Guide du serveur Ubuntu</a> » <a class="trail" href="backups.html" title="Sauvegardes">Sauvegardes</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups-shellscripts-rotation.html" title="Rotation des archives">Précédent</a><a class="nextlinks-next" href="virtualization.html" title="Virtualisation">Suivant</a>
</div>
<div class="hgroup"><h1 class="title">Bacula</h1></div>
<div class="region">
<div class="contents"><p class="para"><span class="app application">Bacula</span> est un programme de sauvegarde qui vous permet de sauvegarder, restaurer et vérifier les données de votre réseau. Il existe des clients Bacula pour Linux, Windows et Mac OS X - ce qui en fait une solution multi-plateforme à l'échelle de votre réseau.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="bacula.html#bacula-overview" title="Aperçu">Aperçu</a></li>
<li class="links"><a class="xref" href="bacula.html#bacula-installation" title="Installation">Installation</a></li>
<li class="links"><a class="xref" href="bacula.html#bacula-configuration" title="Configuration">Configuration</a></li>
<li class="links"><a class="xref" href="bacula.html#bacula-localhost-backup" title="Sauvegarde de l'hôte local">Sauvegarde de l'hôte local</a></li>
<li class="links"><a class="xref" href="bacula.html#bacula-resources" title="Ressources">Ressources</a></li>
</ul></div>
<div class="sect2 sect" id="bacula-overview"><div class="inner">
<div class="hgroup"><h2 class="title">Aperçu</h2></div>
<div class="region"><div class="contents">
<p class="para"><span class="app application">Bacula</span> est constitué de plusieurs composants et services utilisés pour gérer les fichiers à sauvegarder et les emplacements de sauvegarde :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula Director :</span> service contrôlant les opérations de sauvegarde, de restauration, de vérification et d'archivage.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula Console :</span> application permettant de communiquer avec Bacula Director. Il existe trois versions de la Console :</p>
	  <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist"><p class="para">Version en mode texte via ligne de commande.</p></li>
<li class="list itemizedlist"><p class="para">Version graphique GTK+ (Gnome).</p></li>
<li class="list itemizedlist"><p class="para">Version graphique wxWidgets.</p></li>
</ul></div>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula File :</span> connu aussi sous le nom <span class="app application">Bacula Client</span>. Cette application est installée sur les machines à sauvegarder et se charge d'envoyer les données demandées par Bacula Director.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula Storage :</span> programmes effectuant le stockage et la récupération des données sur le support physique.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula Catalog :</span> responsable de la mise à jour des index de fichiers et des bases de données de volumes pour tous les fichiers sauvegardés, permettant ainsi la localisation et la restauration rapide des fichiers archivés. Bacula Catalog prend en charge trois types de bases de données : MySQL, PostgreSQL et SQLite.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="app application">Bacula Monitor :</span> permet le contrôle de Director et des démons File et Storage. Actuellement, Monitor est uniquement disponible avec une interface GTK+.</p>
        </li>
</ul></div>
<p class="para">Ces services et applications peuvent être lancées sur de multiples serveurs et clients, ou ils peuvent être installés sur une machine, dans le cas de la sauvegarde d'un seul disque ou volume.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="bacula-installation"><div class="inner">
<div class="hgroup"><h2 class="title">Installation</h2></div>
<div class="region"><div class="contents">
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Si vous utilisez MySQL ou PostgreSQL comme base de données, vous devriez déjà avoir les services disponibles. <span class="app application">Bacula</span> ne les installera pas pour vous.</p>
      </div></div></div></div>
<p class="para">Il existe plusieurs paquets contenant les différents composants de <span class="app application">Bacula</span>. Pour installer Bacula, saisissez dans un terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install bacula</span>
</pre></div>
<p class="para">L'installation par défaut du paquet <span class="app application">bacula</span> va utiliser une base de données <span class="app application">MySQL</span> pour le catalogue. Si vous voulez utiliser SQLite ou PostgreSQL pour le catalogue, installez respectivement <span class="app application">bacula-director-sqlite3</span> ou <span class="app application">bacula-director-pgsql</span>.</p>
<p class="para">Pendant le processus d'installation, il vous sera demandé de fournir des informations d'authentification pour <span class="em emphasis">l'administrateur</span> de la base de données et le <span class="em emphasis">propriétaire</span> de la base de données <span class="em emphasis">bacula</span>. L'administrateur de la base de données devra avoir les droits adéquats pour créer une base de données, consultez <a class="xref" href="mysql.html" title="MySQL">MySQL</a> pour plus d'informations.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="bacula-configuration"><div class="inner">
<div class="hgroup"><h2 class="title">Configuration</h2></div>
<div class="region"><div class="contents">
<p class="para">Les fichiers de configuration de <span class="app application">Bacula</span> sont consitués de <span class="em emphasis">ressources</span> comprenant des <span class="em emphasis">directives</span> entre accolades <span class="quote">« {} »</span>. Chaque composant Bacula possède un fichier individuel dans le répertoire <span class="file filename">/etc/bacula</span>.</p>
<p class="para">Les divers composant de <span class="app application">Bacula</span> doivent s'autoriser mutuellement. Ceci est effectué par la directive <span class="em emphasis">password</span>. Par exemple, le mot de passe de la ressource <span class="em emphasis">Storage</span> dans le fichier <span class="file filename">/etc/bacula/bacula-dir.conf</span> doit correspondre à celui de la ressource <span class="em emphasis">Director</span> dans le fichier <span class="file filename">/etc/bacula/bacula-sd.conf</span>.</p>
<p class="para">Par défaut, la tâche de sauvegarde appelée <span class="em emphasis">Client1</span> est configurée pour archiver le catalogue <span class="app application">Bacula</span>. Si vous envisagez d'utiliser le serveur pour sauvegarder plus d'un client, vous devriez changer le nom de cette tâche pour quelque chose de plus descriptif. Pour changer ce nom, modifiez le fichier <span class="file filename">/etc/bacula/bacula-dir.conf</span>:</p>
<div class="code"><pre class="contents ">#
# Definition des principales tâches nocturnes de sauvegardes
# Par défaut, cette tâche sauvegardera sur le disque dans
Job {
  Name = "BackupServer"
  JobDefs = "DefaultJob"
  Write Bootstrap = "/var/lib/bacula/Client1.bsr"
}
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">L'exemple ci-dessus remplace le nom de la tâche par <span class="em emphasis">BackupServer</span>, correspondant au nom d'hôte de la machine. Remplacez <span class="quote">« BackupServer »</span> avec votre nom d'hôte adéquat, ou un autre nom descriptif.</p>
      </div></div></div></div>
<p class="para">La <span class="em emphasis">Console</span> peut être utilisée pour interroger le <span class="em emphasis">Director</span> sur des tâches, mais pour utiliser la Console avec un utilisateur <span class="em emphasis">non root</span>, celui-ci doit être dans le groupe <span class="em emphasis">bacula</span>. Pour ajouter un utilisateur au groupe bacula, saisissez la commande suivante dans un terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo adduser $username bacula</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Remplacez <span class="em emphasis">$username</span> par le véritable nom d'utilisateur. De plus, si vous ajoutez l'utilisateur courant au groupe, vous devrez vous déconnecter puis vous reconnecter pour que les nouvelles autorisations prennent effet.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="bacula-localhost-backup"><div class="inner">
<div class="hgroup"><h2 class="title">Sauvegarde de l'hôte local</h2></div>
<div class="region"><div class="contents">
<p class="para">Cette section décrit la façon de sauvegarder les répertoires spécifiés pour un unique hôte sur un lecteur de bande local.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Tout d'abord, le périphérique de <span class="em emphasis">stockage</span> doit être configuré. Ajoutez, dans le fichier <span class="file filename">/etc/bacula/bacula-sd.conf</span> :</p>
<div class="code"><pre class="contents ">Device {
  Name = "Tape Drive"
  Device Type = tape
  Media Type = DDS-4
  Archive Device = /dev/st0
  Hardware end of medium = No;
  AutomaticMount = yes; # when device opened, read it
  AlwaysOpen = Yes;
  RemovableMedia = yes;
  RandomAccess = no;
  Alert Command = "sh -c 'tapeinfo -f %c | grep TapeAlert'"
}
</pre></div>
          <p class="para">Cet exemple est pour un lecteur de bande <span class="em emphasis">DDS-4</span>. Réglez le <span class="quote">« Type de Média »</span> et <span class="quote">«  Périphérique d'archivage »</span> pour correspondre à votre matériel.</p>
          <p class="para">Vous pouvez également dé-commenter l'un des autres exemples du fichier.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Après avoir modifié <span class="file filename">/etc/bacula/bacula-sd.conf</span>, le démon <span class="app application">Storage</span> devra être redémarré :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo service bacula-sd restart</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">Ajoutez maintenant une ressource <span class="em emphasis">Storage</span> dans <span class="file filename">/etc/bacula/bacula-dir.conf</span> pour utiliser le nouveau périphérique :</p>
<div class="code"><pre class="contents "># Definition of "Tape Drive" storage device
Storage {
  Name = TapeDrive
  # Do not use "localhost" here    
  Address = backupserver               # N.B. Use a fully qualified name here
  SDPort = 9103
  Password = "Cv70F6pf1t6pBopT4vQOnigDrR0v3LT3Cgkiyjc"
  Device = "Tape Drive"
  Media Type = tape
}
</pre></div>
          <p class="para">La directive <span class="em emphasis">Address</span> doit être le nom de domaine complet (FQDN) du serveur. Remplacez <span class="em emphasis">backupserver</span> par le véritable nom d'hôte.</p>
          <p class="para">Assurez-vous également que la directive <span class="em emphasis">Password</span> corresponde à celle dans <span class="file filename">/etc/bacula/bacula-sd.conf</span>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Créez une nouvelle ressource <span class="em emphasis">FileSet</span> (jeu de fichiers) qui définira les répertoires à sauvegarder, en ajoutant :</p>
<div class="code"><pre class="contents "># FileSet de sauvegarde de l'hôte local.
FileSet {
  Name = "LocalhostFiles"
  Include {
    Options {
      signature = MD5
      compression=GZIP
    }
    File = /etc
    File = /home
  }
}
</pre></div>
          <p class="para">
          This <span class="em emphasis">FileSet</span> will backup the <span class="file filename">/etc</span> and 
          <span class="file filename">/home</span> directories.  The <span class="em emphasis">Options</span> resource directives 
          configure the FileSet to create an MD5 signature for each file backed up, and to compress the files using GZIP.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">Ensuite, créez une nouvelle ressource <span class="em emphasis">Schedule</span> (planification) pour la tâche de sauvegarde :</p>
<div class="code"><pre class="contents "># Planification de la sauvegarde de l'hôte local -- quotidienne.
Schedule {
  Name = "LocalhostDaily"
  Run = Full daily at 00:01
}
</pre></div>
          <p class="para">La tâche sera lancée chaque jour à 00 h 01. Il y a bien d'autres possibilités de planification.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Pour terminer, créez la <span class="em emphasis">tâche</span> :</p>
<div class="code"><pre class="contents "># sauvegarde de l'hôte local.
Job {
  Name = "LocalhostBackup"
  JobDefs = "DefaultJob"
  Enabled = yes
  Level = Full
  FileSet = "LocalhostFiles"
  Schedule = "LocalhostDaily"
  Storage = TapeDrive
  Write Bootstrap = "/var/lib/bacula/LocalhostBackup.bsr"
}  
</pre></div>
          <p class="para">La tâche effectuera une sauvegarde <span class="em emphasis">complète</span> (« Full ») quotidienne sur bande.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Chaque bande utilisée devra posséder un <span class="em emphasis">label</span>. Si la bande courante n'en possède pas, <span class="app application">Bacula</span> vous enverra un courriel vous en informant. Pour donner un label à une bande en utilisant la <span class="app application">Console</span>, saisissez la commande suivante dans un terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">bconsole</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">À l'invite de commande de la console de Bacula saisissez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">label</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">Il vous sera alors demandé de choisir la ressource de <span class="em emphasis">stockage</span> (« storage ») :</p>
<div class="screen"><pre class="contents "><span class="output computeroutput">
Automatically selected Catalog: MyCatalog
Using Catalog "MyCatalog"
The defined Storage resources are:
     1: File
     2: TapeDrive
Select Storage resource (1-2):<span class="input userinput">2</span>
</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">Saisissez le nouveau nom du <span class="em emphasis">volume</span> :</p>
<div class="screen"><pre class="contents "><span class="output computeroutput">
Enter new Volume name: <span class="input userinput">dimanche</span>
Defined Pools:
     1: Default
     2: Scratch</span>
</pre></div>
          <p class="para">Remplacez <span class="em emphasis">dimanche</span> par l'étiquette désirée.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Sélectionnez maintenant le <span class="em emphasis">pool</span>:</p>
<div class="screen"><pre class="contents "><span class="output computeroutput">
Select the Pool (1-2): <span class="input userinput">1</span>
Connecting to Storage daemon TapeDrive at backupserver:9103 ...
Sending label command for Volume "Sunday" Slot 0 ...
</span>
</pre></div>
        </li>
</ul></div>
<p class="para">Félicitations, vous venez de configurer <span class="em emphasis">Bacula</span> pour sauvegarder l'hôte local vers un lecteur de bande connecté.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="bacula-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Ressources</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Pour plus d'options de configuration de <span class="em emphasis">Bacula</span>, veuillez-vous référer au <a href="http://www.bacula.org/en/rel-manual/index.html" class="ulink" title="http://www.bacula.org/en/rel-manual/index.html">Manuel de l'utilisateur Bacula</a> (en anglais)</p>
        </li>
<li class="list itemizedlist">
          <p class="para">La <a href="http://www.bacula.org/" class="ulink" title="http://www.bacula.org/">page d'accueil de Bacula</a> contient les dernières informations et versions de développement.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Référez-vous également à la page <a href="https://help.ubuntu.com/community/Bacula" class="ulink" title="https://help.ubuntu.com/community/Bacula">du wiki anglophone d'Ubuntu sur Bacula</a>.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups-shellscripts-rotation.html" title="Rotation des archives">Précédent</a><a class="nextlinks-next" href="virtualization.html" title="Virtualisation">Suivant</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
