<!DOCTYPE html>
<html lang=fr>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>DRBD</title>
<link rel="stylesheet" type="text/css" href="fr.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guide du serveur Ubuntu">Guide du serveur Ubuntu</a> » <a class="trail" href="clustering.html" title="Clustering">Clustering</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="clustering.html" title="Clustering">Précédent</a><a class="nextlinks-next" href="vpn.html" title="VPN">Suivant</a>
</div>
<div class="hgroup"><h1 class="title">DRBD</h1></div>
<div class="region">
<div class="contents">
<p class="para">Un périphérique en mode bloc répliqué et distribué (Distributed Replicated Block Device ou DRBD) met en miroir des périphériques en mode bloc entre plusieurs hôtes. La réplication est transparente pour les autres applications sur les systèmes hôtes. N'importe quel périphérique en mode bloc (disque dur, partitions, périphériques RAID, volumes logiques, etc.) peut être mis en miroir.</p>
<p class="para">Pour commencer à utiliser <span class="app application">drbd</span>, installez d'abord les paquets nécessaires. Dans un terminal, écrivez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install drbd8-utils</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
      <p class="para">Si vous utilisez le <span class="em emphasis">noyau virtuel</span> comme une partie d'une machine virtuelle, vous devrez compiler manuellement le module <span class="app application">drbd</span>. Il serait plus simple d'installer le paquet <span class="app application">linux-server</span> dans la machine virtuelle.</p>
    </div></div></div></div>
<p class="para">Cette section décrit le paramétrage de <span class="app application">drbd</span> pour répliquer une partition <span class="file filename">/srv</span> distincte, avec un système de fichiers <span class="app application">ext3</span>, entre deux hôtes. La taille de partition n'est pas importante, mais les deux partitions doivent être de la même taille.</p>
</div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="drbd.html#drbd-configuration" title="Configuration">Configuration</a></li>
<li class="links"><a class="xref" href="drbd.html#drbd-testing" title="Tests">Tests</a></li>
<li class="links"><a class="xref" href="drbd.html#drbd-references" title="Références">Références</a></li>
</ul></div>
<div class="sect2 sect" id="drbd-configuration"><div class="inner">
<div class="hgroup"><h2 class="title">Configuration</h2></div>
<div class="region"><div class="contents">
<p class="para">Les deux hôtes dans cet exemple s'appellent <span class="em emphasis">drbd01</span> et <span class="em emphasis">drbd02</span>. Ils auront besoin d'avoir la résolution d'adresse configurée soit par DNS, soit à l'aide du fichier <span class="file filename">/etc/hosts</span>. Consultez <a class="xref" href="dns.html" title="Service de nom de domaine (DNS)">Service de nom de domaine (DNS)</a> pour de plus amples informations.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Pour configurer <span class="app application">drbd</span>, modifiez sur le premier hôte le fichier <span class="file filename">/etc/drbd.conf</span> :</p>

<div class="code"><pre class="contents ">global { usage-count no; }
common { syncer { rate 100M; } }
resource r0 {
        protocol C;
        startup {
                wfc-timeout  15;
                degr-wfc-timeout 60;
        }
        net {
                cram-hmac-alg sha1;
                shared-secret "secret";
        }
        on drbd01 {
                device /dev/drbd0;
                disk /dev/sdb1;
                address 192.168.0.1:7788;
                meta-disk internal;
        }
        on drbd02 {
                device /dev/drbd0;
                disk /dev/sdb1;
                address 192.168.0.2:7788;
                meta-disk internal;
        }
} 
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Beaucoup d'autres options sont disponibles dans le fichier <span class="file filename">/etc/drbd.conf</span> mais leur valeur par défaut seront suffisantes pour cet exemple.</p>
          </div></div></div></div>
        </li>
<li class="list itemizedlist">
   
          <p class="para">Copiez maintenant <span class="file filename">/etc/drbd.conf</span> vers le deuxième hôte :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">scp /etc/drbd.conf drbd02:~</span>
</pre></div>

        </li>
<li class="list itemizedlist">

          <p class="para">Déplacez ensuite le fichier dans <span class="file filename">/etc</span> sur <span class="em emphasis">drbd02</span> :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mv drbd.conf /etc/</span>
</pre></div>

        </li>
<li class="list itemizedlist">

          <p class="para">Initialisez maintenant les méta données de stockage en utilisant <span class="app application">drbdadm</span>. Exécutez la commande suivante sur les deux serveurs :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo drbdadm create-md r0</span>
</pre></div>
          
        </li>
<li class="list itemizedlist">

          <p class="para">Lancez ensuite le démon <span class="app application">drbd</span> sur les deux hôtes :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo service drbd start</span>
</pre></div>

        </li>
<li class="list itemizedlist">

          <p class="para">Sur l'hôte <span class="em emphasis">drbd01</span>, ou celui que vous souhaitez définir comme hôte primaire, saisissez :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo drbdadm -- --overwrite-data-of-peer primary all</span>
</pre></div>

        </li>
<li class="list itemizedlist">

          <p class="para">Après l'exécution de la commande ci-dessus, les données commenceront à se synchroniser avec l'hôte secondaire. Pour suivre la progression, saisissez la commande suivante dans <span class="em emphasis">drbd02</span> :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">watch -n1 cat /proc/drbd</span>
</pre></div>

          <p class="para">Appuyez sur <span class="em emphasis">Ctrl+c</span> pour arrêter la commande « watch ».</p>

        </li>
<li class="list itemizedlist">

      <p class="para">Pour finir, ajoutez un système de fichier à <span class="file filename">/dev/drbd0</span> et montez-le :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mkfs.ext3 /dev/drbd0</span>
<span class="cmd command">sudo mount /dev/drbd0 /srv</span>
</pre></div>

        </li>
</ul></div>
</div></div>
</div></div>
<div class="sect2 sect" id="drbd-testing"><div class="inner">
<div class="hgroup"><h2 class="title">Tests</h2></div>
<div class="region"><div class="contents">
<p class="para">Pour vérifier que les données se synchronisent réellement entre les deux hôtes, copiez quelques fichiers de <span class="em emphasis">drbd01</span>, l'hôte primaire, sur <span class="file filename">/srv</span> :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo cp -r /etc/default /srv</span>
</pre></div>
<p class="para">Démontez ensuite <span class="file filename">/srv</span> :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo umount /srv</span>
</pre></div>
<p class="para"><span class="em emphasis">Rétrogradez</span> le serveur <span class="em emphasis">primaire</span> au rôle <span class="em emphasis">secondaire</span> :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo drbdadm secondary r0</span>
</pre></div>
<p class="para">Maintenant, sur le serveur <span class="em emphasis">secondaire</span>, le <span class="em emphasis">promouvoir</span> au rôle <span class="em emphasis">principal</span> :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo drbdadm primary r0</span>
</pre></div>
<p class="para">Enfin, montez la partition :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount /dev/drbd0 /srv</span>
</pre></div>
<p class="para">Avec <span class="em emphasis">ls</span>, vous devriez voir le fichier <span class="file filename">/srv/default</span> copié depuis l'ancien hôte <span class="em emphasis">primaire</span> <span class="em emphasis">drbd01</span>.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="drbd-references"><div class="inner">
<div class="hgroup"><h2 class="title">Références</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Pour plus d'informations sur <span class="app application">DRBD</span>, consultez le <a href="http://www.drbd.org/" class="ulink" title="http://www.drbd.org/">site Web DRBD</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          The <a href="http://manpages.ubuntu.com/manpages/trusty/en/man5/drbd.conf.5.html" class="ulink" title="http://manpages.ubuntu.com/manpages/trusty/en/man5/drbd.conf.5.html">drbd.conf man page</a> contains
          details on the options not covered in this guide.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          Also, see the <a href="http://manpages.ubuntu.com/manpages/trusty/en/man8/drbdadm.8.html" class="ulink" title="http://manpages.ubuntu.com/manpages/trusty/en/man8/drbdadm.8.html">drbdadm man page</a>.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">La page <a href="https://help.ubuntu.com/community/DRBD" class="ulink" title="https://help.ubuntu.com/community/DRBD">du wiki anglophone d'Ubuntu sur DRBD</a> contient également des informations complémentaires.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="clustering.html" title="Clustering">Précédent</a><a class="nextlinks-next" href="vpn.html" title="VPN">Suivant</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
