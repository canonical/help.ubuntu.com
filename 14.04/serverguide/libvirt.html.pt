<!DOCTYPE html>
<html lang=pt>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>libvirt</title>
<link rel="stylesheet" type="text/css" href="pt.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guia do Servidor Ubuntu">Guia do Servidor Ubuntu</a> » <a class="trail" href="virtualization.html" title="Virtualization">Virtualization</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="virtualization.html" title="Virtualization">Anterior</a><a class="nextlinks-next" href="cloud-images-and-uvtool.html" title="Cloud images and uvtool">Seguinte</a>
</div>
<div class="hgroup"><h1 class="title">libvirt</h1></div>
<div class="region">
<div class="contents">
<p class="para">A biblioteca <span class="app application">libvirt</span> permite interagir as diversas tecnologias de virtualização. Antes de começar a usar a biblioteca <span class="app application">libvirt</span>, convém saber se o seu hardware suporta as extensões de virtualização exigidas pelo <span class="app application">KVM</span>. Digite o seguinte num terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">kvm-ok</span>
</pre></div>
<p class="para">A message will be printed informing you if your CPU
    <span class="em emphasis">does</span> or <span class="em emphasis">does not</span> support
    hardware virtualization.</p>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
      <p class="para">On many computers with processors supporting hardware assisted
      virtualization, it is necessary to activate an option in the BIOS to
      enable it.</p>
    </div></div></div></div>
</div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="libvirt.html#virtual-networking" title="Rede virtual">Rede virtual</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-installation" title="Instalação">Instalação</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-virt-install" title="virt-install">virt-install</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-virt-clone" title="virt-clone">virt-clone</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-management" title="Gestão de máquinas virtuais">Gestão de máquinas virtuais</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-virt-viewer" title="Visualizador de máquinas virtuais">Visualizador de máquinas virtuais</a></li>
<li class="links"><a class="xref" href="libvirt.html#libvirt-resources" title="Recursos">Recursos</a></li>
</ul></div>
<div class="sect2 sect" id="virtual-networking"><div class="inner">
<div class="hgroup"><h2 class="title">Rede virtual</h2></div>
<div class="region"><div class="contents">
<p class="para">There are a few different ways to allow a virtual machine access
      to the external network. The default virtual network configuration
      includes <span class="em emphasis">bridging</span> and <span class="em emphasis">iptables</span>
      rules implementing <span class="em emphasis">usermode</span> networking, which uses
      the SLIRP protocol. Traffic is NATed through the host interface to the
      outside network.</p>
<p class="para">To enable external hosts to directly access services on virtual
      machines a different type of <span class="em emphasis">bridge</span> than the
      default needs to be configured. This allows the virtual interfaces to
      connect to the outside network through the physical interface, making
      them appear as normal hosts to the rest of the network.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="libvirt-installation"><div class="inner">
<div class="hgroup"><h2 class="title">Instalação</h2></div>
<div class="region"><div class="contents">
<p class="para">Para instalar os pacotes necessários, digite o seguinte num terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install qemu-kvm libvirt-bin</span>
</pre></div>
<p class="para">Depois de instalar o <span class="app application">libvirt-bin</span>, o utilizador que gere as máquinas virtuais terá que ser adicionado ao grupo <span class="em emphasis">libvirtd</span>. Isto irá dar-lhe acesso às opções avançadas de rede.</p>
<p class="para">Digite o seguinte num terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo adduser $USER libvirtd</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Se o utilizador escolhido for o utilizador actual, deverá terminar a sessão corrente e iniciar uma nova sessão, para que a lista de membros do grupo seja actualizada.</p>
      </div></div></div></div>
<p class="para">You are now ready to install a <span class="em emphasis">Guest</span>
      operating system. Installing a virtual machine follows the same process
      as installing the operating system directly on the hardware. You either
      need a way to automate the installation, or a keyboard and monitor will
      need to be attached to the physical machine.</p>
<p class="para">In the case of virtual machines a Graphical User Interface (GUI)
      is analogous to using a physical keyboard and mouse. Instead of
      installing a GUI the <span class="app application">virt-viewer</span> application
      can be used to connect to a virtual machine's console using
      <span class="app application">VNC</span>. See <a class="xref" href="libvirt.html#libvirt-virt-viewer" title="Visualizador de máquinas virtuais">Visualizador de máquinas virtuais</a> for more information.</p>
<p class="para">There are several ways to automate the Ubuntu installation
      process, for example using preseeds, kickstart, etc. Refer to the <a href="https://help.ubuntu.com/14.04/installation-guide/" class="ulink" title="https://help.ubuntu.com/14.04/installation-guide/">Ubuntu
      Installation Guide</a> for details.</p>
<p class="para">Yet another way to install an Ubuntu virtual machine is to use
      <span class="app application">uvtool</span>.
      This application, available as of 14.04, allows you to set up
      specific VM options, execute custom post-install scripts, etc. For
      details see <a class="xref" href="cloud-images-and-uvtool.html" title="Cloud images and uvtool">Cloud images and uvtool</a>.</p>
<p class="para">Libvirt can also be configured work with
      <span class="app application">Xen</span>. For details, see the Xen Ubuntu
      community page referenced below.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="libvirt-virt-install"><div class="inner">
<div class="hgroup"><h2 class="title">virt-install</h2></div>
<div class="region"><div class="contents">
<p class="para"><span class="app application">virt-install</span> is part of the
      <span class="app application">virtinst</span> package. To install it, from a
      terminal prompt enter:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install virtinst</span>
</pre></div>
<p class="para">Quando usa o <span class="app application">virt-install</span>, tem várias opções disponíveis. Por exemplo:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo virt-install -n web_devel -r 256 \
--disk path=/var/lib/libvirt/images/web_devel.img,bus=virtio,size=4 -c \
ubuntu-14.04-server-i386.iso --network network=default,model=virtio \
--graphics vnc,listen=0.0.0.0 --noautoconsole -v</span>
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-n web_devel:</span> o nome da nova máquina virtual será <span class="em emphasis">web_devel</span> neste exemplo.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-r 256:</span> specifies the amount of memory
          the virtual machine will use in megabytes.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">--disk
          path=/var/lib/libvirt/images/web_devel.img,size=4:</span>
          indicates the path to the virtual disk which can be a file,
          partition, or logical volume. In this example a file named
          <span class="file filename">web_devel.img</span> in the /var/lib/libvirt/images/
          directory, with a size of 4 gigabytes, and using
          <span class="em emphasis">virtio</span> for the disk bus.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-c ubuntu-14.04-server-i386.iso:</span> file to be used as a virtual
          CDROM. The file can be either an ISO file or the path to the host's
          CDROM device.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">--network</span> provides details related to the
          VM's network interface. Here the <span class="em emphasis">default</span>
          network is used, and the interface model is configured for
          <span class="em emphasis">virtio</span>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">--graphics vnc,listen=0.0.0.0:</span> exports
          the guest's virtual console using VNC and on all host interfaces.
          Typically servers have no GUI, so another GUI based computer on the
          Local Area Network (LAN) can connect via VNC to complete the
          installation.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">--noautoconsole:</span> não irá ligar-se automaticamente à consola da máquina virtual.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-v:</span> creates a fully virtualized
          guest.</p>
        </li>
</ul></div>
<p class="para">After launching <span class="app application">virt-install</span> you can
      connect to the virtual machine's console either locally using a GUI (if
      your server has a GUI), or via a remote VNC client from a GUI-based
      computer.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="libvirt-virt-clone"><div class="inner">
<div class="hgroup"><h2 class="title">virt-clone</h2></div>
<div class="region"><div class="contents">
<p class="para">A aplicação <span class="app application">virt-clone</span> permite-lhe copiar uma máquina virtual para outra. Por exemplo:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo virt-clone -o web_devel -n database_devel -f /path/to/database_devel.img \
--connect=qemu:///system</span> 
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-o:</span> máquina virtual original.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-n:</span> nome da nova máquina virtual.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">-f:</span> caminho para o ficheiro, volume lógico ou partição que vai ser usado pela nova máquina virtual.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">--connect:</span> specifies which hypervisor to
          connect to.</p>
        </li>
</ul></div>
<p class="para">Pode também usar a opção <span class="em emphasis">-d</span> ou <span class="em emphasis">--debug</span> para detectar problemas no <span class="app application">virt-clone</span>.</p>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Substitua <span class="em emphasis">web_devel</span> e <span class="em emphasis">database_devel</span> por nomes de máquinas virtuais mais apropriados.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="libvirt-management"><div class="inner">
<div class="hgroup"><h2 class="title">Gestão de máquinas virtuais</h2></div>
<div class="region">
<div class="contents"></div>
<div class="sect3 sect" id="virsh"><div class="inner">
<div class="hgroup"><h3 class="title">virsh</h3></div>
<div class="region"><div class="contents">
<p class="para">Existem diversos utilitários que permitem gerir máquinas virtuais e o <span class="app application">libvirt</span>. O utilitário <span class="app application">virsh</span> pode ser usado a partir da linha de comandos. Vejamos alguns exemplos:</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
            <p class="para">Para listar as máquinas virtuais em execução:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system list</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">Para iniciar uma máquina virtual:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system start web_devel</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">Similarmente, para iniciar uma máquina virtual no arranque do sistema:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system autostart web_devel</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">Para reiniciar uma máquina virtual:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system reboot web_devel</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">O <span class="em emphasis">estado</span> das máquinas virtuais pode ser guardado num ficheiro, para ser recuperado mais tarde. O seguinte irá guardar o estado da máquina virtual num ficheiro nomeado de acordo com a data:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system save web_devel web_devel-022708.state</span>
</pre></div>

            <p class="para">Depois de guardado o estado, a execução da máquina virtual termina.</p>
          </li>
<li class="list itemizedlist">
            <p class="para">Uma máquina virtual gravada pode ser recuperada usando:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system restore web_devel-022708.state</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">Para desligar uma máquina virtual:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system shutdown web_devel</span>
</pre></div>
          </li>
<li class="list itemizedlist">
            <p class="para">Podemos montar um dispositivo CD-ROM numa máquina virtual da seguinte forma:</p>

            <div class="screen"><pre class="contents "><span class="cmd command">virsh -c qemu:///system attach-disk web_devel /dev/cdrom /media/cdrom</span>
</pre></div>
          </li>
</ul></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Nos exemplos acima, substitua <span class="em emphasis">web_devel</span> pelo nome da sua máquina virtual e <span class="file filename">web_devel-022708.state</span> por um nome de ficheiro mais descritivo.</p>
        </div></div></div></div>
</div></div>
</div></div>
<div class="sect3 sect" id="virt-manager"><div class="inner">
<div class="hgroup"><h3 class="title">Gestor de máquinas virtuais</h3></div>
<div class="region"><div class="contents">
<p class="para">O pacote <span class="app application">virt-manager</span> contém um utilitário gráfico que permite gerir máquinas virtuais locais e remotas. Para instalar o virt-manager, digite:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install virt-manager</span>
</pre></div>
<p class="para">Como o <span class="app application">virt-manager</span> necessita de um ambiente gráfico, recomenda-se que o instale numa estação de trabalho ou numa máquina de teste e não num servidor de produção. Para se ligar ao serviço local <span class="app application">libvirt</span>, digite:</p>
<div class="screen"><pre class="contents "><span class="cmd command">virt-manager -c qemu:///system</span>
</pre></div>
<p class="para">Pode ligar-se a um serviço <span class="app application">libvirt</span> remoto digitando o seguinte num terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">virt-manager -c qemu+ssh://virtnode1.mydomain.com/system</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">O exemplo acima assume que a ligação <span class="app application">SSH</span> entre o sistema de gestão e o sistema virtnode1.mydomain.com já foi configurada e usa chaves SSH para a autenticação. As <span class="em emphasis">chaves</span> SSH são necessárias porque o <span class="app application">libvirt</span> envia o pedido de senha para outro processo. Para mais detalhes sobre a configuração do <span class="app application">SSH</span>, veja <a class="xref" href="openssh-server.html" title="Servidor OpenSSH">Servidor OpenSSH</a>.</p>
        </div></div></div></div>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="libvirt-virt-viewer"><div class="inner">
<div class="hgroup"><h2 class="title">Visualizador de máquinas virtuais</h2></div>
<div class="region"><div class="contents">
<p class="para">A aplicação <span class="app application">virt-viewer</span> permite-lhe estabelecer uma ligação com a consola da máquina virtual. Esta aplicação não exige um interface gráfico (GUI) para comunicar com a máquina virtual.</p>
<p class="para">Para instalar o <span class="app application">virt-viewer</span>, digite o seguinte num terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install virt-viewer</span>
</pre></div>
<p class="para">Depois de instalar e executar a máquina virtual, pode ligar-se a ela usando:</p>
<div class="screen"><pre class="contents "><span class="cmd command">virt-viewer -c qemu:///system web_devel</span>
</pre></div>
<p class="para">Tal como o <span class="app application">virt-manager</span>, o <span class="app application">virt-viewer</span> também permite ligações a anfitriões remotos através do <span class="em emphasis">SSH</span> com autenticação de chave:</p>
<div class="screen"><pre class="contents "><span class="cmd command">virt-viewer -c qemu+ssh://virtnode1.mydomain.com/system web_devel</span>
</pre></div>
<p class="para">Não se esqueça de substituir <span class="em emphasis">web_devel</span> por um nome de máquina virtual mais apropriado.</p>
<p class="para">If configured to use a <span class="em emphasis">bridged</span> network
      interface you can also setup <span class="app application">SSH</span> access to
      the virtual machine.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="libvirt-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Recursos</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">See the <a href="http://www.linux-kvm.org/" class="ulink" title="http://www.linux-kvm.org/">KVM</a>
          home page for more details.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Para mais informações sobre o <span class="app application">libvirt</span>, veja o <a href="http://libvirt.org/" class="ulink" title="http://libvirt.org/">sítio do libvirt</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">The <a href="http://virt-manager.org/" class="ulink" title="http://virt-manager.org/">Virtual
          Machine Manager</a> site has more information on
          <span class="app application">virt-manager</span> development.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Se desejar conversar sobre as tecnologias de virtualização do Ubuntu, dirija-se também ao canal de IRC <span class="em emphasis">#ubuntu-virt</span>, no <a href="http://freenode.net/" class="ulink" title="http://freenode.net/">freenode</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Another good resource is the <a href="https://help.ubuntu.com/community/KVM" class="ulink" title="https://help.ubuntu.com/community/KVM">Ubuntu Wiki KVM</a>
          page.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">For information on Xen, including using Xen with libvirt,
          please see the <a href="https://help.ubuntu.com/community/Xen" class="ulink" title="https://help.ubuntu.com/community/Xen">Ubuntu Wiki Xen</a>
          page.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="virtualization.html" title="Virtualization">Anterior</a><a class="nextlinks-next" href="cloud-images-and-uvtool.html" title="Cloud images and uvtool">Seguinte</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
