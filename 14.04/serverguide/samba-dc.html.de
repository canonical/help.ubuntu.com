<!DOCTYPE html>
<html lang=de>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>As a Domain Controller</title>
<link rel="stylesheet" type="text/css" href="de.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Ubuntu–Server-Leitfaden">Ubuntu–Server-Leitfaden</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Securing File and Print Server">Zurück</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Active Directory Integration">Weiter</a>
</div>
<div class="hgroup"><h1 class="title">As a Domain Controller</h1></div>
<div class="region">
<div class="contents"><p class="para">Auch wenn es nicht als Active Directory Primary Domain Controller (PDC) fungieren kann, kann ein Samba-Server so konfiguriert werden, dass er als ein Windows NT4-kompatibler Domänen-Kontroller erscheint. Ein großer Vorteil dieser Konfiguration ist die Möglichkeit, Benutzer- und Maschinen-Berechtigungsnachweise zentral zu verwalten. Samba kann mehrere Backends benutzen, um die Benutzerinformationen zu speichern.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-dc.html#samba-pdc-smbpasswd" title="Primärer Domänen-Kontroller">Primärer Domänen-Kontroller</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-bdc-smbpasswd" title="Backup-Domänen-Kontroller">Backup-Domänen-Kontroller</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-dc-resources" title="Quellen">Quellen</a></li>
</ul></div>
<div class="sect2 sect" id="samba-pdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Primärer Domänen-Kontroller</h2></div>
<div class="region"><div class="contents">
<p class="para">Dieser Abschnitt behandelt die Einrichtung Sambas als einen primären Domänen-Kontroller (Primary Domain Controller, PDC) über das standardmäßige smbpasswd-Backend.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

          <p class="para">Installieren Sie zuerst Samba und <span class="app application">libpam-smbpass</span>, um die Benutzerkonten zu synchronisieren, indem Sie folgenden Befehl in eine Befehlszeile eingeben:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install samba libpam-smbpass</span>
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Anschließend konfigurieren Sie Samba, indem Sie <span class="file filename">/etc/samba/smb.conf</span> bearbeiten. Der <span class="em emphasis">security</span>-Betriebszustand sollte auf <span class="em emphasis">user</span> gesetzt werden und <span class="em emphasis">workgroup</span> sollte sich am Aufbau Ihrer Organisation orientieren:</p>

<div class="code"><pre class="contents ">   workgroup = BEISPIEL
   ...
  security = user
</pre></div>

        </li>
<li class="steps">

          <p class="para">
          In the commented <span class="quote">»Domains«</span> section add or uncomment the following (the last line has been split to fit the format of this document):
          </p>

<div class="code"><pre class="contents ">   domain logons = yes
   logon path = \\%N\%U\profile
   logon drive = H:
   logon home = \\%N\%U
   logon script = logon.cmd
   add machine script = sudo /usr/sbin/useradd -N -g machines -c Machine -d
         /var/lib/samba -s /bin/false %u
</pre></div>

          <div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Wenn Sie <span class="em emphasis">Roaming Profiles</span> nicht benutzen wollen, lassen Sie die <span class="em emphasis">logon home</span>- und <span class="em emphasis">logon path</span>-Option auskommentiert.</p>
          </div></div></div></div>
 
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">domain logons:</span> stellt den netlogon-Dienst zu Verfügung, welcher Samba als Domänen-Kontroller agieren lässt.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon path:</span> legt das Windows-Profil des Benutzers in deren persönlichen Ordner. Es ist auch möglich, eine <span class="em emphasis">[profiles]</span>-Freigabe einzurichten und alle Profile in einem einzigen Ordner zu verwalten.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon drive:</span> legt den lokalen Pfad des persönlichen Ordners fest.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon home:</span> legt den Ort des persönlichen Ordners fest.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon script:</span> Bestimmt ein Skript, das lokal ausgeführt werden soll, wenn sich ein Benutzer anmeldet. Das Skript muss in der <span class="em emphasis">[netlogon]</span>-Freigabe liegen.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">add machine script:</span> ein Skript, welches automatisch den <span class="em emphasis">Machine Trust Account</span> anlegt, welcher von der Workstation benötigt wird um der Domäne beizutreten.</p>
              <p class="para">Die Gruppe <span class="em emphasis">machines</span> in diesem Beispiel wird mit Hilfe des <span class="app application">addgroup</span>-Werkzeugs erstellt, weitere Informationen finden Sie unter <a class="xref" href="user-management.html#adding-deleting-users" title="Benutzer hinzufügen und löschen">Benutzer hinzufügen und löschen</a>.</p>

            </li>
</ul></div>

        </li>
<li class="steps">
     
          <p class="para">Kommentieren Sie die <span class="em emphasis">[homes]</span>-Freigabe aus, damit <span class="em emphasis">logon home</span> abgebildet wird.</p>

<div class="code"><pre class="contents ">[homes]
   comment = Home Directories
   browseable = no
   read only = no
   create mask = 0700
   directory mask = 0700
   valid users = %S
</pre></div>

        </li>
<li class="steps">

          <p class="para">Für die Konfiguration als Domänen-Kontroller muss eine <span class="em emphasis">[netlogon]</span>-Freigabe eingerichtet werden. Um die Freigabe zu aktivieren, entfernen Sie die Kommentarzeichen um folgende Zeilen:</p>

<div class="code"><pre class="contents ">[netlogon]
   comment = Network Logon Service
   path = /srv/samba/netlogon
   guest ok = yes
   read only = yes
   share modes = no
</pre></div>

          <div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Der originale <span class="em emphasis">netlogon</span>-Freigabepfad ist <span class="file filename">/home/samba/netlogon</span>, aber nach dem Filesystem Hierarchy Standard (FHS) ist (<a href="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM" class="ulink" title="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM">/srv</a>) der richtige Ort für vom System bereitgestellte seitenspezifische Inhalte.</p>
          </div></div></div></div>

        </li>
<li class="steps">

          <p class="para">Erstellen Sie nun den Ordner <span class="file filename">netlogon</span> und eine (vorübergehend) leere Skript-Datei <span class="file filename">logon.cmd</span>:</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mkdir -p /srv/samba/netlogon</span>
<span class="cmd command">sudo touch /srv/samba/netlogon/logon.cmd</span>
</pre></div>
 
          <p class="para">Sie können jeden normalen Windows-Logon-Skriptbefehl in <span class="file filename">logon.cmd</span> eingeben, um die Umgebung Ihres Clients anzupassen.</p>

        </li>
<li class="steps">

          <p class="para">
          Restart Samba to enable the new domain controller:
          </p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">
          Lastly, there are a few additional commands needed to setup the appropriate rights.
          </p>

          <p class="para">Da <span class="em emphasis">root</span> standardmäßig deaktiviert ist, muss, damit eine Workstation der Domäne beitreten kann, eine Systemgruppe auf die Windows-<span class="em emphasis">Domain Admins</span>-Gruppe abgebildet werden. Geben Sie folgendes in eine Befehlszeile ein, um das <span class="app application">net</span>-Werkzeug dafür zu verwenden:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo net groupmap add ntgroup="Domain Admins" unixgroup=sysadmin rid=512 type=d</span>
</pre></div>

          <div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Ändern Sie <span class="em emphasis">sysadmin</span> in die Gruppe, die Sie hierfür verwenden möchten. Der Benutzer, welcher der Domäne beitreten möchte, muss ebenfalls Mitglied der <span class="em emphasis">sysadmin</span>-Gruppe sein und ebenso Mitglied der Systemgruppe <span class="em emphasis">admin</span>. Die <span class="em emphasis">admin-Gruppe erlaubt die Benutzung von sudo.</span></p>
            <p class="para">
            If the user does not have Samba credentials yet, you can add them with
            the <span class="app application">smbpasswd</span> utility, change the <span class="em emphasis">sysadmin</span> username appropriately:

<div class="screen"><pre class="contents "><span class="cmd command">sudo smbpasswd -a sysadmin</span>
</pre></div>
            </p>
          </div></div></div></div>

          <p class="para">Darüber hinaus müssen der <span class="em emphasis">Domain-Administratoren</span>-Gruppe explizite Rechte gewährt werden, damit das <span class="em emphasis">Skript zum Hinzufügen einer Maschine</span> (und andere administrative Funktionen) funktioniert. Dies wird erreicht, indem man folgendes ausführt:</p>
<div class="screen"><pre class="contents "><span class="cmd command">net rpc rights grant -U sysadmin "EXAMPLE\Domain Admins" SeMachineAccountPrivilege \
SePrintOperatorPrivilege SeAddUsersPrivilege SeDiskOperatorPrivilege \
SeRemoteShutdownPrivilege</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Sie sollten jetzt dazu in der Lage sein, mit Windows-Clients der Domäne auf die gleiche Art und Weise beizutreten, wie einer NT4-Domäne auf einem Windows-Server.</p>

        </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-bdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Backup-Domänen-Kontroller</h2></div>
<div class="region"><div class="contents">
<p class="para">Mit einem Primary Domain Controller (PDC) im Netzwerk ist es von Vorteil, ebenso einen Backup Domain Controller (BDC) haben. Das erlaubt es Clients sich zu authentifizieren, auch in Fällen wo der PDC nicht erreichbar ist.</p>
<p class="para">Wenn Sie Samba als BDC einrichten wollen, benötigen Sie eine Methode, um die Kontodaten mit dem PDC zu synchronisieren. Es gibt mehrere Wege das zu bewerkstelligen, mit <span class="app application">scp</span>, <span class="app application">rsync</span> oder <span class="app application">LDAP</span> als <span class="em emphasis">passdb-Backend</span>.</p>
<p class="para">LDAP ist der stabilste Weg um Kontodaten zu synchronisieren, weil beide Domänen-Kontroller die gleichen Informationen in Echtzeit benutzen können. Allerdings dürfte das Aufsetzen eines LDAP-Servers für eine kleine Anzahl an Benutzern und Rechnerkonten zu aufwändig sein. Weitere Informationen finden Sie unter <a class="xref" href="samba-ldap.html" title="Samba und LDAP">Samba und LDAP</a>.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
   
          <p class="para">Installieren Sie zunächst <span class="app application">samba</span> und <span class="app application">libpam-smbpass</span>. Geben Sie folgendes in eine Befehlszeile ein:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install samba libpam-smbpass</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Bearbeiten Sie anschließend <span class="file filename">/etc/samba/smb.conf</span> und entfernen Sie die Kommentarzeichen um Folgendes in <span class="em emphasis">[global]</span>:</p>

<div class="code"><pre class="contents ">   workgroup = BEISPIEL
   ...
  security = user
</pre></div>

        </li>
<li class="steps">

        <p class="para">In dem auskommentierten <span class="em emphasis">Domains</span>-Abschnitt fügen Sie folgendes hinzu oder entfernen die umgebenden Kommentarzeichen:</p>

<div class="code"><pre class="contents ">   domain logons = yes
   domain master = no
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Stellen Sie sicher, dass ein Benutzer Leserechte für die Dateien in <span class="file filename">/var/lib/samba</span> besitzt. Um z.B. den Benutzern der <span class="em emphasis">admin-Gruppe zu erlauben, auf die Dateien mit scp zuzugreifen. Geben Sie hierzu folgendes ein:</span></p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo chgrp -R admin /var/lib/samba</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Synchronisieren Sie anschließend die Benutzerkonten, indem Sie <span class="app application">scp</span> benutzen, um den <span class="file filename">/var/lib/samba</span>-Ordner von dem PDC zu kopieren:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo scp -r benutzername@pdc:/var/lib/samba /var/lib</span>
</pre></div>

          <div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Ersetzen Sie <span class="em emphasis">benutzername</span> mit einem gültigem Benutzernamen und <span class="em emphasis">pdc</span> Sie den Hostnamen oder die IP-Adresse Ihres momentanen PDCs.</p>
          </div></div></div></div>

        </li>
<li class="steps">
          
          <p class="para">Abschließend starten Sie <span class="app application">samba</span> neu:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>

        </li>
</ol></div></div>
<p class="para">Sie können überprüfen, dass Ihr Backup-Domänen-Kontroller funktioniert, indem Sie den Samba-Dienst auf Ihrem PDC stoppen und dann versuchen, sich auf einem Windows-Client einzuloggen, welcher der Domäne beigetreten ist.</p>
<p class="para">Wenn Sie die <span class="em emphasis">logon home</span>-Option als einen Ordner auf dem PDC eingerichtet haben, sollten Sie im Hinterkopf behalten, dass der Zugriff auf das Laufwerk mit dem <span class="em emphasis">persönlichen Ordner</span> des Benutzers nicht möglich ist, falls der PDC unerreichbar ist. Aus diesem Grund ist es am Besten, <span class="em emphasis">logon home</span> auf einem vom PDC und BDC unabhängigen Dateiserver zu lagern.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-dc-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Quellen</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Weitergehende Samba-Konfigurationen finden Sie in der <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Samba-HOWTO–Sammlung</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Dieses Handbuch steht auch in <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">gedruckter Form</a> zur Verfügung.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">O'Reilly's <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> ist auch eine gute Referenz.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html">Chapter 4</a> aus der Samba-HOWTO-Sammlung erklärt das Aufsetzen eines Primary Domain Controller.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html" class="ulink" title="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html">Chapter 5</a> aus der Samba-HOWTO-Sammlung erklärt das Aufsetzen eines Backup Domain Controller.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Die <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Samba-Seite</a> im Ubuntu-Wiki.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Securing File and Print Server">Zurück</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Active Directory Integration">Weiter</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
