<!DOCTYPE html>
<html lang=fr>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>En tant que contrôleur de domaine</title>
<link rel="stylesheet" type="text/css" href="fr.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guide du serveur Ubuntu">Guide du serveur Ubuntu</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Sécurisation du serveur de fichiers et d'impression">Précédent</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Integration Active Directory">Suivant</a>
</div>
<div class="hgroup"><h1 class="title">En tant que contrôleur de domaine</h1></div>
<div class="region">
<div class="contents"><p class="para">Bien qu'il ne puisse pas agir comme un contrôleur de domaine principal Active Directory (PDC), un serveur Samba peut être configuré pour apparaître comme contrôleur de domaine de type Windows NT4. Un des avantages majeurs de cette configuration est la centralisation authentifiants pour les machines et les utilisateurs. Samba peut également stocker les informations utilisateurs de différentes manières.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-dc.html#samba-pdc-smbpasswd" title="Contrôleur principal de domaine">Contrôleur principal de domaine</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-bdc-smbpasswd" title="Contrôleur secondaire de domaine">Contrôleur secondaire de domaine</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-dc-resources" title="Ressources">Ressources</a></li>
</ul></div>
<div class="sect2 sect" id="samba-pdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Contrôleur principal de domaine</h2></div>
<div class="region"><div class="contents">
<p class="para">Cette section aborde la configuration de Samba en contrôleur de domaine principal (PDC) en utilisant le gestionnaire de mot de passe par défaut smbpasswd.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

          <p class="para">Installez d'abord Samba et <span class="app application">libpam-smbpass</span> pour synchroniser les comptes utilisateurs, en saisissant ce qui suit dans un terminal :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install samba libpam-smbpass</span>
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Ensuite, configurez Samba en modifiant <span class="file filename">/etc/samba/smb.conf</span>. Le mode de <span class="em emphasis">security</span> doit être réglé sur <span class="em emphasis">user</span>, et le <span class="em emphasis">workgroup</span> doit correspondre à votre organisation :</p>

<div class="code"><pre class="contents ">   workgroup = EXAMPLE
   …
   security = user
</pre></div>

        </li>
<li class="steps">

          <p class="para">Dans la section commentée <span class="quote">« Domains »</span> (Domaines) ajoutez ou supprimez les éléments suivants (la dernière ligne a été divisée pour s'adapter au format de ce document) :</p>

<div class="code"><pre class="contents ">   domain logons = yes
   logon path = \\%N\%U\profile
   logon drive = H:
   logon home = \\%N\%U
   logon script = logon.cmd
   add machine script = sudo /usr/sbin/useradd -N -g machines -c Machine -d
         /var/lib/samba -s /bin/false %u
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Si vous ne voulez pas utiliser les <span class="em emphasis">profils itinérants</span> laissez commentées les options <span class="em emphasis">logon home</span> et <span class="em emphasis">logon path</span>.</p>
          </div></div></div></div>
 
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">domain logons :</span> permet à Samba d'agir comme un contrôleur de domaine</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon path :</span> place le profil des utilisateurs Windows dans leur répertoire personnel. Il est également possible de configurer un partage <span class="em emphasis">[profiles]</span> pour placer tous les profils dans un seul et même répertoire.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon drive :</span> spécifie l'emplacement du répertoire personnel local.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon home :</span> spécifie l'emplacement du répertoire personnel.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon script :</span> indique le script à exécuter localement une fois l'utilisateur connecté. Le script doit être placé dans le partage <span class="em emphasis">[netlogon]</span>.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">add machine script :</span> un script qui créera automatiquement un <span class="em emphasis">compte de machine approuvé</span>, requis pour qu'une station de travail puisse joindre le domaine.</p>
              <p class="para">Dans cet exemple le groupe <span class="em emphasis">machines</span> devra être créé en utilisant la commande <span class="app application">addgroup</span>, consultez <a class="xref" href="user-management.html#adding-deleting-users" title="Ajout et suppression d'utilisateurs">Ajout et suppression d'utilisateurs</a> pour plus de détails.</p>

            </li>
</ul></div>

        </li>
<li class="steps">
     
          <p class="para">Décommentez le partage <span class="em emphasis">[homes]</span> pour permettre au <span class="em emphasis">logon home</span> d'être monté en lecteur réseau :</p>

<div class="code"><pre class="contents ">[homes]
   comment = Home Directories
   browseable = no
   read only = no
   create mask = 0700
   directory mask = 0700
   valid users = %S
</pre></div>

        </li>
<li class="steps">

          <p class="para">Dans le cas d'une configuration en contrôleur de domaine, un partage <span class="em emphasis">[netlogon]</span> doit être configuré. Pour activer le partage, décommenter :</p>

<div class="code"><pre class="contents ">[netlogon]
   comment = Network Logon Service
   path = /srv/samba/netlogon
   guest ok = yes
   read only = yes
   share modes = no
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Le chemin par défaut du partage <span class="em emphasis">netlogon</span> est <span class="file filename">/home/samba/netlogon</span>. Cependant, d'après le standard FHS (Filesystem Hierarchy Standard), <a href="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM" class="ulink" title="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM">/srv</a> est l'emplacement correct pour des données spécifiques à un site fournies par le système.</p>
          </div></div></div></div>

        </li>
<li class="steps">

          <p class="para">Créez maintenant le dossier <span class="file filename">netlogon</span> et le fichier de script <span class="file filename">logon.cmd</span> vide (pour l'instant) :</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mkdir -p /srv/samba/netlogon</span>
<span class="cmd command">sudo touch /srv/samba/netlogon/logon.cmd</span>
</pre></div>
 
          <p class="para">Vous pouvez utiliser les commandes  de script de connexion normales Windows dans <span class="file filename">logon.cmd</span> pour personnaliser l'environnement du client.</p>

        </li>
<li class="steps">

          <p class="para">Redémarrez Samba pour activer le nouveau contrôleur de domaine:</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Enfin, il y a quelques commandes supplémentaires nécessaires pour configurer les droits d'accès appropriés.</p>

          <p class="para">Comme <span class="em emphasis">root</span> est désactivé par défaut, il est nécessaire de faire correspondre un groupe système au groupe Windows <span class="em emphasis">Domain Admins</span> pour pouvoir joindre une machine au domaine. Saisissez la commande suivante  dans un terminal (utilisation de <span class="app application">net</span>) :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo net groupmap add ntgroup="Domain Admins" unixgroup=sysadmin rid=512 type=d</span>
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Remplacez <span class="em emphasis">sysadmin</span> par le groupe que vous préférez. De même, l'utilisateur qui joindra les machines au domaine doit être membre du groupe <span class="em emphasis">sysadmin</span> mais aussi du groupe <span class="em emphasis">admin</span>. Le groupe <span class="em emphasis">admin</span> permet l'utilisation de <span class="app application">sudo</span>.</p>
            <p class="para">Si l'utilisateur ne dispose pas encore d'identifiants Samba, vous pouvez les ajouter avec l'utilitaire <span class="app application">smbpasswd</span>, changer l'identifiant <span class="em emphasis">sysadmin</span> de manière appropriée : <div class="screen"><pre class="contents ">
<span class="cmd command">sudo smbpasswd -a sysadmin</span>
</pre></div></p>
          </div></div></div></div>

          <p class="para">De plus, les droits d'accès doivent être fournis explicitement au groupe des <span class="em emphasis">Administrateurs domaine</span> pour permettre l'exécution du script <span class="em emphasis">ajouter une machine</span> (et autres fonctions administrateur). Ceci peut être accompli en exécutant :</p>
<div class="screen"><pre class="contents "><span class="cmd command">net rpc rights grant -U sysadmin "EXAMPLE\Domain Admins" SeMachineAccountPrivilege \ SePrintOperatorPrivilege SeAddUsersPrivilege SeDiskOperatorPrivilege \ SeRemoteShutdownPrivilege</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Vous devriez maintenant être capable de connecter les clients Windows au domaine de la même manière que vous les connectez à un domaine NT4 fonctionnant sur un Serveur Windows.</p>

        </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-bdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Contrôleur secondaire de domaine</h2></div>
<div class="region"><div class="contents">
<p class="para">Avec un contrôleur principal de domaine (PDC) opérationnel, il est préférable d'avoir également un contrôleur de domaine secondaire (BDC). Cela permettra aux clients de pouvoir toujours s'authentifier en cas d'indisponibilité du contrôleur principal de domaine.</p>
<p class="para">Lorsque vous paramétrez Samba en tant que BDC, vous avez besoin de synchroniser les informations de comptes avec le PDC. Ceci peut être fait avec divers outils tels que <span class="app application">scp</span>, <span class="app application">rsync</span> ou en utilisant <span class="app application">LDAP</span> en tant que <span class="em emphasis">passdb backend</span>.</p>
<p class="para">L'utilisation de LDAP est la façon la plus efficace de synchroniser des informations relatives aux comptes, car les deux contrôleurs de domaine peuvent utiliser les mêmes informations en temps réel. Cependant, configurer un serveur LDAP peut s'avérer trop complexe pour un petit nombre d'utilisateurs et de comptes d'ordinateurs. Voir <a class="xref" href="samba-ldap.html" title="Samba et LDAP">Samba et LDAP</a> pour plus de détails.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
   
          <p class="para">Pour commencer, installez <span class="app application">samba</span> et <span class="app application">libpam-smbpass</span>. Saisissez dans un terminal :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install samba libpam-smbpass</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Modifiez maintenant <span class="file filename">/etc/samba/smb.conf</span> et décommentez ce qui suit dans la section <span class="em emphasis">[global]</span> :</p>

<div class="code"><pre class="contents ">   workgroup = EXAMPLE
   …
   security = user
</pre></div>

        </li>
<li class="steps">

        <p class="para">Dans la section commentée <span class="em emphasis">Domains</span> décommentez ou ajoutez :</p>

<div class="code"><pre class="contents ">   domain logons = yes
   domain master = no
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Assurez-vous qu'un utilisateur a le droit de lire les fichiers dans <span class="file filename">/var/lib/samba</span>. Ainsi, pour permettre à un utilisateur du groupe <span class="em emphasis">admin</span> d'effectuer un <span class="app application">scp</span> sur les fichiers, saisissez :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo chgrp -R admin /var/lib/samba</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Il faut ensuite synchroniser les comptes utilisateurs en se servant de <span class="app application">scp</span> pour copier le répertoire <span class="file filename">/var/lib/samba</span> depuis le PDC :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo scp -r identifiant@pdc:/var/lib/samba /var/lib</span>
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Remplacez <span class="em emphasis">username</span> par un identifiant correct et <span class="em emphasis">pdc</span> par le nom d'hôte ou par l'adresse IP du PDC.</p>
          </div></div></div></div>

        </li>
<li class="steps">
          
          <p class="para">Pour finir, redémarrez <span class="app application">samba</span> :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>

        </li>
</ol></div></div>
<p class="para">You pouvez tester le bon fonctionnement de votre BDC en arrêtant le démon Samba du PDC puis en essayant de vous identifier sur le domaine à partir d'un client Windows préalablement joint au domaine.</p>
<p class="para">Une autre chose à conserver à l'esprit est que si vous avez configuré l'option <span class="em emphasis">logon home</span> comme répertoire sur le PDC, et que le PDC devient indisponible, l'accès pour l'utilisateur au lecteur <span class="em emphasis">Home</span> sera également impossible. Pour cette raison, il est préférable de configurer le <span class="em emphasis">logon home</span> afin qu'il réside sur un serveur de fichiers séparé du PDC et du BDC.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-dc-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Ressources</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Pour des configurations plus élaborées de Samba, consultez les <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">guides pratiques Samba (en)</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Ce guide est également disponible en <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">format papier</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Le manuel O'Reilly <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> (en anglais) est aussi une bonne référence.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Le <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html">chapitre 4</a> de la collection des guides Samba décrit la mise en place d'un contrôleur de domaine primaire (PDC).</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Le <a href="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html" class="ulink" title="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html">chapitre 5</a> de la collection des guide Samba décrit la mise en place d'un contrôleur de domaine secondaire (BDC).</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Page du <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Wiki Ubuntu consacrée à Samba</a>.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Sécurisation du serveur de fichiers et d'impression">Précédent</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Integration Active Directory">Suivant</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
