<!DOCTYPE html>
<html lang=ca>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Securing File and Print Server</title>
<link rel="stylesheet" type="text/css" href="ca.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guia del servidor de l'Ubuntu">Guia del servidor de l'Ubuntu</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Print Server">Anterior</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Següent</a>
</div>
<div class="hgroup"><h1 class="title">Securing File and Print Server</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Modes de seguretat del Samba">Modes de seguretat del Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Security = User">Security = User</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Seguretat dels recursos compartits">Seguretat dels recursos compartits</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Perfil AppArmor del Samba">Perfil AppArmor del Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Recursos">Recursos</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Modes de seguretat del Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">
      There are two security levels available to the Common Internet Filesystem (CIFS) network protocol 
      <span class="em emphasis">user-level</span> and <span class="em emphasis">share-level</span>.  Samba's <span class="em emphasis">security mode</span>
      implementation allows more flexibility, providing four ways of implementing user-level security and one way to 
      implement share-level:
      </p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = user:</span> obliga els clients a proporcionar un nom d'usuari i una contrasenya per accedir a les comparticions. Els comptes d'usuaris del Samba es troben separats dels comptes del sistema, però el paquet <span class="app application">libpam-smbpass</span> sincronitza els usuaris i les respectives contrasenyes del sistema amb la base de dades dels usuaris del Samba.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = domain:</span> aquest mode permet que el servidor Samba aparegui en els clients Windows com un Primary Domain Controller (PDC), Backup Domain Controller (BDC), o com un Domain Member Server (DMS). Per a més informació vegeu: <a class="xref" href="samba-dc.html" title="As a Domain Controller">As a Domain Controller</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = ADS:</span> permet al servidor Samba d'unir-se a un domini de Directori actiu com un membre nadiu. Vegeu <a class="xref" href="samba-ad-integration.html" title="Active Directory Integration">Active Directory Integration</a> per a obtenir-ne més detalls.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = server:</span> aquest mode ha esdevingut obsolet i a causa d'alguns aspectes de seguretat no s'hauria d'utilitzar . Vegeu l'apartat <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531">Server Security</a> de la guia del Samba per a obtenir-ne més informació.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = share:</span> permet que els clients es connectin als recursos compartits sense proporcionar cap nom d'usuari ni contrasenya.</p>
        </li>
</ul></div>
<p class="para">El mode de seguretat que trieu dependrà de l'entorn i de la funció que us calgui que faci el servidor Samba.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Security = User</h2></div>
<div class="region"><div class="contents">
<p class="para">En aquest apartat es reconfigurarà el servidor de fitxers i d'impressió del Samba de <a class="xref" href="samba-fileserver.html" title="File Server">File Server</a> i <a class="xref" href="samba-printserver.html" title="Print Server">Print Server</a>, per a accedir-hi mitjançant l'autenticació.</p>
<p class="para">Primer instal·leu el paquet  <span class="app application">libpam-smbpass</span>, el qual possibilita la sincronització dels usuaris del sistema amb la base de dades dels usuaris del Samba:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install libpam-smbpass</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Si heu escollit la tasca <span class="em emphasis">Samba Server</span>durant la instal·lació, el <span class="app application">libpam-smbpass</span> ja es troba instal·lat.</p>
      </div></div></div></div>
<p class="para">Editeu el fitxer <span class="file filename">/etc/samba/smb.conf</span> i en l'apartat <span class="em emphasis">[share]</span> canvieu:</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Finalment, reinicieu el Samba de manera que els paràmetres nous tinguin efecte:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<p class="para">Ara si us connecteu als directoris compartits o a les impressores el sistema us hauria de demanar el nom d'usuari i la contrasenya.</p>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">
        If you choose to map a network drive to the share you can check the <span class="quote">«Reconnect at Logon»</span> check 
        box, which will require you to only enter the username and password once, at least until the password changes.
        </p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Seguretat dels recursos compartits</h2></div>
<div class="region">
<div class="contents"><p class="para">
      There are several options available to increase the security for each individual shared directory.  Using the 
      <span class="em emphasis">[share]</span> example, this section will cover some common options.
      </p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Grups</h3></div>
<div class="region"><div class="contents">
<p class="para">Els grups defineixen un conjunt d'ordinadors o usuaris que tenen un nivell d'accés equivalent a recursos concrets de la xarxa i ofereix un nivell de granularitat en controlar l'accés a aquest recursos. Per exemple si es defineix un grup anomenat<span class="em emphasis">qa</span>, els usuaris del qual són <span class="em emphasis">marta</span>, <span class="em emphasis">laura</span> i <span class="em emphasis">jordi</span> i es defineix un segon grup anomenat<span class="em emphasis">manteniment</span> amb els usuaris <span class="em emphasis">laura</span>, <span class="em emphasis">pere</span> i <span class="em emphasis">vicent</span> llavors alguns recursos de la xarxa configurats per permetre l'accés al grup <span class="em emphasis">qa</span> només seran accessibles per a la marta, la laura i en jordi però no per a en pere o en vicent. Atès que l'usuària <span class="em emphasis">laura</span> pertany a ambdós grups <span class="em emphasis">qa</span> i <span class="em emphasis">manteniment</span> podrà accedir als recursos configurats pels dos grups, mentre que la resta d'usuaris només podran accedir als recursos autoritzats explícitament al grup al qual pertanyen.</p>
<p class="para">De manera predeterminada, el Samba cerca al sistema local grups definits al fitxer <span class="file filename">/etc/group</span> per a determinar quins usuaris pertanyen a quin grup. Per més informació sobre com afegir i suprimir usuaris d'un grup vegeu <a class="xref" href="user-management.html#adding-deleting-users" title="Adding and Deleting Users">Adding and Deleting Users</a>.</p>
<p class="para">Si es vol definir un grup en el fitxer de configuració del Samba, <span class="file filename">/etc/samba/smb.conf</span> empreu la sintaxi correcta tot posant "@" davant del nom del grup. Per exemple, si voleu definir un grup anomenat <span class="em emphasis">sysadmin</span> en un apartat concret del fitxer <span class="file filename">/etc/samba/smb.conf</span> heu d'introduir el nom del grup de la manera següent: <span class="em em-bold emphasis">@sysadmin</span>.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Permisos de fitxer</h3></div>
<div class="region"><div class="contents">
<p class="para">Els permisos de fitxers defineixen els drets explícits que un ordinador o un usuari tenen sobre un directori, fitxer o conjunt de fitxers concrets. Aquests permisos es poden definir editant el fitxer <span class="file filename">/etc/samba/smb.conf</span>. En aquest fitxer es poden especificar els permisos explícits d'un fitxer compartit.</p>
<p class="para">Per exemple, si heu definit una carpeta compartida del Samba anomenada <span class="em emphasis">share</span> i desitgeu donar permisos <span class="em emphasis">només de lectura</span> al grup d'usuaris anomenat <span class="em emphasis">qa</span> però voleu permetre'n l'escriptura al grup anomenat <span class="em emphasis">sysadmin</span> i a l'usuari <span class="em emphasis">vicent</span>, podeu editar el fitxer <span class="file filename">/etc/samba/smb.conf</span> i afegir-hi les següents entrades sota <span class="em emphasis">[share]</span></p>
<div class="code"><pre class="contents ">    read list = @qa
    write list = @sysadmin, vincent
</pre></div>
<p class="para">Una altra possibilitat d'atorgar permisos en el Samba es declarar permisos <span class="em emphasis">administratius</span> a un recurs compartit concret. Els usuaris que tinguin permisos administratius poden llegir, escriure o modificar qualsevol informació inclosa en el recurs pel qual l'usuari hagi obtingut permisos administratius explícits.</p>
<p class="para">Per exemple, si voleu atorgar permisos administratius a l'usuari <span class="em emphasis">anna</span> en l'exemple <span class="em emphasis">share</span> anterior, editeu el fitxer <span class="file filename">/etc/samba/smb.conf</span> i afegiu-hi la línia següent sota el l'entrada <span class="em emphasis">[share]</span></p>
<div class="code"><pre class="contents ">    admin users = anna
</pre></div>
<p class="para">Després d'editar el fitxer <span class="file filename">/etc/samba/smb.conf</span> reinicieu el Samba perquè els canvis tinguin efecte:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Per fer que les llistes <span class="em emphasis">read list</span> i <span class="em emphasis">write list</span> funcionin, el mode de seguretat del Samba <span class="em emphasis">no</span> s'ha de definir com a <span class="em emphasis">security = share</span></p>
        </div></div></div></div>
<p class="para">Ara que Samba s'ha configurat per a limitar l'accés dels grups als directoris compartits és necessari actualitzar els permisos del sistema de fitxers.</p>
<p class="para">Els permisos de fitxer tradicionals del Linux no coincideixen totalment amb les llistes de control d'accés del Windows NT (ACL). Per sort els servidors Ubuntu disposen d'ACL POSIX que proporcionen un control més acurat. Per exemple, per a habilitar ACL a <span class="file filename">/srv</span> en un sistema de fitxer EXT3, editeu el fitxer <span class="file filename">/etc/fstab</span> i afegiu l'opció <span class="em emphasis">acl</span>:</p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv  ext3    noatime,relatime,acl 0       1
</pre></div>
<p class="para">Després torneu a muntar la partició:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">L'exemple anterior pressuposa que el fitxer <span class="file filename">/srv</span> es troba en una partició separada. Si el fitxer <span class="file filename">/srv</span> o el lloc on hàgiu configurat el vostre camí compartit es part de la partició <span class="file filename">/</span>, pot ser que hàgiu de reiniciar l'ordinador.</p>
        </div></div></div></div>
<p class="para">
        To match the Samba configuration above the <span class="em emphasis">sysadmin</span> group will be given read, write, and execute
        permissions to <span class="file filename">/srv/samba/share</span>, the <span class="em emphasis">qa</span> group will be given read and execute
        permissions, and the files will be owned by the username <span class="em emphasis">melissa</span>.  Enter the following in a 
        terminal:
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R anna /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">
          The <span class="app application">setfacl</span> command above gives <span class="em emphasis">execute</span> permissions to all files in
          the <span class="file filename">/srv/samba/share</span> directory, which you may or may not want.
          </p>
        </div></div></div></div>
<p class="para">
        Now from a Windows client you should notice the new file permissions are implemented.  See the 
        <span class="app application">acl</span> and <span class="app application">setfacl</span> man pages for more information on POSIX ACLs.
        </p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Perfil AppArmor del Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">
      Ubuntu comes with the <span class="app application">AppArmor</span> security module, which provides mandatory access controls.
      The default AppArmor profile for Samba will need to be adapted to your configuration.  For more details on using
      AppArmor see <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.
      </p>
<p class="para">
      There are default AppArmor profiles for <span class="file filename">/usr/sbin/smbd</span> and <span class="file filename">/usr/sbin/nmbd</span>, the
      Samba daemon binaries, as part of the <span class="app application">apparmor-profiles</span> packages.  To install the package,
      from a terminal prompt enter:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">
        This package contains profiles for several other binaries.
        </p>
      </div></div></div></div>
<p class="para">
      By default the profiles for <span class="app application">smbd</span> and <span class="app application">nmbd</span> are in 
      <span class="em emphasis">complain</span> mode allowing Samba to work without modifying the profile, and only logging errors.
      To place the <span class="app application">smbd</span> profile into <span class="em emphasis">enforce</span> mode, and have Samba work as 
      expected, the profile will need to be modified to reflect any directories that are shared.
      </p>
<p class="para">
      Edit <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> adding information for <span class="em emphasis">[share]</span> from the
      file server example:
      </p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
  /srv/samba/share/** rwkix,
</pre></div>
<p class="para">
      Now place the profile into <span class="em emphasis">enforce</span> and reload it:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">
      You should now be able to read, write, and execute files in the shared directory as normal, and the
      <span class="app application">smbd</span> binary will have access to only the configured files and directories.  
      Be sure to add entries for each directory you configure Samba to share.  Also, any errors will be logged
      to <span class="file filename">/var/log/syslog</span>.  
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Recursos</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Per una configuració més acurada del Samba vegeu <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">la col·lecció de guies del Samba</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">La guia també està disponible en <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">format en paper</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">El llibre d'O'Reilly <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> és també una bona referència.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">El capítol 18 de l'enllaç <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html"> de la col·lecció HOWTO del Samba tracta sobre seguretat.</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          For more information on Samba and ACLs see the
          <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568">Samba ACLs page
          </a>.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          The <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Ubuntu Wiki Samba </a> page.
          </p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Print Server">Anterior</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Següent</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
