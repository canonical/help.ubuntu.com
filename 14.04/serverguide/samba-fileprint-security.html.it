<!DOCTYPE html>
<html lang=it>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Proteggere server di file e di stampa</title>
<link rel="stylesheet" type="text/css" href="it.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guida a Ubuntu Server">Guida a Ubuntu Server</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Server di stampa">Indietro</a><a class="nextlinks-next" href="samba-dc.html" title="Come un controller di dominio">Avanti</a>
</div>
<div class="hgroup"><h1 class="title">Proteggere server di file e di stampa</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Modalità di sicurezza di Samba">Modalità di sicurezza di Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Livello di sicurezza utente">Livello di sicurezza utente</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Livello di sicurezza condivisione">Livello di sicurezza condivisione</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Profilo AppArmor Samba">Profilo AppArmor Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Risorse">Risorse</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Modalità di sicurezza di Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Esistono due livelli di sicurezza disponibili al protocollo CIFS (Common Internet Filesystem): a livello <span class="em emphasis">utente</span> e a livello <span class="em emphasis">condivisione</span>. L'implementazione della <span class="em emphasis">modalità di sicurezza</span> di Samba consente una maggiore flessibilità, fornendo quattro modi per implementare la sicurezza a livello utente e uno per quella a livello condivisione.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = user</span>: richiede a client di fornire nome utente e password per collegarsi alla condivisione. Gli account di Samba sono separati da quelli di sistema, ma il pacchetto <span class="app application">libpam-smbpass</span> consente di sincronizzare utenti e password con il database degli utenti di Samba.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = domain</span>: questa modalità consente al server Samba di apparire ai client Windows come «Primary Domain Controller» (PDC), «Backup Domain Controller» (BDC) oppure «Domain Member Server» (DMS). Per maggiori informazioni, consultare <a class="xref" href="samba-dc.html" title="Come un controller di dominio">Come un controller di dominio</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = ADS</span>: consente al server Samba di unirsi a un dominio «Active Directory» come membro nativo. Per maggiori informazioni, consultare <a class="xref" href="samba-ad-integration.html" title="Integrazione con Active Directory">Integrazione con Active Directory</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = server</span>: questa modalità non dovrebbe essere usata per motivi di sicurezza. Per maggiori informazioni, consultare la sezione <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531">Server Security</a> della guida di Samba.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = share</span>: consente ai client di collegarsi alle condivisioni senza fornire nome utente e password.</p>
        </li>
</ul></div>
<p class="para">La modalità di sicurezza scelta dipende dal proprio ambiente di lavoro e da cosa si vuole ottenere col server Samba.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Livello di sicurezza utente</h2></div>
<div class="region"><div class="contents">
<p class="para">Questa sezione spiega come riconfigurare i server di file e di stampa Samba, come spiegato in <a class="xref" href="samba-fileserver.html" title="File Server">File Server</a> e <a class="xref" href="samba-printserver.html" title="Server di stampa">Server di stampa</a>, affinché richieda l'autenticazione.</p>
<p class="para">Per prima cosa, installare il pacchetto <span class="app application">libpam-smbpass</span> che consente di sincronizzare gli utenti di sistema col database degli utenti di Samba:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install libpam-smbpass</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Se è stato scelto il task <span class="em emphasis">Server Samba</span> durante l'installazione, il pacchetto <span class="app application">libpam-smbpass</span> è già installato.</p>
      </div></div></div></div>
<p class="para">Aprire il file <span class="file filename">/etc/samba/smb.conf</span> e nella sezione <span class="em emphasis">[share]</span> modificare:</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Riavviare Samba affinché le nuove impostazioni abbiano effetto:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<p class="para">Ora, collegandosi alle directory o alle stampanti condivise, verranno richiesti il nome utente e la password.</p>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Se si sceglie di associare un drive di rete alla condivisione, selezionare la casella di spunta <span class="quote">“Reconnect at Logon”</span> affinché sia possibile inserire nome utente e password solo una volta, almeno finché la password non viene cambiata.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Livello di sicurezza condivisione</h2></div>
<div class="region">
<div class="contents"><p class="para">Ci sono diverse opzioni disponibili per aumentare la sicurezza di ogni singola directory condivisa. Facendo uso dell'esempio <span class="em emphasis">[share]</span>, questa sezione illustra alcune di queste opzioni.</p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Gruppi</h3></div>
<div class="region"><div class="contents">
<p class="para">I gruppi definiscono un insieme di computer e utenti che godono dei medesimi privilegi di accesso alle risorse condivise, offrendo un alto livello di controllo di questi accessi. Per esempio, se il gruppo <span class="em emphasis">qa</span> contiene gli utenti <span class="em emphasis">freda</span>, <span class="em emphasis">danika</span> e <span class="em emphasis">rob</span> e viene definito il secondo gruppo <span class="em emphasis">support</span> che contiene gli utenti <span class="em emphasis">danika</span>, <span class="em emphasis">jeremy</span> e <span class="em emphasis">vincent</span>, allora alcune risorse di rete impostate per concedere l'accesso al gruppo <span class="em emphasis">qa</span> concedono automaticamente l'accesso anche agli utenti freda, danika e rob, mentre lo negano a jeremy o vincent. Dal momento che l'utente <span class="em emphasis">danika</span> è membro di entrambi i gruppi <span class="em emphasis">qa</span> e <span class="em emphasis">support</span> potrà accedere a tutte le risorse condivise il cui accesso è stato concesso a entrambi i gruppi, gli altri utenti avranno accesso alle risorse esplicitamente assegnate al gruppo di appartenenza.</p>
<p class="para">Samba, in modo predefinito, controlla i gruppi di sistema locali definiti in <span class="file filename">/etc/group</span> per determinare quali utenti appartengono a quali gruppi. Per maggiori informazioni su come aggiungere o rimuovere gruppi, consultare <a class="xref" href="user-management.html#adding-deleting-users" title="Aggiungere e rimuovere utenti">Aggiungere e rimuovere utenti</a>.</p>
<p class="para">Quando si definiscono i gruppi nel file di configurazione di Samba, <span class="file filename">/etc/samba/smb.conf</span>, la sintassi predefinita è quella di usare il prefisso «@» col nome del gruppo. Per esempio, per definire il gruppo <span class="em emphasis">sysadmin</span> in una sezione del file <span class="file filename">/etc/samba/smb.conf</span>, bisogna inserire il nome del gruppo come <span class="em em-bold emphasis">@sysadmin</span>.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Permessi dei file</h3></div>
<div class="region"><div class="contents">
<p class="para">I permessi dei file definiscono i diritti che un computer o un utente ha su una particolare directory, file o insieme di file. Tali permessi possono essere definiti modificando il file <span class="file filename">/etc/samba/smb.conf</span> e specificando i permessi di una condivisione definita.</p>
<p class="para">Per esempio, se è stata definita una condivisione Samba chiamata <span class="em emphasis">share</span> e si vuole dare il permesso di <span class="em emphasis">sola lettura</span> al gruppo di utenti conosciuto come <span class="em emphasis">qa</span>, ma si vuole concedere permesso di scrittura sulla condivisione al gruppo <span class="em emphasis">sysadmin</span> e all'utente <span class="em emphasis">vincent</span>, modificare il file <span class="file filename">/etc/samba/smb.conf</span> e aggiungere quanto segue al di sotto della sezione <span class="em emphasis">[share]</span>:</p>
<div class="code"><pre class="contents ">    read list = @qa
    write list = @sysadmin, vincent
</pre></div>
<p class="para">Un altro possibile permesso con Samba consente di usare i permessi <span class="em emphasis">amministrativi</span> su una particolare risorsa condivisa. Gli utenti con permessi amministrativi possono leggere, scrivere o modificare qualsiasi informazione all'interno della risorsa per cui sono stati abilitati.</p>
<p class="para">Per esempio, per concedere all'utente <span class="em emphasis">melissa</span> permessi amministrativi all'interno dell'esempio <span class="em emphasis">share</span>, modificare il file <span class="file filename">/etc/samba/smb.conf</span> e aggiungere quanto segue al di sotto della sezione <span class="em emphasis">[share]</span>:</p>
<div class="code"><pre class="contents ">    admin users = melissa
</pre></div>
<p class="para">Modificato il file <span class="file filename">/etc/samba/smb.conf</span>, riavviare Samba affinché le modifiche abbiano effetto:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Affinché <span class="em emphasis">read list</span> e <span class="em emphasis">write list</span> funzionino, il modello di sicurezza di Samba <span class="em emphasis">non</span> deve essere impostato a <span class="em emphasis">security = share</span></p>
        </div></div></div></div>
<p class="para">Ora che Samba è stato configurato per limitare quali gruppi hanno accesso alla directory condivisa, è necessario aggiornare i permessi del file system.</p>
<p class="para">Il sistema dei permessi sui file di Linux non funziona correttamente con le ACL (Access Control List) di Windows NT. In questi casi, nei server Ubuntu, sono disponibili le ACL POSIX che forniscono un controllo più fine. Per esempio, per abilitare le ACL su <span class="file filename">/srv</span> con file system ext3, modificare il file <span class="file filename">/etc/fstab</span> aggiungendo l'opzione <span class="em emphasis">acl</span>:</p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv  ext3    noatime,relatime,acl 0       1
</pre></div>
<p class="para">Quindi montare nuovamente la partizione:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
          <p class="para">L'esempio precedente assume che <span class="file filename">/srv</span> sia in una partizione separata. Se <span class="file filename">/srv</span> o qualsiasi sia il percorso di condivisione, fa parte della partizione <span class="file filename">/</span>, potrebbe essere necessario riavviare il sistema.</p>
        </div></div></div></div>
<p class="para">Per uguagliare la configurazione precedente di Samba, al gruppo <span class="em emphasis">sysadmin</span> devono essere dati i permessi di lettura, scrittura e di esecuzione su <span class="file filename">/srv/samba/share</span>, al gruppo <span class="em emphasis">qa</span> devono essere dati i permessi di lettura ed esecuzione e i file devono essere di proprietà del nome utente <span class="em emphasis">melissa</span>. In un terminale, digitare quanto segue:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R melissa /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Il comando <span class="app application">setfacl</span> imposta i permessi di <span class="em emphasis">esecuzione</span> a tutti i file nella directory <span class="file filename">/srv/samba/share</span>. Nel caso non sia desiderato, non eseguire il comando.</p>
        </div></div></div></div>
<p class="para">Da un client Windows ora dovrebbe essere possibile notare la nuova implementazione dei permessi dei file. Per maggiori informazioni riguardo le ACL POSIX, consultare le pagine di manuale di <span class="app application">acl</span> e <span class="app application">setfacl</span>.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Profilo AppArmor Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Ubuntu è dotato del modulo di sicurezza <span class="app application">AppArmor</span>, che fornisce un controlli di acceso. Il profilo predefinito di AppArmor per Samba deve essere adattato alla propria configurazione. Per maggiori informazioni sull'uso di AppArmor, consultare <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.</p>
<p class="para">All'interno del pacchetto <span class="app application">apparmor-profiles</span> sono disponibili dei profili predefiniti di AppArmor per <span class="file filename">/usr/sbin/smbd</span> e <span class="file filename">/usr/sbin/nmbd</span>, i binari dei demoni di Samba. Per installare il pacchetto, da un terminale digitare:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Questo pacchetto contiene profili per molti altri binari.</p>
      </div></div></div></div>
<p class="para">I profili per <span class="app application">smbd</span> e <span class="app application">nmbd</span> sono, in modo predefinito, nella modalità <span class="em emphasis">complain</span>, consentendo a Samba di lavorare senza dover modificare il profilo e registrando solamente gli errori. Per impostare il profilo <span class="app application">smbd</span> in modalità <span class="em emphasis">enforce</span> e per far funzionare Samba come di consueto, il profilo deve essere modificato per rispecchiare le directory da condividere.</p>
<p class="para">Modificare il file <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> aggiungendo informazioni alla sezione <span class="em emphasis">[share]</span> dall'esempio del server di file:</p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
  /srv/samba/share/** rwkix,
</pre></div>
<p class="para">Ora impostare il profilo in modalità <span class="em emphasis">enforce</span> e ricaricarlo:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">Dovrebbe essere possibile leggere, scrivere ed eseguire i file nella directory condivisa come di consuetudine e il binario <span class="app application">smbd</span> dovrebbe avere accesso solo ai file e le directory configurati. Assicurarsi di aggiungere una voce per ogni directory che viene configurata alla condivisione. Tutti gli errori verranno registrati in <span class="file filename">/var/log/syslog</span>.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Risorse</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Per delle configurazioni più dettagliate riguardo Samba, consultare <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Samba HOWTO Collection</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">La guida è disponibile anche in <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">formato cartaceo</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il libro <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> di O'Reilly è un'altra buona lettura.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html">capitolo 18</a> della «Samba HOWTO Collection» è dedicato alla sicurezza.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il libro <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> di O'Reilly è un'altra buona lettura.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">La pagina <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">su Samba</a> della documentazione.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Server di stampa">Indietro</a><a class="nextlinks-next" href="samba-dc.html" title="Come un controller di dominio">Avanti</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
