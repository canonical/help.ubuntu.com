<!DOCTYPE html>
<html lang=pl-PL>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Securing File and Print Server</title>
<link rel="stylesheet" type="text/css" href="pl.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Przewodnik Serwer Ubuntu">Przewodnik Serwer Ubuntu</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Print Server">Poprzednia</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Następna</a>
</div>
<div class="hgroup"><h1 class="title">Securing File and Print Server</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Tryby bezpieczeństwa Samba">Tryby bezpieczeństwa Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Security = User">Security = User</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Bezpieczeństwo udostępniania">Bezpieczeństwo udostępniania</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Profil Samba AppArmor">Profil Samba AppArmor</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Zasoby">Zasoby</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Tryby bezpieczeństwa Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">
      There are two security levels available to the Common Internet Filesystem (CIFS) network protocol 
      <span class="em emphasis">user-level</span> and <span class="em emphasis">share-level</span>.  Samba's <span class="em emphasis">security mode</span>
      implementation allows more flexibility, providing four ways of implementing user-level security and one way to 
      implement share-level:
      </p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = user:</span> wymaga użytkownika i hasła, aby podłączyć się do zasobów. Konta użytkowników Samba są oddzielone od kont systemowych, ale pakiet <span class="app application">libpam-smbpass</span> zsynchronizuje użytkowników i hasła z systemu z bazą użytkowników Samby.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = domain:</span> ten tryb pozwala serwerowi Samba przedstawiać się klientom Windows jako Primary Domain Controller (PDC), Backup Domain Controller (BDC), lub Domain Member Server (DMS). Zobacz <a class="xref" href="samba-dc.html" title="As a Domain Controller">As a Domain Controller</a>, aby uzyskać dodatkowe informacje.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = ADS:</span> pozwala serwerowi Samby na przyłączenie się do domeny Active Directory jako rodzimy członek. Zobacz <a class="xref" href="samba-ad-integration.html" title="Active Directory Integration">Active Directory Integration</a>, aby uzyskać dodatkowe informacje.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          <span class="em emphasis">security = server:</span> this mode is left over from before Samba could become a member server, and 
          due to some security issues should not be used.  See the 
          <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531">Server Security</a>
          section of the Samba guide for more details.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = share:</span> zezwala na połączenie do zasobu bez podania nazwy użytkownika oraz hasła.</p>
        </li>
</ul></div>
<p class="para">Tryb bezpieczeństwa, który wybierzesz, będzie zależał od środowiska i zadań jakie serwer Samba będzie realizował.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Security = User</h2></div>
<div class="region"><div class="contents">
<p class="para">
      This section will reconfigure the Samba file and print server, from <a class="xref" href="samba-fileserver.html" title="File Server">File Server</a> and
      <a class="xref" href="samba-printserver.html" title="Print Server">Print Server</a>, to require authentication.
      </p>
<p class="para">Na początku, zainstaluj <span class="app application">libpam-smbpass</span> pakiet, który zsynchronizuje użytkowników systemowych do użytkowników bazy danych serwera Samba:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install libpam-smbpass</span>
</pre></div>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Jeżeli wybrałeś zadanie <span class="em emphasis">Serwer Samba</span> podczas instalacji, <span class="app application">libpam-smbpass</span> jest już zainstalowany.</p>
      </div></div></div></div>
<p class="para">Edycja pliku <span class="file filename">/etc/samba/smb.conf</span>, oraz zmiana sekcji <span class="em emphasis">[share]</span>:</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Na koniec, należy dokonać restartu serwera Samba żeby zmiany były widoczne:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<p class="para">Teraz, po podłączeniu do udostępnionych katalogów lub drukarek powinien pojawić się monit o podanie nazwy użytkownika i hasła.</p>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
        <p class="para">
        If you choose to map a network drive to the share you can check the <span class="quote">„Reconnect at Logon”</span> check 
        box, which will require you to only enter the username and password once, at least until the password changes.
        </p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Bezpieczeństwo udostępniania</h2></div>
<div class="region">
<div class="contents"><p class="para">Istnieje kilka możliwości zwiększenia bezpieczeństwa dla każdego udostępnionego katalogu. Użycie przykładu z <span class="em emphasis">[share]</span> zastąpi niektóre ogólne ustawienia.</p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Grupy</h3></div>
<div class="region"><div class="contents">
<p class="para">Grupy definiują zbiór użytkowników komputerów lub użytkowników z równym poziomem dostępu do określonych zasobów sieciowych i oferują możliwość dokładnego określenia poziomu dostępu do tego typu zasobów. Przykładowo, jeśli jest określona grupa <span class="em emphasis">ubuntu-pl</span> i zawiera użytkowników <span class="em emphasis">pressenter</span>, <span class="em emphasis">gruvby</span> oraz <span class="em emphasis">roch</span> i druga określona grupa <span class="em emphasis">wsparcie</span> zawierająca użytkowników <span class="em emphasis">gruvby</span>, <span class="em emphasis">stiki</span> oraz <span class="em emphasis">miszka</span>, wtedy pewne zasoby sieciowe skonfigurowane tak, aby umożliwić dostęp grupie <span class="em emphasis">ubuntu-pl</span>, pozwolą w ten sposób na dostęp użytkownikom pressenter, gruvby i roch, ale nie stiki czy miszka. Ze względu na to, że użytkownik <span class="em emphasis">gruvby</span> należy do grupy <span class="em emphasis">ubuntu-pl</span> oraz <span class="em emphasis">wsparcie</span>, będzie miał dostęp do zasobów sieciowych skonfigurowanych do dostępu dla obu tych grup, a inni użytkownicy będą mieli dostęp tylko do tych zasobów, do których zasobów ma dostęp grupa do której należą.</p>
<p class="para">
        By default Samba looks for the local system groups defined in <span class="file filename">/etc/group</span> to determine which users
        belong to which groups.  For more information on adding and removing users from groups see 
        <a class="xref" href="user-management.html#adding-deleting-users" title="Adding and Deleting Users">Adding and Deleting Users</a>.
        </p>
<p class="para">
        When defining groups in the Samba configuration file, <span class="file filename">/etc/samba/smb.conf</span>, the recognized syntax 
        is to preface the group name with an "@" symbol.  For example, if you wished to define a group named 
        <span class="em emphasis">sysadmin</span> in a certain section of the <span class="file filename">/etc/samba/smb.conf</span>, 
        you would do so by entering the group name as <span class="em em-bold emphasis">@sysadmin</span>.
        </p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Uprawnienia Plików</h3></div>
<div class="region"><div class="contents">
<p class="para">
        File Permissions define the explicit rights a computer or user has to a particular directory, file, or set of
        files.  Such permissions may be defined by editing the <span class="file filename">/etc/samba/smb.conf</span> file and specifying
        the explicit permissions of a defined file share.
        </p>
<p class="para">
        For example, if you have defined a Samba share called <span class="em emphasis">share</span> and wish to give 
        <span class="em emphasis">read-only</span> permissions to the group of users known as 
        <span class="em emphasis">qa</span>, but wanted to allow writing to the share by the group called 
        <span class="em emphasis">sysadmin</span> and the user named <span class="em emphasis">vincent</span>, 
        then you could edit the <span class="file filename">/etc/samba/smb.conf</span> file, and add the following entries under 
        the <span class="em emphasis">[share]</span> entry:
        </p>
<div class="code"><pre class="contents ">    read list = @qa
    write list = @sysadmin, vincent
</pre></div>
<p class="para">
        Another possible Samba permission is to declare <span class="em emphasis">administrative</span> permissions to a
        particular shared resource.  Users having administrative permissions may read, write, or modify any information
        contained in the resource the user has been given explicit administrative permissions to.
        </p>
<p class="para">
        For example, if you wanted to give the user <span class="em emphasis">melissa</span> administrative permissions to
        the <span class="em emphasis">share</span> example, you would edit the 
        <span class="file filename">/etc/samba/smb.conf</span> file, and add the following line under the 
        <span class="em emphasis">[share]</span> entry:
        </p>
<div class="code"><pre class="contents ">    admin users = melissa
</pre></div>
<p class="para">Po zakończeniu edycji <span class="file filename">/etc/samba/smb.conf</span>, uruchom usługę Samba ponownie, aby zmiany były widoczne:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
          <p class="para">
          For the <span class="em emphasis">read list</span> and <span class="em emphasis">write list</span> to work the Samba security mode
          must <span class="em emphasis">not</span> be set to <span class="em emphasis">security = share</span>
          </p>
        </div></div></div></div>
<p class="para">
        Now that Samba has been configured to limit which groups have access to the shared directory, the filesystem permissions
        need to be updated.
        </p>
<p class="para">
        Traditional Linux file permissions do not map well to Windows NT Access Control Lists (ACLs).  Fortunately POSIX ACLs
        are available on Ubuntu servers providing more fine grained control.  For example, to enable ACLs on  
        <span class="file filename">/srv</span> an EXT3 filesystem, edit <span class="file filename">/etc/fstab</span> adding the 
        <span class="em emphasis">acl</span> option:
        </p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv  ext3    noatime,relatime,acl 0       1
</pre></div>
<p class="para">Potem zamontuj ponownie partycję:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Powyższy przykład zakłada <span class="file filename">/srv</span> na osobnej partycji. Jeżeli katalog <span class="file filename">/srv</span> lub inny, w którym masz skonfigurowane udziały jest częścią partycji <span class="file filename">/</span>, ponowne uruchomienie komputera może być wymagane.</p>
        </div></div></div></div>
<p class="para">
        To match the Samba configuration above the <span class="em emphasis">sysadmin</span> group will be given read, write, and execute
        permissions to <span class="file filename">/srv/samba/share</span>, the <span class="em emphasis">qa</span> group will be given read and execute
        permissions, and the files will be owned by the username <span class="em emphasis">melissa</span>.  Enter the following in a 
        terminal:
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R melissa /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
          <p class="para">
          The <span class="app application">setfacl</span> command above gives <span class="em emphasis">execute</span> permissions to all files in
          the <span class="file filename">/srv/samba/share</span> directory, which you may or may not want.
          </p>
        </div></div></div></div>
<p class="para">
        Now from a Windows client you should notice the new file permissions are implemented.  See the 
        <span class="app application">acl</span> and <span class="app application">setfacl</span> man pages for more information on POSIX ACLs.
        </p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Profil Samba AppArmor</h2></div>
<div class="region"><div class="contents">
<p class="para">
      Ubuntu comes with the <span class="app application">AppArmor</span> security module, which provides mandatory access controls.
      The default AppArmor profile for Samba will need to be adapted to your configuration.  For more details on using
      AppArmor see <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.
      </p>
<p class="para">
      There are default AppArmor profiles for <span class="file filename">/usr/sbin/smbd</span> and <span class="file filename">/usr/sbin/nmbd</span>, the
      Samba daemon binaries, as part of the <span class="app application">apparmor-profiles</span> packages.  To install the package,
      from a terminal prompt enter:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Notatka"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Ten pakiet zawiera kilka profili innych binariów.</p>
      </div></div></div></div>
<p class="para">
      By default the profiles for <span class="app application">smbd</span> and <span class="app application">nmbd</span> are in 
      <span class="em emphasis">complain</span> mode allowing Samba to work without modifying the profile, and only logging errors.
      To place the <span class="app application">smbd</span> profile into <span class="em emphasis">enforce</span> mode, and have Samba work as 
      expected, the profile will need to be modified to reflect any directories that are shared.
      </p>
<p class="para">Edytuj plik <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> dodając sekcję <span class="em emphasis">[share]</span> z przykładu serwera plików:</p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
  /srv/samba/share/** rwkix,
</pre></div>
<p class="para">Teraz umieść profil w <span class="em emphasis">enforce</span> i przeładuj:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">
      You should now be able to read, write, and execute files in the shared directory as normal, and the
      <span class="app application">smbd</span> binary will have access to only the configured files and directories.  
      Be sure to add entries for each directory you configure Samba to share.  Also, any errors will be logged
      to <span class="file filename">/var/log/syslog</span>.  
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Zasoby</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">
          For in depth Samba configurations see the 
          <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Samba HOWTO Collection</a>
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">Przewodnik jest również dostępny w <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">formie drukowanej</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> wydawnictwa O'Reilly to również dobra pozycja.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html">Chapter 18</a> 
          of the Samba HOWTO Collection is devoted to security.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          For more information on Samba and ACLs see the
          <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568">Samba ACLs page
          </a>.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          The <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Ubuntu Wiki Samba </a> page.
          </p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Print Server">Poprzednia</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Następna</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
