<!DOCTYPE html>
<html lang=pt>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Securing File and Print Server</title>
<link rel="stylesheet" type="text/css" href="pt.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../14.04" class="trail">Ubuntu 14.04</a> » <a class="trail" href="index.html" title="Guia do Servidor Ubuntu">Guia do Servidor Ubuntu</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Servidor de Impressão">Anterior</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Seguinte</a>
</div>
<div class="hgroup"><h1 class="title">Securing File and Print Server</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Modos de segurança do Samba">Modos de segurança do Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Segurança = Utilizador">Segurança = Utilizador</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Segurança da Partilha">Segurança da Partilha</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Perfil AppArmor do Samba">Perfil AppArmor do Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Recursos">Recursos</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Modos de segurança do Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Existem dois níveis de segurança disponíveis no protocolo de rede do Sistema de Arquivos Comum da Internet (CIFS - Common Internet Filesystem) <span class="em emphasis">nível-usuário</span> e <span class="em emphasis">nível-compartilhado</span>. Implementação do <span class="em emphasis">modo de segurança</span> do Samba permite mais flexibilidade, fornecendo quatro modos de implementação de segurança no nível-usuário e um modo para implementar o nível-compartilhado:</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = user:</span> requer que os clientes forneçam um nome de utilizador e uma palavra-passe para se ligarem a partilhas. As contas de utilizadores de Samba são separadas das contas do sistema, mas o pacote <span class="app application">libpam-smbpass</span> irá sincronizar os utilizadores e palavras-passe do sistema com a base de dados de utilizadores do Samba.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">segurança = domínio:</span> este modo permite ao servidor Samba aparecer em clientes Windows como um Controlador de Domínio Primário (PDC), Controlador de Domínio de Reserva (BDC), ou um Servidor de Membro de Domínio (DMS). Consulte <a class="xref" href="samba-dc.html" title="As a Domain Controller">As a Domain Controller</a> para mais informações.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">segurança = ADS:</span> permite ao servidor Samba juntar-se a um domínio de  Pasta Activa como um membro nativo. Consulte <a class="xref" href="samba-ad-integration.html" title="Active Directory Integration">Active Directory Integration</a> para detalhes.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">segurança = servidor:</span> este modo é deixado pelo Samba antes deste se tornar um servidor membro, e devido a alguns problemas de segurança não deve ser utilizado. Consulte a secção <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531">Segurança do Servidor</a> no guia do Samba para mais detalhes.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">segurança = partilha:</span> permite a clientes ligarem-se a partilhas sem fornecerem um nome de utilizador e palavra-passe.</p>
        </li>
</ul></div>
<p class="para">O modo de segurança que você escolhe irá depender do seu ambiente e daquilo que precisa que o servidor Samba faça.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Segurança = Utilizador</h2></div>
<div class="region"><div class="contents">
<p class="para">Esta secção vai reconfigurar o ficheiro Samba e o servidor de impressão, a partir de <a class="xref" href="samba-fileserver.html" title="File Server">File Server</a> e <a class="xref" href="samba-printserver.html" title="Servidor de Impressão">Servidor de Impressão</a>, para requerer autenticação.</p>
<p class="para">Primeiro, instale o pacote <span class="app application">libpam-smbpass</span>, o qual vai sincronizar os utilizadores do sistema com a base de dados de utilizadores do Samba:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install libpam-smbpass</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Caso tenha escolhido a tarefa do <span class="em emphasis">Servidor Samba</span> durante a instalação, a aplicação <span class="app application">libpam-smbpass</span> já está instalada.</p>
      </div></div></div></div>
<p class="para">Edite <span class="file filename">/etc/samba/smb.conf</span>, e na secção <span class="em emphasis">[share]</span>, altere:</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Finalmente, reinicie o Samba para as novas configurações terem efeito:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<p class="para">Agora quando conectar ao directório compartilhado ou impressora, será solicitado que você introduza um nome de utilizador e a senha.</p>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Se escolher mapear uma unidade de rede, pode assinalar a caixa <span class="quote">“Reconectar no Início de Sessão”</span>, o que necessitará que introduza o seu nome de utilizador e senha, pelo menos até à senha alterar.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Segurança da Partilha</h2></div>
<div class="region">
<div class="contents"><p class="para">Existem diversas opções disponíveis para aumentar a segurança para cada pasta partilhada. Esta secção aborda algumas opções comuns utilizando o exemplo <span class="em emphasis">[share]</span>.</p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Grupos</h3></div>
<div class="region"><div class="contents">
<p class="para">Os Grupos definem um conjunto de computadores ou de utilizadores com um nível de acesso comum a um recurso particular da rede e oferece um nível de granularidade no controlo de acesso a esses recursos. Por exemplo, se um grupo <span class="em emphasis">qa</span> estiver definido e contiver os utilizadores <span class="em emphasis">freda</span>, <span class="em emphasis">danika</span>, e <span class="em emphasis">rob</span>, e um segundo grupo <span class="em emphasis">support</span> estiver definido e contiver os utilizadores <span class="em emphasis">danika</span>, <span class="em emphasis">jeremy</span> e <span class="em emphasis">vincent</span>, então alguns recursos de rede configurados para permitirem o acesso pelo grupo <span class="em emphasis">qa</span> permitirão o acesso de freda, danika, e rob, mas não de jeremy ou vincent. Dado que a utilizadora <span class="em emphasis">danika</span> pertence a ambos os grupos, <span class="em emphasis">qa</span> e <span class="em emphasis">support</span>role="italic"&gt;support</p>
<p class="para">Por defeito, o Samba pesquisa os grupos de sistema locais definidos em <span class="file filename">/etc/grouppara determinar a que grupo pertence cada utilizador. Para mais informa.</span></p>
<p class="para">Ao definir grupos no ficheiro de configuração do Samba, <span class="file filename">/etc/samba/smb.conf</span>, a sintaxe reconhecida é adicionar o prefixo "@" ao nome do grupo. Por exemplo se pretender definir um grupo chamado <span class="em emphasis">adminsist</span> numa determinada secção do <span class="file filename">/etc/samba/smb.conf</span>, pode fazer isto digitando o nome do grupo da seguinte forma <span class="em em-bold emphasis">@adminsis</span>.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Permissões de Ficheiros</h3></div>
<div class="region"><div class="contents">
<p class="para">As Permissões de Ficheiro definem os direitos explícitos que um computador ou utilizador tem sobre uma determinada pasta, ficheiro, ou conjunto de ficheiros. Essas permissões podem ser definidas editando o ficheiro <span class="file filename">/etc/samba/smb.conf</span> e especificando as permissões de ficheiro de uma determinada partilha de ficheiro.</p>
<p class="para">Por exemplo, se tiver uma partilha SAMBA chamada <span class="em emphasis">partilha</span> e quiser dar permissões <span class="em emphasis">read-only</span> (só-leitura) aos utilizadores que façam parte do grupo <span class="em emphasis">grupo1</span>, e ao mesmo tempo quiser que os membros do grupo <span class="em emphasis">adminsis</span> e o o utilizador <span class="em emphasis">vicente</span> possam escrever nessa partilha .... então pode editar o ficheiros <span class="file filename">/etc/samba/smb.conf</span> e adicionar a seguinte entrada na secção <span class="em emphasis">[partilha]</span> :</p>
<div class="code"><pre class="contents ">    lista de leitura = @qa
    lista de escrita = @sysadmin, vincent
</pre></div>
<p class="para">Outra possibilidade de permissão no SAMBA é declarar permissões <span class="em emphasis">administrativas</span> para um determinado recurso partilhado. Os utilizadores que tenham essas permissões administrativas podem ler, escrever e/ou modificar todas as informações contidas no recurso partilhado, para o qual o utilizador recebeu permissões administrativas explícitas.</p>
<p class="para">Por exemplo, se você quiser dar à utilizadora <span class="em emphasis">melissa</span> permissões administrativas no exemplo de <span class="em emphasis">partilha</span>, pode editar o ficheiro <span class="file filename">/etc/samba/smb.conf</span>, e adicionar o seguinte sob a entrada <span class="em emphasis">[partilha]</span>:</p>
<div class="code"><pre class="contents ">    admin users = melissa
</pre></div>
<p class="para">Depois de editar <span class="file filename">/etc/samba/smb.conf</span>, reinicie o Samba para as mudanças terem efeito:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo restart smbd</span>
<span class="cmd command">sudo restart nmbd</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Para que a <span class="em emphasis">lista de leitura</span> e a <span class="em emphasis">lista de escrita</span> funcionem, o modo de segurança do Samba <span class="em emphasis">não</span> deve ser definido para <span class="em emphasis">segurança = partilha</span></p>
        </div></div></div></div>
<p class="para">Agora que o Samba foi configurado para limitar os grupos que podem aceder à pasta partilhada, é necessário actualizar as permissões do sistema de ficheiros.</p>
<p class="para">As permissões tradicionais em Linux não fazem muito bem a correspondência com a as Listas de Controlo de Acesso do Windows NT (adiante designadas por ACL - Access Control Lists). Por sorte, as ACL's POSIX estão disponíveis nos servidores Ubuntu para fornecer um controlo mais detalhado. Por exemplo, para activar as ACL's no directório <span class="file filename">/srv</span> de um sistema de ficheiros EXT3, edite o <span class="file filename">/etc/fstab</span> e adicione a opção <span class="em emphasis">acl</span>:</p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv ext3 noatime,relatime,acl 0 1
</pre></div>
<p class="para">Depois remonte a partição:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">O exemplo acima assume <span class="file filename">/srv</span> numa partição separada. Se <span class="file filename">/srv</span>, ou onde quer que tenha configurado o seu caminho de partilha,  for parte da partição <span class="file filename">/</span>, poderá ser necessário um reinício do computador.</p>
        </div></div></div></div>
<p class="para">Para corresponder à configuração SAMBA indicada acima, 
- o grupo <span class="em emphasis">adminsis</span> irá receber permissões de leitura, escrita e execução para a <span class="file filename">/srv/samba/partilha</span>;
- o grupo <span class="em emphasis">grupo1</span> irá receber permissões de leitura e execução;
- os ficheiros serão propriedade do utilizador <span class="em emphasis">melissa</span>. Digite o seguinte comando no Terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R melissa /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">O comando <span class="app application">setfacl</span> dá permissões de <span class="em emphasis">execução</span> a todos os ficheiros na pasta <span class="file filename">/srv/samba/share</span>, algo que poderá desejar (ou não).</p>
        </div></div></div></div>
<p class="para">Agora, a partir de um cliente Windows, poderá verificar que as novas permissões de ficheiro já foram implementadas. Vejas as páginas man do <span class="app application">acl</span> e do <span class="app application">setfacl</span> para mais informações acerca de ACLs POSIX.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Perfil AppArmor do Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">
      Ubuntu comes with the <span class="app application">AppArmor</span> security module, which provides mandatory access controls.
      The default AppArmor profile for Samba will need to be adapted to your configuration.  For more details on using
      AppArmor see <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.
      </p>
<p class="para">
      There are default AppArmor profiles for <span class="file filename">/usr/sbin/smbd</span> and <span class="file filename">/usr/sbin/nmbd</span>, the
      Samba daemon binaries, as part of the <span class="app application">apparmor-profiles</span> packages.  To install the package,
      from a terminal prompt enter:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt-get install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Este pacote contém perfis para outros binários.</p>
      </div></div></div></div>
<p class="para">
      By default the profiles for <span class="app application">smbd</span> and <span class="app application">nmbd</span> are in 
      <span class="em emphasis">complain</span> mode allowing Samba to work without modifying the profile, and only logging errors.
      To place the <span class="app application">smbd</span> profile into <span class="em emphasis">enforce</span> mode, and have Samba work as 
      expected, the profile will need to be modified to reflect any directories that are shared.
      </p>
<p class="para">Edite <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> juntando informação para a <span class="em emphasis">[partilha]</span> a partir do exemplo do servidor de ficheiros:</p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
  /srv/samba/share/** rwkix,
</pre></div>
<p class="para">Agora coloque o perfil em <span class="em emphasis">enforce</span> e recarregue-o:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">
      You should now be able to read, write, and execute files in the shared directory as normal, and the
      <span class="app application">smbd</span> binary will have access to only the configured files and directories.  
      Be sure to add entries for each directory you configure Samba to share.  Also, any errors will be logged
      to <span class="file filename">/var/log/syslog</span>.  
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Recursos</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Para configurações mais aprofundadas do Samba consultar a <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Colecção Samba HOWTO</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">O guia também está disponível em <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">formato impresso</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">O'Reilly's <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> é também uma boa referência.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">O <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html">capítulo 18</a> da Colecção Samba HOWTO é dedicado à segurança.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Para mais informações sobre o Samba e ACLs consulte a <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568">página de ACLs do Samba </a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">A página web <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Ubuntu Wiki Samba </a>, em inglês.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Servidor de Impressão">Anterior</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Seguinte</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
