<!DOCTYPE html>
<html lang=fr>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Installation avancée</title>
<link rel="stylesheet" type="text/css" href="fr.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Guide du serveur Ubuntu">Guide du serveur Ubuntu</a> » <a class="trail" href="installation.html" title="Installation">Installation</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="installing-upgrading.html" title="Mise à niveau">Précédent</a><a class="nextlinks-next" href="kernel-crash-dump.html" title="Kernel Crash Dump">Suivant</a>
</div>
<div class="hgroup"><h1 class="title">Installation avancée</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="advanced-installation.html#software-raid" title="RAID logiciel">RAID logiciel</a></li>
<li class="links"><a class="xref" href="advanced-installation.html#lvm" title="Gestionnaire de volumes logiques (Logical Volume Manager, LVM)">Gestionnaire de volumes logiques (Logical Volume Manager, LVM)</a></li>
<li class="links"><a class="xref" href="advanced-installation.html#iscsi" title="iSCSI">iSCSI</a></li>
</ul></div>
<div class="sect2 sect" id="software-raid"><div class="inner">
<div class="hgroup"><h2 class="title">RAID logiciel</h2></div>
<div class="region">
<div class="contents">
<p class="para">
        Redundant Array of Independent Disks "RAID" is a method of using multiple disks to provide different balances of
        increasing data reliability and/or increasing input/output performance, depending on the RAID level being used.
        RAID is implemented in either software 
        (where the operating system knows about both drives and actively maintains both of them) or hardware 
        (where a special controller makes the OS think there's only one drive and maintains the drives 'invisibly').
        </p>
<p class="para">Le logiciel RAID inclut dans les versions actuelles de Linux (dont Ubuntu) est basé sur le pilote <span class="app application">'mdadm'</span> et fonctionne très bien, et même mieux que la plupart des soi-disant « contrôleurs matériels RAID ». Cette section vous aidera à installer l'Édition Serveur d'Ubuntu en utilisant  deux partitions RAID1 avec deux disques durs, une partition pour <span class="em emphasis">/</span>, une autre pour <span class="em emphasis">swap</span>.</p>
</div>
<div class="sect3 sect" id="raid-partitioning"><div class="inner">
<div class="hgroup"><h3 class="title">Partitionnement</h3></div>
<div class="region"><div class="contents">
<p class="para">Suivez les étapes d'installation jusqu'à l'étape de <span class="em emphasis">Partitionnement des disques</span>, puis :</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
 
              <p class="para">Sélectionnez <span class="em emphasis">Manuel</span> comme méthode de partitionnement.</p>

            </li>
<li class="steps">
 
              <p class="para">Sélectionnez le disque racine, et acceptez de <span class="em emphasis">« Créer une nouvelle table de partition sur ce périphérique ? »</span>.</p>

              <p class="para">Répétez cette étape pour chaque disque que vous souhaitez inclure dans la matrice RAID.</p>

            </li>
<li class="steps">
 
              <p class="para">Sélectionner l'<span class="em emphasis">« Espace libre »</span> du premier disque, appuyez sur entrée puis choisissez <span class="em emphasis">« Créer une nouvelle partition »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Fixez ensuite la <span class="em emphasis">Taille</span> de la partition. Elle sera utilisée pour le <span class="em emphasis">swap</span>. Il est généralement recommandé de fixer la taille du fichier d'échange (swap) comme étant égale à deux fois celle de votre mémoire vive (RAM). Saisissez le nombre désiré, appuyez sur entrée, choisissez  <span class="em emphasis">Primaire</span> puis <span class="em emphasis">Début</span>.</p>

              <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
                <p class="para">Une partition d'échange de deux fois la taille de la RAM n'est pas forcement souhaitable, spécialement sur les systèmes dotés d'une grande quantité de RAM. Le calcul de la taille de la partition d’échange pour les serveurs dépend de la façon dont le système sera utilisé.</p>
              </div></div></div></div>

            </li>
<li class="steps">
 
              <p class="para">
              Select the <span class="em emphasis">"Use as:"</span> line at the top.  By default this is 
              <span class="em emphasis">"Ext4 journaling file system"</span>, change that to <span class="em emphasis">"physical volume for RAID"</span>
              then <span class="em emphasis">"Done setting up partition"</span>. 
              </p>

            </li>
<li class="steps">
 
              <p class="para">Agissez de manière similaire pour la partition <span class="em emphasis">/</span>. Sélectionnez l'<span class="em emphasis">« Espace libre »</span> du premier disque, appuyez sur entrée puis choisissez <span class="em emphasis">« Créer une nouvelle partition »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Utilisez l'espace libre restant et choisissez <span class="em emphasis">Continuer</span>, puis <span class="em emphasis">Primaire</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">
              As with the swap partition, select the <span class="em emphasis">"Use as:"</span> line at the 
              top, changing it to <span class="em emphasis">"physical volume for RAID"</span>. Also select the 
              <span class="em emphasis">"Bootable flag:"</span> line to change the value to 
              <span class="em emphasis">"on"</span>. Then choose <span class="em emphasis">"Done setting up partition"</span>. 
              </p>

            </li>
<li class="steps">
 
              <p class="para">Répétez les étapes trois à huit pour les autres disques et partitions que vous souhaitez créer.</p>

            </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect3 sect" id="raid-configuration"><div class="inner">
<div class="hgroup"><h3 class="title">Configuration du RAID</h3></div>
<div class="region"><div class="contents">
<p class="para">Une fois les partitions configurées, les matrices sont prêtes à être paramétrées :</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
 
              <p class="para">Retournez à la page principale de « Partitionner les disques » et sélectionnez en haut <span class="em emphasis">« Configurer le RAID logiciel »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Sélectionnez <span class="em emphasis">« Oui »</span> pour appliquer les changements au disque.</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez <span class="em emphasis">« Créer un périphérique MD »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Pour cet exemple, choisissez <span class="em emphasis">« RAID1 »</span>, mais si vous utilisez une autre configuration, choisissez un autre type (RAID0 RAID1 RAID5).</p>

              <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
                <p class="para">Au moins <span class="em emphasis">trois</span> disques sont nécessaires pour utiliser le <span class="em emphasis">RAID5</span>. Deux suffisent pour le <span class="em emphasis">RAID0</span> ou le <span class="em emphasis">RAID1</span>.</p>
              </div></div></div></div>

            </li>
<li class="steps">
 
              <p class="para">Saisissez le nombre de périphériques actifs <span class="em emphasis">« 2 »</span>, ou le nombre de disques dur que vous possédez pour la matrice. Ensuite, sélectionnez <span class="em emphasis">« Continuer »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Ensuite, saisissez le nombre de périphériques restants <span class="em emphasis">« 0 »</span> par défaut, puis, choisissez <span class="em emphasis">« Continuer »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez les partitions à utiliser (généralement sda1, sdb1, sdc1, etc.). Habituellement, les chiffres se correspondent et les différentes lettres correspondent à des disques différents.</p>

              <p class="para">Pour la partition <span class="em emphasis">swap</span> choisissez <span class="em emphasis">sda1</span> et <span class="em emphasis">sdb1</span>. Sélectionnez ensuite <span class="em emphasis">« Continuer »</span> pour vous rendre à l'étape suivante.</p>

            </li>
<li class="steps">
 
              <p class="para">Répétez les étapes <span class="em emphasis">trois</span> à <span class="em emphasis">sept</span> pour la partition <span class="em emphasis">/</span> en choisissant cette fois <span class="em emphasis">sda2</span> et <span class="em emphasis">sdb2</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Une fois fait, sélectionnez <span class="em emphasis">« Terminer »</span>.</p>

            </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect3 sect" id="raid-formatting"><div class="inner">
<div class="hgroup"><h3 class="title">Formatage</h3></div>
<div class="region"><div class="contents">
<p class="para">Vous avez maintenant une liste des disques durs ainsi que celle des périphériques RAID. Il faut alors les formater et leur assigner le(s) point(s) de montage. Considérez les ensembles RAID comme des partitions normales en ce qui concerne le formatage et le montage.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
 
              <p class="para">Sélectionnez <span class="em emphasis">« #1 »</span> sous la partition <span class="em emphasis">« RAID1 périphérique #0 »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez <span class="em emphasis">Utiliser comme :</span> suivi de <span class="em emphasis">espace d'échange (swap)</span> puis <span class="em emphasis">Fin de paramétrage de cette partition</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Ensuite, sélectionnez <span class="em emphasis">« #1 »</span> sous la partition <span class="em emphasis">« RAID1 périphérique #1 »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez <span class="em emphasis">« Utiliser en tant que : »</span>, puis sélectionnez <span class="em emphasis">« système de fichiers journalisé Ext4 »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez <span class="em emphasis">Point de montage</span> suivi de <span class="em emphasis">/ - système de fichiers racine</span>. Sélectionnez <span class="em emphasis">Fin de paramétrage de cette partition</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Pour finir sélectionnez <span class="em emphasis">Fin de paramétrage de cette partition et appliquer les changements</span> puis répondez <span class="em emphasis">Oui</span></p>

            </li>
</ol></div></div>
<p class="para">Si vous choisissez de placer la partition racine sur une matrice RAID, l'installateur vous demandera alors si vous voulez démarrer dans un état RAID <span class="em emphasis">dégradé</span>. Consultez <a class="xref" href="advanced-installation.html#raid-degraded" title="RAIS dégradé">RAIS dégradé</a> pour plus de renseignements.</p>
<p class="para">Le processus d'installation continuera ensuite normalement.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="raid-degraded"><div class="inner">
<div class="hgroup"><h3 class="title">RAIS dégradé</h3></div>
<div class="region"><div class="contents">
<p class="para">Au cours de la vie d'un ordinateur, une panne de disque dur peut survenir. Lorsque ceci arrive avec du RAID logiciel, les système d'exploitation placera la matrice RAID dans un état que l'on appelle <span class="em emphasis">dégradé</span>.</p>
<p class="para">Si la matrice est endommagée, en raison de la possibilité de corruption de données, l'Edition Serveur d'Ubuntu démarrera par défaut vers <span class="em emphasis">initramfs</span> au bout de trente secondes. Une fois que initramfs aura démarré, une invite sera affichée pendant quinze secondes vous donnant la possibilité de continuer et d'amorcer le système, ou de tenter de faire une récupération manuelle. Démarrer sur initramfs peut être ou non le comportement désiré, surtout si la machine est située dans un endroit éloigné. Le lancement d'une matrice endommagée peut être configuré de plusieurs manières :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">

              <p class="para">L'outil <span class="app application">dpkg-reconfigure</span> peut être utilisé pour paramétrer le comportement par défaut. Durant ce processus, vous aurez à choisir de nouvelles options (surveillance, alertes par courriel etc.) concernant la matrice. Pour configurer à nouveau <span class="app application">mdadm</span>, saisissez :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo dpkg-reconfigure mdadm</span>
</pre></div>

             </li>
<li class="list itemizedlist">

              <p class="para">Le processus <span class="cmd command">dpkg-reconfigure mdadm</span> changera le contenu du fichier de configuration <span class="file filename">/etc/initramfs-tools/conf.d/mdadm</span>. Ce fichier a l'avantage de pouvoir pré-configurer le comportement de votre système et il peut également être modifié manuellement :</p>

<div class="code"><pre class="contents ">BOOT_DEGRADED=true
</pre></div>

          <div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Le fichier de configuration peut être outrepassé en utilisant un argument de noyau.</p>
          </div></div></div></div>          

            </li>
<li class="list itemizedlist">
    
              <p class="para">Donner un argument au noyau autorisera également le système à démarrer sur une matrice RAID endommagée :</p>

              <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
                  <p class="para">Lorsque le serveur démarre, pressez <span class="key keycap"><kbd>Maj</kbd></span> pour ouvrir le menu <span class="app application">Grub</span>.</p>
                </li>
<li class="list itemizedlist">
                  <p class="para">Appuyez sur <span class="key keycap"><kbd>e</kbd></span> pour modifier vos options de commande noyau.</p>
                </li>
<li class="list itemizedlist">
                  <p class="para">Appuyez sur la flèche <span class="key keycap"><kbd>bas</kbd></span> pour mettre en surbrillance la ligne du noyau.</p>
                </li>
<li class="list itemizedlist">
                  <p class="para">Ajoutez <span class="em emphasis">"bootdegraded=true"</span> (sans les guillemets) en fin de ligne.</p>
                </li>
<li class="list itemizedlist">
                  <p class="para">Appuyez sur <span class="keyseq keycombo"><span class="key keycap"><kbd>Ctrl</kbd></span>+<span class="key keycap"><kbd>x</kbd></span></span> pour démarrer le système.</p>
                </li>
</ul></div>

            </li>
</ul></div>
<p class="para">Une fois le système démarré, vous pouvez réparer la matrice (voir <a class="xref" href="advanced-installation.html#raid-maintenance" title="Maintenance RAID">Maintenance RAID</a> pour de plus amples informations) ou transférez les données importantes vers un autre machine en cas de panne matérielle majeure.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="raid-maintenance"><div class="inner">
<div class="hgroup"><h3 class="title">Maintenance RAID</h3></div>
<div class="region"><div class="contents">
<p class="para">L'utilitaire <span class="app application">mdadm</span> peut être utilisé pour afficher l'état d'une matrice, ajouter des disques à une matrice, en supprimer etc... :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para">Pour afficher l'état d'une matrice, depuis un terminal entrez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mdadm -D /dev/md0</span>
</pre></div>
            
              <p class="para">L'option <span class="em emphasis">-D</span> ordonne à <span class="app application">mdadm</span> d'afficher les informations <span class="em emphasis">détaillées</span>  du périphérique <span class="file filename">/dev/md0</span>. Remplacez <span class="file filename">/dev/md0</span> par le périphérique RAID souhaité.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">Pour afficher l'état d'un disque d'une matrice, écrivez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mdadm -E /dev/sda1</span>
</pre></div>
              <p class="para">Le résultat est très similaire à celui de la commande <span class="cmd command">mdadm -D</span>, modifiez <span class="file filename">/dev/sda1</span> à votre convenance pour chaque disque.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">Si un disque devient défectueux et doit être retiré d'une matrice, entrez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mdadm --remove /dev/md0 /dev/sda1</span>
</pre></div>
              <p class="para">Changez <span class="file filename">/dev/md0</span> et <span class="file filename">/dev/sda1</span> par les périphériques et les disques RAID appropriés.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">De la même manière, pour ajouter un disque :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mdadm --add /dev/md0 /dev/sda1</span>
</pre></div>
            </li>
</ul></div>
<p class="para">Il peut arriver qu'un disque change d'état et soit décrit comme <span class="em emphasis">défectueux</span> bien qu'il n'y ait aucun problème physique. Dans ce cas, il est généralement utile de le retirer de la matrice et de l'ajouter à nouveau. Cela forcera une synchronisation de la matrice. Si le disque ne se synchronise pas, alors il y a de fortes chances pour qu'il s'agisse d'une panne matérielle.</p>
<p class="para">Le fichier <span class="file filename">/proc/mdstat</span> contient également des informations utiles concernant les périphériques RAID du système.</p>
<div class="screen"><pre class="contents "><span class="cmd command">cat /proc/mdstat</span>
<span class="output computeroutput">Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
md0 : active raid1 sda1[0] sdb1[1]
      10016384 blocks [2/2] [UU]
      
unused devices: &lt;none&gt;</span>
</pre></div>
<p class="para">La commande suivante est très utile pour surveiller l'état d'avancement d'une synchronisation de disque :</p>
<div class="screen"><pre class="contents "><span class="cmd command">watch -n1 cat /proc/mdstat</span>
</pre></div>
<p class="para">Appuyez sur <span class="em emphasis">Ctrl+c</span> pour arrêter la commande <span class="app application">watch</span>.</p>
<p class="para">Une fois qu'un disque défectueux a été remplacé par un disque en bon état et que celui-ci a été synchronisé, vous devez installer <span class="app application">grub</span>. Pour l'installer sur le nouveau disque, saisissez :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo grub-install /dev/md0</span>
</pre></div>
<p class="para">Remplacez <span class="file filename">/dev/md0</span> par le nom du périphérique approprié.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="raid-resources"><div class="inner">
<div class="hgroup"><h3 class="title">Ressources</h3></div>
<div class="region"><div class="contents">
<p class="para">Les matrices RAID sont un sujet complexe en raison de la multitude de façons de paramétrer le RAID. Consultez les liens suivants pour plus d'informations :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><a href="https://help.ubuntu.com/community/Installation#raid" class="ulink" title="https://help.ubuntu.com/community/Installation#raid">Articles du Wiki Ubuntu sur RAID (en anglais)</a>.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              <a href="http://www.faqs.org/docs/Linux-HOWTO/Software-RAID-HOWTO.html" class="ulink" title="http://www.faqs.org/docs/Linux-HOWTO/Software-RAID-HOWTO.html">Guide pratique du RAID logiciel</a>
              </p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              <a href="http://oreilly.com/catalog/9781565927308/" class="ulink" title="http://oreilly.com/catalog/9781565927308/">Gérer le RAID sous LInux</a>
              </p>
            </li>
</ul></div>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="lvm"><div class="inner">
<div class="hgroup"><h2 class="title">Gestionnaire de volumes logiques (Logical Volume Manager, LVM)</h2></div>
<div class="region">
<div class="contents"><p class="para">Le gestionnaire de volumes logiques, ou <span class="em emphasis">LVM</span>, permet aux administrateurs de créer des volumes <span class="em emphasis">logiques</span> à partir d'un ou plusieurs espaces de stockage. Les volumes LVM peuvent être créés sur des partitions RAID logicielles ou sur des partitions normales résidant sur un unique disque. Les volumes peuvent être dimensionnés après-coup, donnant ainsi une plus grande flexibilité au système.</p></div>
<div class="sect3 sect" id="lvm-overview"><div class="inner">
<div class="hgroup"><h3 class="title">Aperçu</h3></div>
<div class="region"><div class="contents">
<p class="para">Un effet secondaire de la puissance et de la flexibilité de LVM est un degré accru de complexité. Avant de se plonger dans le processus d'installation de LVM, il est préférable de se familiariser avec quelques termes techniques.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">Volume physique (PV) :</span> disque dur physique, partition de disque ou partition RAID logicielle au format LVM PV.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">Groupe de volumes (VG) :</span> il est fait à partir d'un ou plusieurs volumes physiques. Un VG peut être étendu en ajoutant plus de volumes physiques (PV). Un VG est comme un disque dur virtuel, à partir duquel un ou plusieurs volumes logiques sont découpés.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">Volume logique (LV) :</span> est similaire à une partition dans un système sans LVM. Un LV est formaté avec le système de fichier de votre choix (EXT3, XFS, JFS, etc), il est alors disponible pour le montage et le stockage des données.</p>
            </li>
</ul></div>
</div></div>
</div></div>
<div class="sect3 sect" id="lvm-installation"><div class="inner">
<div class="hgroup"><h3 class="title">Installation</h3></div>
<div class="region"><div class="contents">
<p class="para">À titre d'exemple, cette section décrit l'installation d'Ubuntu édition serveur en montant <span class="file filename">/srv</span> sur un volume LVM. Lors de l'installation initiale, un seul volume physique (PV) fera partie du groupe de volumes (VG). Un autre PV lui sera affecté plus tard pour montrer comment un VG peut être agrandi.</p>
<p class="para">Plusieurs méthodes d'installation sont disponibles pour LVM : <span class="em emphasis">Assistée - utiliser tout un disque avec LVM</span>, <span class="em emphasis">Assistée - utiliser tout un disque avec LVM chiffré</span> et <span class="em emphasis">Manuelle</span>. Pour l'instant l'approche manuelle est la seule option nous permettant de paramétrer des partitions usuelles et LVM.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

              <p class="para">Suivez les étapes d'installation jusqu'à l'étape de <span class="em emphasis">Partitionnement des disques</span>, puis :</p>

            </li>
<li class="steps">
 
              <p class="para">Choisissez <span class="em emphasis">Manuel</span> à l'étape <span class="em emphasis">Partitionner les disques</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Sélectionnez votre disque et répondez oui à la question <span class="em emphasis">Faut-il créer une nouvelle table de partitions sur ce disque</span> de l'écran suivant.</p>

            </li>
<li class="steps">
 
              <p class="para">Créez ensuite trois partitions usuelles <span class="em emphasis">/boot</span>, <span class="em emphasis">swap</span> et <span class="em emphasis">/</span> avec le système de fichiers de votre choix.</p>

            </li>
<li class="steps">
 
              <p class="para">Pour le LVM <span class="em emphasis">/srv</span>, créez une nouvelle partition <span class="em emphasis">logique</span> puis sélectionner <span class="em emphasis">« volume physique pour LVM »</span> dans l'option <span class="em emphasis">« utiliser comme »</span> et enfin <span class="em emphasis">« fin de paramétrage de cette partition »</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">Sélectionnez ensuite <span class="em emphasis">« Configurez le gestionnaire de volumes logiques (LVM) »</span> et répondez  <span class="em emphasis">« Oui »</span> pour appliquer les changements au disque.</p>

            </li>
<li class="steps">
 
              <p class="para">À l'écran suivant (<span class="em emphasis">Action de configuration de LVM</span>), choisissez <span class="em emphasis">Créer un groupe de volumes</span>. Saisissez un nom de volume (<span class="em emphasis">vg01</span> dans notre exemple) puis sélectionnez <span class="em emphasis">Continuer (appuyez sur entrée)</span>.
Choisissez ensuite le volume physique qui fera partie du groupe de volume avec la barre d'espace puis sélectionnez <span class="em emphasis">Continuer (appuyez sur entrée)</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">De retour à l'écran <span class="em emphasis">Action de configuration de LVM</span>, sélectionnez <span class="em emphasis">Créer un volume logique</span>. Sélectionnez le nouveau groupe de volumes et saisisez un nom pour le nouveau LV, <span class="em emphasis">srv</span> dans notre exemple. Utilisez la partition entière ou non, de toute façon cette taille peut être chngée par la suite gràce aux outils LVM. Choisissez <span class="em emphasis">Terminer</span> pour revenir à l'écran principal <span class="em emphasis">Partitionner les disques</span>.</p>

            </li>
<li class="steps">
 
              <p class="para">
              Now add a filesystem to the new LVM.  Select the partition under <span class="em emphasis">"LVM VG vg01, LV srv"</span>, or whatever name
              you have chosen, the choose <span class="em emphasis">Use as</span>.  Setup a file system as normal selecting <span class="em emphasis">/srv</span> as
              the mount point.  Once done, select <span class="em emphasis">"Done setting up the partition"</span>.
              </p>

            </li>
<li class="steps">
 
              <p class="para">Pour finir, sélectionnez <span class="em emphasis">« Terminer le partitionnement et appliquer les changements »</span>. Puis confirmez les modifications et continuez avec le reste de l'installation.</p>

            </li>
</ol></div></div>
<p class="para">Il existe des outils pratiques pour afficher des informations sur LVM :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist"><p class="para"><span class="em emphasis">pvdisplay:</span> affiche des nformations sur les Volumes Physiques.</p></li>
<li class="list itemizedlist"><p class="para"><span class="em emphasis">vgdisplay :</span> affiche les informations des groupes de volumes.</p></li>
<li class="list itemizedlist"><p class="para"><span class="em emphasis">lvdisplay:</span> affiche des informations sur les Volumes Logiques.</p></li>
</ul></div>
</div></div>
</div></div>
<div class="sect3 sect" id="lvm-extending"><div class="inner">
<div class="hgroup"><h3 class="title">Agrandir des groupes de volumes</h3></div>
<div class="region"><div class="contents">
<p class="para">
          Continuing with <span class="em emphasis">srv</span> as an LVM volume example, this section covers adding a second hard disk, creating
          a Physical Volume (PV), adding it to the volume group (VG), extending the logical volume <span class="file filename">srv</span>
          and finally extending the filesystem. This example assumes a second hard disk has been added to the system. In
          this example, this hard disk will be named <span class="file filename">/dev/sdb</span> and we will use the entire disk as a physical volume 
          (you could choose to create partitions and use them as different physical volumes)
          </p>
<div class="note note-warning" title="Avertissement"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Soyez sur que vous n'avez pas déjà un <span class="file filename">/dev/sdb</span> existant avant d’exécuter les commandes ci-dessous. Vous pourriez perdre des données si vous exécutez ces commandes sur un disque qui n'est pas vide.</p>
        </div></div></div></div>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
 
              <p class="para">Commencez par créer le volume physique. Depuis un terminal, lancez :</p>

                <div class="screen"><pre class="contents "><span class="cmd command">sudo pvcreate /dev/sdb</span>
                </pre></div>

            </li>
<li class="steps">

              <p class="para">Agrandissez maintenant le groupe de volumes (VG) :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo vgextend vg01 /dev/sdb</span>
</pre></div>

            </li>
<li class="steps">

              <p class="para">Servez-vous de <span class="app application">vgdisplay</span> pour afficher les extensions physiques libres (Free PE - Size). Prenons pour exemple un espace libre de 511 PE (équivalent à 2 Go pour une taille de PE égale à 4 Mo) et nous utiliserons entièrement cet espace.</p>

              <p class="para">Le volume logique (LV) peut désormais être agrandi par des méthodes différentes. Nous ne verrons que l'utilisation de PE pour étendre le volume logique (LV) :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo lvextend /dev/vg01/srv -l +511</span>
</pre></div>

              <p class="para">L'option <span class="em emphasis">-l</span> permet d'agrandir le volume logique LV en se servant de PE. L'option <span class="em emphasis">-L</span> utilise la taille en octets (Mo, Go, To ...).</p>

            </li>
<li class="steps">
 
              <p class="para">
              Even though you are supposed to be able to <span class="em emphasis">expand</span> an ext3 or ext4 filesystem without unmounting it first, 
              it may be a good practice to unmount it anyway and check the filesystem, so that you don't mess up the day you want to reduce
              a logical volume (in that case unmounting first is compulsory).
              </p>

              <p class="para">Les commandes suivantes sont pour un système de fichiers <span class="em emphasis">EXT3</span> ou <span class="em emphasis">EXT4</span>. Si vous utilisez un autre système de fichiers, il peut exister d'autres utilitaires disponibles.</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo umount /srv</span>
<span class="cmd command">sudo e2fsck -f /dev/vg01/srv</span>
</pre></div>

              <p class="para">L'option <span class="em emphasis">-f</span> de <span class="app application">e2fsck</span> force le contrôle, même si le système semble propre.</p>

            </li>
<li class="steps">
 
              <p class="para">Enfin, redimensionnez le système de fichiers :</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo resize2fs /dev/vg01/srv</span>
</pre></div>

            </li>
<li class="steps">
 
              <p class="para">Montez ensuite la partition et vérifiez sa taille.</p>

<div class="screen"><pre class="contents "><span class="cmd command">mount /dev/vg01/srv /srv &amp;&amp; df -h /srv</span>
</pre></div>

            </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect3 sect" id="lvm-resources"><div class="inner">
<div class="hgroup"><h3 class="title">Ressources</h3></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para">Voir les <a href="https://help.ubuntu.com/community/Installation#lvm" class="ulink" title="https://help.ubuntu.com/community/Installation#lvm">articles du Wiki Ubuntu sur LVM</a>.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">Consultez le <a href="http://tldp.org/HOWTO/LVM-HOWTO/index.html" class="ulink" title="http://tldp.org/HOWTO/LVM-HOWTO/index.html">guide pratique LVM</a> (en anglais) pour plus d'informations.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">Un autre bon article <a href="http://www.linuxdevcenter.com/pub/a/linux/2006/04/27/managing-disk-space-with-lvm.html" class="ulink" title="http://www.linuxdevcenter.com/pub/a/linux/2006/04/27/managing-disk-space-with-lvm.html">Managing Disk Space with LVM</a> (en anglais) sur le site linuxdevcenter.com de O'Reilly.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              For more information on <span class="app application">fdisk</span> see the
              <a href="http://manpages.ubuntu.com/manpages/xenial/en/man8/fdisk.8.html" class="ulink" title="http://manpages.ubuntu.com/manpages/xenial/en/man8/fdisk.8.html">fdisk man page</a>.
              </p>
            </li>
</ul></div></div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="iscsi"><div class="inner">
<div class="hgroup"><h2 class="title">iSCSI</h2></div>
<div class="region">
<div class="contents"><p class="para">The iSCSI protocol can be used to install Ubuntu on systems with
        or without hard disks attached.</p></div>
<div class="sect3 sect"><div class="inner">
<div class="hgroup"><h3 class="title">Installation on a diskless system</h3></div>
<div class="region"><div class="contents">
<p class="para">The first steps of a diskless iSCSI installation are identical
          to the <a class="xref" href="installing-from-cd.html" title="Installation">Installation</a> section up to "Hard drive
          layout".</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
              <p class="para">The installer will display a warning with the following
              message:</p>

              <div class="screen"><pre class="contents ">No disk drive was detected. If you know the name of the driver needed by your disk drive, you can select it from the list.</pre></div>
            </li>
<li class="steps">
              <p class="para">Select the item in the list titled <span class="em emphasis">login to iSCSI
              targets.</span></p>
            </li>
<li class="steps">
              <p class="para">You will be prompted to Enter an IP address to scan for
              iSCSI targets with a description of the format for the address.
              Enter the IP address for the location of your iSCSI target and
              navigate to <span class="em emphasis">&lt;continue&gt;</span> then hit
              <span class="key keycap"><kbd>ENTER</kbd></span></p>
            </li>
<li class="steps">
              <p class="para">If authentication is required in order to access the iSCSI
              device, provide the <span class="em emphasis">username</span> in the next
              field. Otherwise leave it blank.</p>
            </li>
<li class="steps">
              <p class="para">If your system is able to connect to the iSCSI provider, you
              should see a list of available iSCSI targets where the operating
              system can be installed. The list should be similar to the
              following :</p>

              <div class="screen"><pre class="contents ">Select the iSCSI targets you wish to use.

iSCSI targets on 192.168.1.29:3260:

[ ] iqn.2016-03.TrustyS-iscsitarget:storage.sys0

&lt;Go Back&gt;                          &lt;Continue&gt;

</pre></div>
            </li>
<li class="steps">
              <p class="para">Select the iSCSI target that you want to use with the space
              bar. Use the arrow keys to navigate to the target that you want to
              select.</p>
            </li>
<li class="steps">
              <p class="para">Navigate to <span class="em emphasis">&lt;Continue&gt;</span> and hit
              <span class="key keycap"><kbd>ENTER</kbd></span>.</p>
            </li>
</ol></div></div>
<p class="para">If the connection to the iSCSI target is successful, you will be
          prompted with the <span class="em emphasis">[!!] Partition disks</span>
          installation menu. The rest of the procedure is identical to any
          normal installation on attached disks. Once the installation is
          completed, you will be asked to reboot.</p>
</div></div>
</div></div>
<div class="sect3 sect"><div class="inner">
<div class="hgroup"><h3 class="title">Installation on a system with disk attached</h3></div>
<div class="region"><div class="contents">
<p class="para">Again, the iSCSI installation on a normal server with one or
          many disks attached is identical to the <a class="xref" href="installing-from-cd.html" title="Installation">Installation</a> section until we reach the disk
          partitioning menu. Instead of using any of the Guided selection, we
          need to perform the following steps :</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
              <p class="para">Navigate to the Manual menu entry</p>
            </li>
<li class="steps">
              <p class="para">Select the Configure iSCSI Volumes menu entry</p>
            </li>
<li class="steps">
              <p class="para">Choose the Log into iSCSI targets</p>
            </li>
<li class="steps">
              <p class="para">You will be prompted to Enter an IP address to scan for
              iSCSI targets. with a description of the format for the address.
              Enter the IP address and navigate to
              <span class="em emphasis">&lt;continue&gt;</span> then hit <span class="key keycap"><kbd>ENTER</kbd></span></p>
            </li>
<li class="steps">
              <p class="para">If authentication is required in order to access the iSCSI
              device, provide the <span class="em emphasis">username</span> in the next
              field or leave it blank.</p>
            </li>
<li class="steps">
              <p class="para">If your system is able to connect to the iSCSI provider, you
              should see a list of available iSCSI targets where the operating
              system can be installed. The list should be similar to the
              following :</p>

            <div class="screen"><pre class="contents ">Select the iSCSI targets you wish to use.

iSCSI targets on 192.168.1.29:3260:

[ ] iqn.2016-03.TrustyS-iscsitarget:storage.sys0

&lt;Go Back&gt;                          &lt;Continue&gt;
</pre></div>
            </li>
<li class="steps">
              <p class="para">Select the iSCSI target that you want to use with the space
              bar. Use the arrow keys to navigate to the target that you want to
              select</p>
            </li>
<li class="steps">
              <p class="para">Navigate to &lt;Continue&gt; and hit <span class="key keycap"><kbd>ENTER</kbd></span>.</p>
            </li>
<li class="steps">
              <p class="para">If successful, you will come back to the menu asking you to
              Log into iSCSI targets. Navigate to Finish and hit <span class="key keycap"><kbd>ENTER</kbd></span></p>
            </li>
</ol></div></div>
<p class="para">The newly connected iSCSI disk will appear in the overview
          section as a device prefixed with SCSI. This is the disk that you
          should select as your installation disk. Once identified, you can
          choose any of the partitioning methods.</p>
<div class="note note-warning" title="Avertissement"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Depending on your system configuration, there may be other
            SCSI disks attached to the system. Be very careful to identify the
            proper device before proceeding with the installation. Otherwise,
            irreversible data loss may result from performing an installation on
            the wrong disk.</p>
          </div></div></div></div>
</div></div>
</div></div>
<div class="sect3 sect"><div class="inner">
<div class="hgroup"><h3 class="title">Rebooting to an iSCSI target</h3></div>
<div class="region"><div class="contents">
<p class="para">The procedure is specific to your hardware platform. As an
          example, here is how to reboot to your iSCSI target using iPXE</p>
<div class="screen"><pre class="contents ">iPXE&gt; dhcp

Configuring (net0 52:54:00:a4:f2:a9)....... ok

iPXE&gt; sanboot iscsi:192.168.1.29::::iqn.2016-03.TrustyS-iscsitarget:storage.sys0
</pre></div>
<p class="para">If the procedure is successful, you should see the Grub menu
          appear on the screen.</p>
</div></div>
</div></div>
</div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="installing-upgrading.html" title="Mise à niveau">Précédent</a><a class="nextlinks-next" href="kernel-crash-dump.html" title="Kernel Crash Dump">Suivant</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
