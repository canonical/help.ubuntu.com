<!DOCTYPE html>
<html lang=de>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Shell-Skripte</title>
<link rel="stylesheet" type="text/css" href="de.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Ubuntu–Server-Leitfaden">Ubuntu–Server-Leitfaden</a> » <a class="trail" href="backups.html" title="Datensicherungen">Datensicherungen</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups.html" title="Datensicherungen">Zurück</a><a class="nextlinks-next" href="backups-shellscripts-rotation.html" title="Archiv-Rotation">Weiter</a>
</div>
<div class="hgroup"><h1 class="title">Shell-Skripte</h1></div>
<div class="region">
<div class="contents">
<p class="para">
    One of the simplest ways to backup a system is using a <span class="em emphasis">shell script</span>.  For example, a script can be used to configure 
    which directories to backup, and pass those directories as arguments to the <span class="app application">tar</span> utility, which creates
    an archive file. The archive file can then be moved or copied to another location.  The archive can also be created on a remote 
    file system such as an <span class="em emphasis">NFS</span> mount.
    </p>
<p class="para">
    The <span class="app application">tar</span> utility creates one archive file out of many files or directories.  <span class="app application">tar</span> 
    can also filter the files through compression utilities, thus reducing the size of the archive file.  
    </p>
</div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript" title="Ein einfaches Shell-Skript">Ein einfaches Shell-Skript</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-executing-shellscript" title="Das Skript ausführen">Das Skript ausführen</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript-archive-testing" title="Aus dem Archiv wiederherstellen.">Aus dem Archiv wiederherstellen.</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Referenzen">Referenzen</a></li>
</ul></div>
<div class="sect2 sect" id="backup-shellscript"><div class="inner">
<div class="hgroup"><h2 class="title">Ein einfaches Shell-Skript</h2></div>
<div class="region"><div class="contents">
<p class="para">Das folgende Shell-Skript benutzt <span class="app application">tar</span> um eine Archivdatei auf einem entfernt eingebundenem NFS-Dateisystem zu erstellen. Der Dateiname der Archivdatei wird von weiteren zusätzlichen Befehlszeilenwerkzeugen bestimmt.</p>
<div class="code"><pre class="contents ">#!/bin/bash
####################################
#
# Backup to NFS mount script.
#
####################################

# What to backup. 
backup_files="/home /var/spool/mail /etc /root /boot /opt"

# Where to backup to.
dest="/mnt/backup"

# Create archive filename.
day=$(date +%A)
hostname=$(hostname -s)
archive_file="$hostname-$day.tgz"

# Print start status message.
echo "Backing up $backup_files to $dest/$archive_file"
date
echo

# Backup the files using tar.
tar czf $dest/$archive_file $backup_files

# Print end status message.
echo
echo "Backup finished"
date

# Long listing of files in $dest to check file sizes.
ls -lh $dest
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$backup_files:</span> Eine Variable, welche die Ordner, die Sie sichern wollen, auflistet. Die Liste sollte Ihren Anforderungen angepasst werden.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para">
     	  <span class="em emphasis">$day:</span> a variable holding the day of the week (Monday, Tuesday, Wednesday, etc).  This is used to create 
          an archive file for each day of the week, giving a backup history of seven days.  There are other ways to accomplish
          this including using the <span class="app application">date</span> utility. 
          </p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$hostname:</span> Eine Variable, welche den <span class="em emphasis">kurzen</span> Hostnamen des Systems enthält. Die Verwendung des Hostnamens im Dateinamen des Archivs gibt Ihnen die Möglichkeit, die täglichen Archivdateien verschiedener Systeme in dem gleichem Ordner zu speichern.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$archive_file:</span> Der vollständige Dateiname des Archivs.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para">
   	  <span class="em emphasis">$dest:</span> destination of the archive file.  The directory needs to be created and in this case 
          <span class="em emphasis">mounted</span> before executing the backup script.  See <a class="xref" href="network-file-system.html" title="Network File System (NFS)">Network File System (NFS)</a> for details of
          using <span class="em emphasis">NFS</span>.
          </p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">status messages:</span> Optionale Nachrichten, die mit dem <span class="app application">echo</span>-Werkzeug auf der Befehlszeile ausgegeben werden.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">tar czf $dest/$archive_file $backup_files:</span> Der Befehl <span class="app application">tar</span>, welcher benutzt wird um die Archivdatei zu erstellen.</p>
  	  <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">           
              <p class="para"><span class="em emphasis">c:</span> Erstellt ein Archiv.</p>
            </li>
<li class="list itemizedlist">           
              <p class="para"><span class="em emphasis">z:</span> Komprimiert das Archiv mit dem <span class="app application">gzip</span>-Werkzeug.</p>
            </li>
<li class="list itemizedlist">           
              <p class="para">
      	      <span class="em emphasis">f:</span> output to an archive file.  Otherwise the <span class="app application">tar</span> output will be sent to STDOUT.
              </p>
            </li>
</ul></div>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">ls -lh $dest:</span> Die optionale Angabe gibt eine lange Auflistung (<span class="em emphasis">-l</span>) in für Menschen lesbarer Form (<span class="em emphasis">-h</span>) des Zielordners aus. Das ist praktisch, um schnell die Dateigröße der Archivdatei zu kontrollieren. Dieser Kontrolle sollte eine Überprüfung der Archivdatei nicht ersetzen.</p>
        </li>
</ul></div>
<p class="para">
      This is a simple example of a backup shell script; however there are many options that can be included in such a script.
      See <a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Referenzen">Referenzen</a> for links to resources providing more in-depth shell scripting information.
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="backup-executing-shellscript"><div class="inner">
<div class="hgroup"><h2 class="title">Das Skript ausführen</h2></div>
<div class="region">
<div class="contents"></div>
<div class="sect3 sect" id="backup-script-execute-shell"><div class="inner">
<div class="hgroup"><h3 class="title">Das Skript von einer Befehlszeile aus ausführen</h3></div>
<div class="region"><div class="contents">
<p class="para">
        The simplest way of executing the above backup script is to copy and paste the contents into a file.  <span class="file filename">backup.sh</span> 
        for example. The file must be made executable:
	</p>
<div class="screen"><pre class="contents "><span class="cmd command">chmod u+x backup.sh</span>
</pre></div>
<p class="para">
	Then from a terminal prompt:  
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo ./backup.sh</span>
</pre></div>
<p class="para">Das ist ein guter Weg, das Skript zu testen und sicherzustellen, dass alles wie geplant funktioniert.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="backup-script-execute-cron"><div class="inner">
<div class="hgroup"><h3 class="title">Das Skript mit Cron ausführen.</h3></div>
<div class="region"><div class="contents">
<p class="para">Das <span class="app application">cron</span>-Werkzeug kann benutzt werden, um das Skript automatisch auszuführen. Der <span class="app application">cron</span>-Dienst erlaubt es, Skripte oder Befehle zu festgelegten Zeiten auszuführen.</p>
<p class="para"><span class="app application">cron</span> wird durch Einträge in die Datei <span class="file filename">crontab</span> eingerichtet. Die Datei <span class="file filename">crontab</span> ist in Felder aufgeteilt:</p>
<div class="code"><pre class="contents "># m h dom mon dow   command
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">m:</span> minute the command executes on, between 0 and 59.
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">h:</span> hour the command executes on, between 0 and 23.
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">dom:</span> Der Tag im Monat, an welchem der Befehl ausgeführt wird.</p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">mon:</span> the month the command executes on, between 1 and 12.
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">dow:</span> the day of the week the command executes on, between 0 and 7. Sunday may be specified by using 0 or 7, both values are valid.
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">command:</span> Der Befehl, welcher ausgeführt wird.</p>
          </li>
</ul></div>
<p class="para">Um Einträge in der Datei <span class="file filename">crontab</span> zu ändern oder hinzuzufügen, sollte der Befehl <span class="app application">crontab -e</span> benutzt werden. Der Inhalt der Datei <span class="file filename">crontab</span> kann mit dem Befehl <span class="app application">crontab -l</span> angezeigt werden.</p>
<p class="para">Um das obige <span class="app application">backup.sh</span> -Skript mit <span class="app application">cron</span> auszuführen, geben Sie folgendes in eine Befehlszeile ein:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo crontab -e</span>
</pre></div>
<div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
	  <p class="para">Die Benutzung von <span class="app application">sudo</span> in Kombination mit dem Befehl <span class="app application">crontab -e</span> bewirkt, dass die crontab des <span class="em emphasis">root</span> Benutzers bearbeitet wird. Das ist notwendig, wenn Sie Ordner sichern wollen, auf die nur der root-Benutzer Zugriff hat.</p>
        </div></div></div></div>
<p class="para">Fügen Sie folgenden Eintrag zur <span class="file filename">crontab</span>-Datei hinzu:</p>
<div class="code"><pre class="contents "># m h dom mon dow   command
0 0 * * * bash /usr/local/bin/backup.sh
</pre></div>
<p class="para">Das <span class="app application">backup.sh</span>-Skript wird nun jeden Tag um 12:00 mittags ausgeführt.</p>
<div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
          <p class="para">
          The <span class="app application">backup.sh</span> script will need to be copied to the <span class="file filename">/usr/local/bin/</span> directory in order for 
          this entry to execute properly.  The script can reside anywhere on the file system, simply change the script path appropriately.
          </p>
        </div></div></div></div>
<p class="para">
        For more in-depth <span class="app application">crontab</span> options see <a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Referenzen">Referenzen</a>.
        </p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="backup-shellscript-archive-testing"><div class="inner">
<div class="hgroup"><h2 class="title">Aus dem Archiv wiederherstellen.</h2></div>
<div class="region"><div class="contents">
<p class="para">Wenn ein Archiv erstellt wurde, ist es wichtig, das Archiv zu überprüfen. Das Archiv kann geprüft werden, indem die Dateien, die es enthält, aufgelistet werden. Der beste Weg zum Überprüfen ist aber, eine Datei aus dem Archiv <span class="em emphasis">wiederherzustellen</span>.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">
          To see a listing of the archive contents.  From a terminal prompt type:
          </p>
<div class="screen"><pre class="contents "><span class="cmd command">tar -tzvf /mnt/backup/host-Monday.tgz</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">Um eine Datei aus dem Archiv in einen anderen Ordner wiederherzustellen, geben Sie folgendes ein:</p>
<div class="screen"><pre class="contents "><span class="cmd command">tar -xzvf /mnt/backup/host-Monday.tgz -C /tmp etc/hosts</span>
</pre></div>
          <p class="para">Die Option <span class="em emphasis">-C</span> des <span class="app application">tar</span>-Befehls leitet die entpackte Datei in den angegebenen Ordner um. Das obige Beispiel entpackt die Datei <span class="file filename">/etc/hosts</span> nach <span class="file filename">/tmp/etc/hosts</span>. <span class="app application">tar</span> stellt die enthaltene Ordnerstruktur wieder her.</p>
          <p class="para">Beachten Sie, dass das führende <span class="em emphasis">"/"</span> bei dem Pfad, in welchen wiederhergestellt werden soll, entfällt.</p>  
        </li>
<li class="list itemizedlist">
          <p class="para">Um alle Dateien aus dem Archiv wiederherzustellen, geben Sie folgendes ein:</p>
<div class="screen"><pre class="contents "><span class="cmd command">cd /</span>
<span class="cmd command">sudo tar -xzvf /mnt/backup/host-Monday.tgz</span>
</pre></div>
        </li>
</ul></div>
<div class="note" title="Anmerkung"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Das überschreibt die momentan auf dem Dateisystem vorhandenen Dateien.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="backup-shellscript-references"><div class="inner">
<div class="hgroup"><h2 class="title">Referenzen</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Weitere Informationen über Shell-Skripte finden Sie im <a href="http://tldp.org/LDP/abs/html/" class="ulink" title="http://tldp.org/LDP/abs/html/">Advanced Bash-Scripting Guide</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Das Buch <a href="http://safari.samspublishing.com/0672323583" class="ulink" title="http://safari.samspublishing.com/0672323583">Teach Yourself Shell Programming in 24 Hours</a> ist online verfügbar und eine sehr gute Quelle zu Shell-Skripten.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Die <a href="https://help.ubuntu.com/community/CronHowto" class="ulink" title="https://help.ubuntu.com/community/CronHowto">CronHowto -Seite</a> im Ubuntu-Wiki enthält Details über erweiterte <span class="app application">cron</span>-Optionen.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Weitere Informationen über <span class="app application">tar</span>-Optionen finden Sie im <a href="http://www.gnu.org/software/tar/manual/index.html" class="ulink" title="http://www.gnu.org/software/tar/manual/index.html">GNU tar Manual</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Der Wikipedia-Artikel <a href="http://en.wikipedia.org/wiki/Backup_rotation_scheme" class="ulink" title="http://en.wikipedia.org/wiki/Backup_rotation_scheme">Backup Rotation Scheme</a> (englisch) enthält Informationen über weitere Backup-Rotation-Schemata.</p>
        </li>
<li class="list itemizedlist">
        <p class="para">Das Shell-Skript benutzt <span class="app application">tar</span> um das Archiv zu erstellen, aber es gibt noch viele weitere Befehlszeilenwerkzeuge die dafür benutzt werden können, wie zum Beispiel:</p>
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><a href="http://www.gnu.org/software/cpio/" class="ulink" title="http://www.gnu.org/software/cpio/">cpio</a>: Wird benutzt, um Dateien in und von Archiven zu kopieren.</p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              <a href="http://www.gnu.org/software/coreutils/" class="ulink" title="http://www.gnu.org/software/coreutils/">dd</a>: part of the <span class="app application">coreutils</span> 
              package.  A low level utility that can copy data from one format to another.
              </p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              <a href="http://www.rsnapshot.org/" class="ulink" title="http://www.rsnapshot.org/">rsnapshot</a>: a file system snapshot utility used to create 
              copies of an entire file system. 
              </p>
            </li>
<li class="list itemizedlist">
              <p class="para">
              <a href="http://www.samba.org/ftp/rsync/rsync.html" class="ulink" title="http://www.samba.org/ftp/rsync/rsync.html">rsync</a>:
              a flexible utility used to create incremental copies of files.
              </p>
            </li>
</ul></div>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups.html" title="Datensicherungen">Zurück</a><a class="nextlinks-next" href="backups-shellscripts-rotation.html" title="Archiv-Rotation">Weiter</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
