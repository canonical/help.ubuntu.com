<!DOCTYPE html>
<html lang=it>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Script shell</title>
<link rel="stylesheet" type="text/css" href="it.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Guida a Ubuntu Server">Guida a Ubuntu Server</a> » <a class="trail" href="backups.html" title="Backup">Backup</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups.html" title="Backup">Indietro</a><a class="nextlinks-next" href="backups-shellscripts-rotation.html" title="Rotazione degli archivi">Avanti</a>
</div>
<div class="hgroup"><h1 class="title">Script shell</h1></div>
<div class="region">
<div class="contents">
<p class="para">Uno dei metodi più semplici per effettuare il backup del sistema è usare uno<span class="em emphasis">shell script</span>. Per esempio, è possibile usare uno script per scegliere le directory da archiviare e usare queste directory come argomento per l'utilità <span class="app application">tar</span> per creare un archivio, che può essere quindi spostato o copiato in un'altra posizione. L'archivio può anche essere creato su un file system remoto, come una condivisione <span class="em emphasis">NFS</span> .</p>
<p class="para">L'utilità <span class="app application">tar</span> crea un archivio di file a partire da molti file o directory. Con <span class="app application">tar</span> è possibile anche elaborare i file con utilità di compressione riducendo così la dimensione dell'archivio.</p>
</div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript" title="Semplice script shell">Semplice script shell</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-executing-shellscript" title="Eseguire lo script">Eseguire lo script</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript-archive-testing" title="Ripristinare l'archivio">Ripristinare l'archivio</a></li>
<li class="links"><a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Riferimenti">Riferimenti</a></li>
</ul></div>
<div class="sect2 sect" id="backup-shellscript"><div class="inner">
<div class="hgroup"><h2 class="title">Semplice script shell</h2></div>
<div class="region"><div class="contents">
<p class="para">Il seguente script utilizza <span class="app application">tar</span> per creare un archivio su un file system remoto NFS. Il nome dell'archivio è determinato utilizzando delle utilità a riga di comando aggiuntive.</p>
<div class="code"><pre class="contents ">#!/bin/bash
####################################
#
# Backup to NFS mount script.
#
####################################

# What to backup. 
backup_files="/home /var/spool/mail /etc /root /boot /opt"

# Where to backup to.
dest="/mnt/backup"

# Create archive filename.
day=$(date +%A)
hostname=$(hostname -s)
archive_file="$hostname-$day.tgz"

# Print start status message.
echo "Backing up $backup_files to $dest/$archive_file"
date
echo

# Backup the files using tar.
tar czf $dest/$archive_file $backup_files

# Print end status message.
echo
echo "Backup finished"
date

# Long listing of files in $dest to check file sizes.
ls -lh $dest
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$backup_files</span>: una variabile con le directory di cui si vuole fare una copia. L'elenco va modificato come desiderato.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$day:</span>: una variabile contenente il giorno della settimana (lunedì, martedì, mercoledì, ecc...) viene usata per creare un archivio per ogni giorno della settimana, consentendo di avere una cronologia di archivi di sette giorni. Esistono altri metodi per fare questo, come l'uso dell'utilità <span class="app application">date</span>.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$hostname</span>: variabile contenente il nome host <span class="em emphasis">breve</span> del sistema. Usare il nome dell'host nel nome dell'archivio, consente di avere backup giornalieri di diversi sistemi in una sola directory.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$archive_file</span>: il nome completo dell'archivio.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">$dest:</span> destinazione dell'archivio. La directory deve essere creata e in questo caso anche <span class="em emphasis">mounted</span> prima di eseguire lo script di backup. Per dettagli sull'uso di <span class="em emphasis">NFS</span>, consultare la relativa sezione <a class="xref" href="network-file-system.html" title="NFS (Network File System)">NFS (Network File System)</a>.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">messaggi:</span> messaggi opzionali stampati sulla console usando <span class="app application">echo</span>.</p>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">tar czf $dest/$archive_file $backup_files</span>: il comando <span class="app application">tar</span> usato per creare l'archivio.</p>
  	  <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">           
              <p class="para"><span class="em emphasis">c</span>: crea l'archivio.</p>
            </li>
<li class="list itemizedlist">           
              <p class="para"><span class="em emphasis">z</span>: passa l'archivio attraverso l'utilità di compressione <span class="app application">gzip</span>.</p>
            </li>
<li class="list itemizedlist">           
              <p class="para"><span class="em emphasis">f:</span> usa un file archivio, altrimenti il comando <span class="app application">tar</span> invia l'output sullo STDOUT.</p>
            </li>
</ul></div>
        </li>
<li class="list itemizedlist">           
          <p class="para"><span class="em emphasis">ls -lh $dest</span>: istruzione opzionale che stampa un elenco lungo (<span class="em emphasis">-l</span>) in un formato leggibile (<span class="em emphasis">-h</span>) della directory di destinazione. È utile per controllare la dimensione dell'archivo. Questa verifica non dovrebbe sostituire la verifica dell'archivio.</p>
        </li>
</ul></div>
<p class="para">Questo è un semplice esempio di un backup eseguito con uno script shell ed è possibile aggiungere molte opzioni. Per maggiori informazioni sugli script shell, consultare la sezione <a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Riferimenti">Riferimenti</a>.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="backup-executing-shellscript"><div class="inner">
<div class="hgroup"><h2 class="title">Eseguire lo script</h2></div>
<div class="region">
<div class="contents"></div>
<div class="sect3 sect" id="backup-script-execute-shell"><div class="inner">
<div class="hgroup"><h3 class="title">Esecuzione da terminale</h3></div>
<div class="region"><div class="contents">
<p class="para">
        The simplest way of executing the above backup script is to copy and paste the contents into a file.  <span class="file filename">backup.sh</span> 
        for example. The file must be made executable:
	</p>
<div class="screen"><pre class="contents "><span class="cmd command">chmod u+x backup.sh</span>
</pre></div>
<p class="para">
	Then from a terminal prompt:  
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo ./backup.sh</span>
</pre></div>
<p class="para">È un ottimo modo per provare lo script e assicurarsi che funzioni correttamente.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="backup-script-execute-cron"><div class="inner">
<div class="hgroup"><h3 class="title">Esecuzione con cron</h3></div>
<div class="region"><div class="contents">
<p class="para">L'utilità <span class="app application">cron</span> può essere usata per automatizzare l'esecuzione dello script. Il demone <span class="app application">cron</span> consente l'esecuzione di script o comandi a un determinato orario e data.</p>
<p class="para">L'applicazione <span class="app application">cron</span> è configurata attraverso delle voci in un file <span class="file filename">crontab</span> file. I file <span class="file filename">crontab</span> sono separati in campi:</p>
<div class="code"><pre class="contents "># m h dom mon dow   comando
</pre></div>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">m:</span> minuto di esecuzione del comando, tra 0 e 59.</p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">h:</span> ora di esecuzione del comando, tra 0 e 23.</p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">dom</span>: giorno del mese di esecuzione del comando.</p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">mon:</span> mese in cui viene eseguito il comando, tra 1 e 12.</p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">dow:</span> giorno della settimana in cui viene eseguito il comando, tra 0 e 7. La domenica può essere specificata usando sia 0 che 7.</p>
          </li>
<li class="list itemizedlist">
            <p class="para"><span class="em emphasis">comando</span>: il comando da eseguire.</p>
          </li>
</ul></div>
<p class="para">Per aggiungere o modificare voci in un file <span class="file filename">crontab</span>, dovrebbe essere usato il comando <span class="app application">crontab -e</span>, i contenuti di un file <span class="file filename">crontab</span> possono essere visualizzati usando il comando <span class="app application">crontab -l</span>.</p>
<p class="para">Per eseguire lo script <span class="app application">backup.sh</span> usando <span class="app application">cron</span>, in un terminale digitare quanto segue:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo crontab -e</span>
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
	  <p class="para">Usare <span class="app application">sudo</span> con il comando <span class="app application">crontab -e</span>, modifica il crontab dell'utente <span class="em emphasis">root</span>. Questo è necessario nel caso in cui si stiano eseguendo copie di backup di file accessibili solo dall'utente root.</p>
        </div></div></div></div>
<p class="para">Aggiungere quanto segue al file <span class="file filename">crontab</span>:</p>
<div class="code"><pre class="contents "># m h dom mon dow   command
0 0 * * * bash /usr/local/bin/backup.sh
</pre></div>
<p class="para">Lo script <span class="app application">backup.sh</span> verrà eseguito ogni giorno alle 12.00 AM.</p>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Lo script <span class="app application">backup.sh</span>  deve essere copiato nella directory <span class="file filename">/usr/local/bin/</span> perché questa voce venga eseguita correttamente. Lo script può risiedere ovunque nel file system, basta cambiare il percorso in modo appropriato.</p>
        </div></div></div></div>
<p class="para">Per maggiori dettagli sulle opzioni di  <span class="app application">crontab</span>, conultare <a class="xref" href="backup-shellscripts.html#backup-shellscript-references" title="Riferimenti">Riferimenti</a>.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="backup-shellscript-archive-testing"><div class="inner">
<div class="hgroup"><h2 class="title">Ripristinare l'archivio</h2></div>
<div class="region"><div class="contents">
<p class="para">Una volta creato un archivio, è importante verificarlo, elencandone i contenuti oppure, ed è la scelta migliore, <span class="em emphasis">ripristinare</span> un file dall'archivio.</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Per visualizzare un elenco dei contenuti di un archivio, digitare in una riga di comando di un terminale:</p>
<div class="screen"><pre class="contents "><span class="cmd command">tar -tzvf /mnt/backup/host-lunedì.tgz</span>
</pre></div>
        </li>
<li class="list itemizedlist">
          <p class="para">Per ripristinare un file dall'archivio in una directory diversa, digitare:</p>
<div class="screen"><pre class="contents "><span class="cmd command">tar -xzvf /mnt/backup/host-lunedì.tgz -C /tmp etc/hosts</span>
</pre></div>
          <p class="para">L'opzione <span class="em emphasis">-C</span> di <span class="app application">tar</span> redirige i file estratti nella directory specificata. L'esempio precedente estrarrà il file <span class="file filename">/etc/hosts</span> in <span class="file filename">/tmp/etc/hosts</span>. La struttura della directory viene quindi ricreata da <span class="app application">tar</span>.</p>
          <p class="para">Notare anche che il simbolo «<span class="em emphasis">/</span>» iniziale del percorso in cui ripristinare è stato tralasciato.</p>  
        </li>
<li class="list itemizedlist">
          <p class="para">Per ripristinare tutti i file presenti nell'archivio, digitare:</p>
<div class="screen"><pre class="contents "><span class="cmd command">cd /</span>
<span class="cmd command">sudo tar -xzvf /mnt/backup/host-lunedì.tgz</span>
</pre></div>
        </li>
</ul></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
        <p class="para">In questo modo verranno sovrascritti i file attualmente presenti nel file system.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="backup-shellscript-references"><div class="inner">
<div class="hgroup"><h2 class="title">Riferimenti</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Per maggiori informazioni riguardo lo script da shell, consultare la <a href="http://tldp.org/LDP/abs/html/" class="ulink" title="http://tldp.org/LDP/abs/html/">Advanced Bash-Scripting Guide</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il libro <a href="http://safari.samspublishing.com/0672323583" class="ulink" title="http://safari.samspublishing.com/0672323583">Teach Yourself Shell Programming in 24 Hours</a> è disponibile in linea ed è un'ottima risorsa per lo script da shell.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">La pagina della <a href="http://wiki.ubuntu-it.org/AmministrazioneSistema/Cron" class="ulink" title="http://wiki.ubuntu-it.org/AmministrazioneSistema/Cron">della documentazione in linea su cron</a> contiene ulteriori dettagli sulle opzioni avanzate di <span class="app application">cron</span>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Per maggiori informazioni sulle opzioni del comando <span class="app application">tar</span>, consultare il <a href="http://www.gnu.org/software/tar/manual/index.html" class="ulink" title="http://www.gnu.org/software/tar/manual/index.html">manuale in linea di tar</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">La pagina inglese di Wikipedia <a href="http://en.wikipedia.org/wiki/Backup_rotation_scheme" class="ulink" title="http://en.wikipedia.org/wiki/Backup_rotation_scheme">Backup Rotation Scheme</a> contiene informazioni sugli schemi di backup.</p>
        </li>
<li class="list itemizedlist">
        <p class="para">Questo script utilizza <span class="app application">tar</span> per creare l'archivio, ma esistono diverse altre utilità a riga di comando che possono essere usate, per esempio:</p>
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><a href="http://www.gnu.org/software/cpio/" class="ulink" title="http://www.gnu.org/software/cpio/">cpio</a>: usata per copiare file da e verso degli archivi.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><a href="http://www.gnu.org/software/coreutils/" class="ulink" title="http://www.gnu.org/software/coreutils/">dd</a>: parte del pacchetto <span class="app application">coreutils</span>. Un'utilità di basso livello per copiare dati da un formato all'altro.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><a href="http://www.rsnapshot.org/" class="ulink" title="http://www.rsnapshot.org/">rsnapshot</a>: una utility per istantanee del file system utilizzata per creare copie di un intero file system.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><a href="http://www.samba.org/ftp/rsync/rsync.html" class="ulink" title="http://www.samba.org/ftp/rsync/rsync.html">rsync</a>: una flessibile utility usata per creare copie incrementali di file.</p>
            </li>
</ul></div>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="backups.html" title="Backup">Indietro</a><a class="nextlinks-next" href="backups-shellscripts-rotation.html" title="Rotazione degli archivi">Avanti</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
