<!DOCTYPE html>
<html lang=pt-BR>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Kerberos</title>
<link rel="stylesheet" type="text/css" href="pt_BR.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Guia para servidores Ubuntu">Guia para servidores Ubuntu</a> » <a class="trail" href="network-authentication.html" title="Autenticação de rede">Autenticação de rede</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-ldap.html" title="Samba e LDAP">Anterior</a><a class="nextlinks-next" href="kerberos-ldap.html" title="Kerberos e LDAP">Próximo</a>
</div>
<div class="hgroup"><h1 class="title">Kerberos</h1></div>
<div class="region">
<div class="contents">
<p class="para"><span class="app application">Kerberos</span> é um sistema de autenticação de rede baseado no principal de um sistema de confiança tripla. sendo que as outras duas partes são o usuário e o serviço no qual o usuário deseja autenticar-se. Nem todos os serviços e aplicações podem usar Kerberos mas, para aqueles que podem, ele traz um ambiente de rede um passo mais próximo de um Sign On Único (SSO).</p>
<p class="para">Esta seção cobre a instalação e configuração de um servidor Kerberos, além de fornecer alguns exemplos de configurações de clientes.</p>
</div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="kerberos.html#kerberos-overview" title="Visão geral">Visão geral</a></li>
<li class="links"><a class="xref" href="kerberos.html#kerberos-server" title="Servidor Kerberos">Servidor Kerberos</a></li>
<li class="links"><a class="xref" href="kerberos.html#kerberos-secondary-kdc" title="KDC Secundário">KDC Secundário</a></li>
<li class="links"><a class="xref" href="kerberos.html#kerberos-linux-client" title="Cliente de Linux Kerberos">Cliente de Linux Kerberos</a></li>
<li class="links"><a class="xref" href="kerberos.html#kerberos-resources" title="Recursos">Recursos</a></li>
</ul></div>
<div class="sect2 sect" id="kerberos-overview"><div class="inner">
<div class="hgroup"><h2 class="title">Visão geral</h2></div>
<div class="region"><div class="contents">
<p class="para">Se você é novo em Kerberos, há alguns poucos termos que é interessante conhecer antes de configurar um servidor Kerberos. A maioria dos termos se relacionará a coisas com as quais você pode já estar familiarizado em outros ambientes:</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Principal:</span> são quaisquer usuários, computadores e serviços providos por servidores e que precisam ser definidos como Principais do Kerberos.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Instâncias:</span> são usadas por principais do serviço e principais administrativos especiais.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          <span class="em emphasis">Realms:</span> the unique realm of control provided by the Kerberos installation.  
	  Think of it as the domain or group your hosts and users belong to.
	  Convention dictates the realm should be in uppercase.
	  By default, ubuntu will use the DNS domain converted to 
          uppercase (EXAMPLE.COM) as the realm.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Key Distribution Center:</span> (KDC) consiste de três partes, uma base de dados de todos os principais, o servidor de autenticação e o servidor de ticket granting. Para cada realm, deve haver pelo menos um KDC.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Ticket Granting Ticket:</span> emitido pelo Servidor de Autenticação (AS), o Ticket Granting Ticket (TGT) é criptografado na senha do usuário que é conhecida apenas pelo próprio usuário e pelo KDC.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Servidor de Ticket Granting:</span> (TGS) emite, sob solicitação, tickets de serviço para clientes.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Tickets:</span> confirmam a identidade dos dois principais. Um principal é o usuário e o outro um serviço solicitado pelo usuário. Os Tickets estabelecem uma chave de criptografia usada para comunicação segura durante a seção de autenticação.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">Arquivos de Keytab:</span> são arquivos extraídos da base de dados do principal KDC e contêm a chave de criptografia para um serviço ou um host.</p>
        </li>
</ul></div>
<p class="para">
      To put the pieces together, a Realm has at least one KDC, preferably more for redundancy, which contains a database of Principals.  When a 
      user principal logs into a workstation that is configured for Kerberos authentication, the KDC issues a Ticket Granting Ticket (TGT).  If the user
      supplied credentials match, the user is authenticated and can then request tickets for Kerberized services from the Ticket Granting Server
      (TGS).  The service tickets allow the user to authenticate to the service without entering another username and password.
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="kerberos-server"><div class="inner">
<div class="hgroup"><h2 class="title">Servidor Kerberos</h2></div>
<div class="region">
<div class="contents"></div>
<div class="sect3 sect" id="kerberos-server-installation"><div class="inner">
<div class="hgroup"><h3 class="title">Instalação</h3></div>
<div class="region"><div class="contents">
<p class="para">
	For this discussion, we will create a MIT Kerberos domain with the 
	following features (edit them to fit your needs):
        </p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">Realm:</span> EXAMPLE.COM 
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">Primary KDC:</span> kdc01.example.com (192.168.0.1)
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">Secondary KDC:</span> kdc02.example.com (192.168.0.2)
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">User principal:</span> steve 
            </p>
          </li>
<li class="list itemizedlist">
            <p class="para">
            <span class="em emphasis">Admin principal:</span> steve/admin 
            </p>
          </li>
</ul></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents"> 
          <p class="para">
          It is <span class="em emphasis">strongly</span> recommended that your
	  network-authenticated users have their uid in a different range 
	  (say, starting at 5000) than that of your local users. 
          </p>
        </div></div></div></div>
<p class="para"> 
        Before installing the Kerberos server a properly configured DNS server is needed for your domain.  Since the Kerberos Realm by 
        convention matches the domain name, this section uses the <span class="em emphasis">EXAMPLE.COM</span> domain configured in 
        <a class="xref" href="dns-configuration.html#dns-primarymaster-configuration" title="Primary Master">Primary Master</a> of the DNS documentation.  
        </p>
<p class="para">
        Also, Kerberos is a time sensitive protocol.  So if the local system time between a client machine and the server differs by
        more than five minutes (by default), the workstation will not be able to authenticate.  To correct the problem all hosts 
        should have their time synchronized using the same
	<span class="em emphasis">Network Time Protocol (NTP)</span> server.  For details
        on setting up NTP see <a class="xref" href="NTP.html" title="Time Synchronisation">Time Synchronisation</a>.
        </p>
<p class="para">
        The first step in creating a Kerberos Realm is to install the <span class="app application">krb5-kdc</span>  and 
        <span class="app application">krb5-admin-server</span> packages.  From a terminal enter:
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install krb5-kdc krb5-admin-server</span>
</pre></div>
<p class="para">
        You will be asked at the end of the install to supply the hostname 
	for the Kerberos and Admin servers, which may or may not be the 
        same server, for the realm.
        </p>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">
          By default the realm is created from the KDC's domain name.
          </p>
        </div></div></div></div>
<p class="para">A seguir, crie o novo realm com o utilitário <span class="app application">kdb5_newrealm</span>:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo krb5_newrealm</span>
</pre></div>
</div></div>
</div></div>
<div class="sect3 sect" id="kerberos-server-configuration"><div class="inner">
<div class="hgroup"><h3 class="title">Configuração</h3></div>
<div class="region"><div class="contents">
<p class="para">
        The questions asked during installation are used to configure the <span class="file filename">/etc/krb5.conf</span> file.  If you need to adjust 
        the Key Distribution Center (KDC) settings simply edit the file and restart the <span class="app application">krb5-kdc</span> daemon.
	If you need to reconfigure Kerberos from scratch, perhaps to change the realm name, you can do so by typing
        </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo dpkg-reconfigure krb5-kdc</span>
</pre></div>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

            <p class="para">
            Once the KDC is properly running, an admin user -- the
	    <span class="em emphasis">admin principal</span> -- is needed.  
	    It is recommended to use a different username from your everyday username.  
            Using the <span class="app application">kadmin.local</span> utility in a terminal prompt enter:
            </p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kadmin.local</span>
<span class="output computeroutput">Autenticação como root/admin@EXAMPLE.COM principal com senha.</span><span class="input userinput"> addprinc steve/admin</span>
<span class="output computeroutput">AVISO: não há política especificada para steve/admin@EXAMPLE.COM; padrão para sem política
Digite a senha para o principal "steve/admin@EXAMPLE.COM":
Re-digite a senha para principal "steve/admin@EXAMPLE.COM":
Criado principal "steve/admin@EXAMPLE.COM".
kadmin.local:</span><span class="input userinput"> sair</span>
</pre></div>

            <p class="para">
            In the above example <span class="em emphasis">steve</span> is the <span class="em emphasis">Principal</span>, 
            <span class="em emphasis">/admin</span> is an <span class="em emphasis">Instance</span>, and 
            <span class="em emphasis">@EXAMPLE.COM</span> signifies the realm.  The <span class="em emphasis">"every day"</span>
            Principal, 
	    a.k.a. the <span class="em emphasis">user principal</span>,
	    would be <span class="em emphasis">steve@EXAMPLE.COM</span>, and should have only normal user rights.            
            </p>

            <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
              <p class="para">Substitua <span class="em emphasis">EXAMPLE.COM</span> e <span class="em emphasis">steve</span> com o seu Realm e usuário admin.</p>
            </div></div></div></div>

          </li>
<li class="steps">
 
            <p class="para">Após isto, o novo usuário administrador precisa ter as permissões apropriadas na Lista de Controle de Acesso (ACL). As permissões são configuradas no arquivo <span class="file filename">/etc/krb5kdc/kadm5.acl</span>:</p>

<div class="code"><pre class="contents ">steve/admin@EXAMPLE.COM        *
</pre></div>

            <p class="para">
            This entry grants <span class="em emphasis">steve/admin</span> the ability to perform any operation on all principals in the realm.
	    You can configure principals with more restrictive privileges,
	    which is convenient if you need an admin principal that junior 
	    staff can use
	    in Kerberos clients. Please see the 
	    <span class="em emphasis">kadm5.acl</span> man page for details.
            </p>

          </li>
<li class="steps">

            <p class="para">Agora reinicie o <span class="app application">krb5-admin-server</span> para que a nova ACL tenha efeito:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart krb5-admin-server.service</span>
</pre></div>

          </li>
<li class="steps">

            <p class="para">O novo usuário principal pode ser testado utilizando o <span class="app application">kinit utility</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">kinit steve/admin</span>
<span class="output computeroutput">steve/admin@EXAMPLE.COM's Password:</span>
</pre></div>          

            <p class="para">Após digitar a senha, utilize o utilitário <span class="app application">klist</span> para exibir informações sobre o Ticket Granting Ticket (TGT):</p>

<div class="screen"><pre class="contents "><span class="cmd command">klist</span>
<span class="output computeroutput">Armazenamento de credenciais FILE:/tmp/krb5cc_1000
        Gerente: steve/admin@EXEMPLO.COM

  Emitida           Expira          Gerente
13 de Jul 17:53:34  14 de Jul 03:53:34  krbtgt/EXEMPLO.COM@EXEMPLO.COM</span>
</pre></div>

            <p class="para">
	    Where the cache filename <span class="file filename">krb5cc_1000</span> is 
	    composed of the prefix <span class="file filename">krb5cc_</span> and the user
	    id (uid), which in this case is <span class="file filename">1000</span>.
            You may need to add an entry into the 
	    <span class="file filename">/etc/hosts</span> for the KDC so the client can
	    find the KDC.  For example:
            </p>
            
<div class="code"><pre class="contents ">192.168.0.1   kdc01.example.com       kdc01
</pre></div>

            <p class="para">
            Replacing <span class="em emphasis">192.168.0.1</span> with the IP address of your KDC.  
	    This usually happens when you have a Kerberos realm encompassing 
	    different networks separated by routers.
            </p>

          </li>
<li class="steps">
          
            <p class="para">
	    The best way to allow clients to automatically
            determine the KDC for the Realm is using DNS SRV records.  Add the following to 
            <span class="file filename">/etc/named/db.example.com</span>:
            </p>

<div class="code"><pre class="contents ">_kerberos._udp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._tcp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._udp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos._tcp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos-adm._tcp.EXAMPLE.COM. IN SRV 1  0 749 kdc01.example.com.
_kpasswd._udp.EXAMPLE.COM.      IN SRV 1  0 464 kdc01.example.com.
</pre></div>

            <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
              <p class="para">Substitua <span class="em emphasis">EXAMPLE.COM</span>, <span class="em emphasis">kdc01</span>, e <span class="em emphasis">kdc02</span> com o seu nome de domínio, KDC primário e KDC secundário.</p>
            </div></div></div></div>

            <p class="para">Veja <a class="xref" href="dns.html" title="Domain Name Service (DNS)">Domain Name Service (DNS)</a> para obter instruções detalhadas sobre a configuração do DNS.</p>

          </li>
</ol></div></div>
<p class="para">Seu novo domínio Kerberos está agora pronto para autenticar clientes.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="kerberos-secondary-kdc"><div class="inner">
<div class="hgroup"><h2 class="title">KDC Secundário</h2></div>
<div class="region"><div class="contents">
<p class="para">
      Once you have one Key Distribution Center (KDC) on your network, it is good practice to have a Secondary KDC in case the
      primary becomes unavailable. 
      Also, if you have Kerberos clients that are in different networks 
      (possibly separated by routers using NAT), it is wise to place a 
      secondary KDC in each of those networks.
      </p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
        
        <p class="para">Em primeiro lugar, instale os pacotes, e quando perguntado os nomes dos servidores Admin e Kerberos e digite o nome do KDC Primário:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install krb5-kdc krb5-admin-server</span>
</pre></div>

        </li>
<li class="steps">

        <p class="para">Depois de ter instalado os pacotes, crie o KDC Secundário do servidor principal. A partir de um prompt do terminal, digite:</p>

<div class="screen"><pre class="contents "><span class="cmd command">kadmin -q "addprinc -randkey host/kdc02.example.com"</span>
</pre></div>
    
        <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Depois, a emissão de qualquer comando <span class="app application">kadmin</span> ser-lhe-á perguntado sobre sua senha principal <span class="em emphasis">username/admin@EXEMPLO.COM.BR</span>.</p>
        </div></div></div></div>
      
        </li>
<li class="steps">

          <p class="para">Extrair o arquivo <span class="em emphasis">keytab</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">kadmin -q "ktadd -norandkey -k keytab.kdc02 host/kdc02.example.com"</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Deve existir agora um <span class="file filename">keytab.kdc02</span> no diretório atual, mova o arquivo para <span class="file filename">/etc/krb5.keytab</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo mv keytab.kdc02 /etc/krb5.keytab</span>
</pre></div>

          <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Se o caminho para o arquivo <span class="file filename">keytab.kdc02</span> é diferente, ajustar de acordo.</p>
          </div></div></div></div>

          <p class="para">Além disso, você pode listar os principais em um arquivo Keytab, que pode ser útil na resolução de problemas, utilizando o utilitário <span class="app application">klist</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo klist -k /etc/krb5.keytab</span>
</pre></div>

            <p class="para">
            The <span class="app application">-k</span> option indicates the file is a keytab file.
            </p>

        </li>
<li class="steps">

          <p class="para">A seguir, deve haver um arquivo <span class="file filename">kpropd.acl</span> em cada KDC que lista todos os KDCs para o Domínio. Por exemplo, tanto no KDC primário quanto no secundário, crie o arquivo<span class="file filename">/etc/krb5kdc/kpropd.acl</span>:</p>

<div class="code"><pre class="contents ">host/kdc01.example.com@EXAMPLE.COM
host/kdc02.example.com@EXAMPLE.COM
</pre></div>

        </li>
<li class="steps">

          <p class="para">Crie um banco de dados vazio no <span class="em emphasis">Secondary KDC</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kdb5_util -s create</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Agora inicie o serviço <span class="app application">kpropd</span>, que aguarda conexões do utilitário  <span class="app application">kprop</span>. <span class="app application">kprop</span> é usado para transferir arquivos de despejo:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kpropd -S</span>
</pre></div>
      
        </li>
<li class="steps">

          <p class="para">No terminal em <span class="em emphasis">Primary KDC</span>, crie um arquivo de despejo do banco de dados principal:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kdb5_util dump /var/lib/krb5kdc/dump</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Extraia o arquivo de <span class="em emphasis">keytab</span> do KDC Primário e copie-o para <span class="file filename">/etc/krb5.keytab</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">kadmin -q "ktadd -k keytab.kdc01 host/kdc01.example.com"</span>
<span class="cmd command">sudo mv keytab.kdc01 /etc/krb5.keytab</span>
</pre></div>

          <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Certifique-se de que há um <span class="em emphasis">host</span> para <span class="em emphasis">kdc01.exemplo.com</span> antes de extrair a Keytab.</p>
          </div></div></div></div>

        </li>
<li class="steps">

          <p class="para">Empregando o utilitário <span class="app application">kprop</span> envie a base de dados para o KDC Secundário:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com</span>
</pre></div>

          <div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Deverá haver uma mensagem de <span class="em emphasis">BEM-SUCEDIDO</span> se a propagação funcionar. Se houver alguma mensagem de erro verifique <span class="file filename">/var/log/syslog</span> no KDC Secundário para mais informações.</p>
          </div></div></div></div>
      
          <p class="para">
          You may also want to create a <span class="app application">cron</span> job to periodically update the database on the Secondary KDC.  For 
          example, the following will push the database every hour (note the long line has been split to fit the format of this document):
          </p>

<div class="code"><pre class="contents "># m h  dom mon dow   command
0 * * * * /usr/sbin/kdb5_util dump /var/lib/krb5kdc/dump &amp;&amp; 
/usr/sbin/kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com
</pre></div>
  
        </li>
<li class="steps">

          <p class="para">De volta ao <span class="em emphasis">KDC Secundário</span>, crie uma <span class="em emphasis">reserva</span> para guardar a chave mestre do Kerberos.</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo kdb5_util stash</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Finalmente, inicie o serviço <span class="app application">krb5-kdc</span> no KDC Secundário:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl start krb5-kdc.service</span>
</pre></div>

        </li>
</ol></div></div>
<p class="para">
      The <span class="em emphasis">Secondary KDC</span> should now be able to issue tickets for the Realm.  You can test this by stopping 
      the <span class="app application">krb5-kdc</span> daemon on the Primary KDC, then 
      by using <span class="app application">kinit</span> to request a ticket.
      If all goes well you should receive a ticket from the Secondary KDC.
      Otherwise, check <span class="file filename">/var/log/syslog</span> and
      <span class="file filename">/var/log/auth.log</span> in the Secondary KDC.
      </p>
</div></div>
</div></div>
<div class="sect2 sect" id="kerberos-linux-client"><div class="inner">
<div class="hgroup"><h2 class="title">Cliente de Linux Kerberos</h2></div>
<div class="region">
<div class="contents"><p class="para">Esta seção cobre a configuração de um sistema Linux como cliente <span class="app application">Kerberos</span>. Isso permitirá acesso a qualquer serviço kerberizado assim que o usuário fizer login com sucesso no sistema.</p></div>
<div class="sect3 sect" id="kerberos-client-installation"><div class="inner">
<div class="hgroup"><h3 class="title">Instalação</h3></div>
<div class="region"><div class="contents">
<p class="para">Para autenticar-se em um Domínio Kerberos, os pacotes <span class="app application">krb5-user</span> e <span class="app application">libpam-krb5</span> são necessários, junto com alguns outros que não são estritamente necessários mas facilitam a vida. Para instalar os pacotes digite o seguinte em um terminal:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install krb5-user libpam-krb5 libpam-ccreds auth-client-config</span>
</pre></div>
<p class="para">O pacote <span class="app application">auth-client-config</span> permite a configuração simples do PAM para autenticação em múltiplos lugares, e o <span class="app application">libpam-ccreds</span> irá armazenar as credenciais de autenticação permitindo que você faça o login caso o Key Distribution Center (KDC) não esteja disponível. Este pacote é útil também para laptops que precisam autenticar-se utilizando Kerberos em redes corporativas, mas precisam ser utilizados fora destas redes também.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="kerberos-client-configuration"><div class="inner">
<div class="hgroup"><h3 class="title">Configuração</h3></div>
<div class="region"><div class="contents">
<p class="para">Para configurar o cliente em um terminal digite:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo dpkg-reconfigure krb5-config</span>
</pre></div>
<p class="para">Será então requisitado que você digite o nome do Domínio Kerberos. Além disso, se você não tiver DNS configurado com registros <span class="em emphasis">SRV</span> do Kerberos, o menu irá perguntar os hostnames do Centro de Distribuição de Chaves (KDC) e servidor da Administração do Domínio.</p>
<p class="para">O <span class="app application">dpkg-reconfigure</span> adiciona entradas ao arquivo <span class="file filename">/etc/krb5.conf</span> para o seu Domínio. Você deverá ter entradas similares ao seguinte:</p>
<div class="code"><pre class="contents ">[libdefaults]
        default_realm = EXAMPLE.COM
...
[realms]
        EXAMPLE.COM = {
                kdc = 192.168.0.1
                admin_server = 192.168.0.1
        }
</pre></div>
<div class="note" title="Nota"><div class="inner"><div class="region"><div class="contents">
	  <p class="para">
	  If you set the uid of each of your network-authenticated users to 
	  start at 5000, as suggested in 
	  <a class="xref" href="kerberos.html#kerberos-server-installation" title="Instalação">Instalação</a>, you 
	  can then tell pam to only try to authenticate using Kerberos 
	  users with uid &gt; 5000:
	  </p>
<div class="screen"><pre class="contents "><span class="cmd command"># Kerberos should only be applied to ldap/kerberos users, not local ones.
for i in common-auth common-session common-account common-password; do
 sudo sed -i -r \ 
 -e 's/pam_krb5.so minimum_uid=1000/pam_krb5.so minimum_uid=5000/' \ 
 /etc/pam.d/$i 
done </span>
</pre></div>
	  <p class="para">
	  This will avoid being asked for the (non-existent) Kerberos 
	  password of a locally authenticated user when changing its 
	  password using <span class="cmd command">passwd</span>.
	  </p>
	</div></div></div></div>
<p class="para">Você pode testar a configuração requisitando um ticket com o utilitário <span class="app application">kinit</span>. Por exemplo:</p>
<div class="screen"><pre class="contents "><span class="cmd command">kinit steve@EXAMPLE.COM</span>
<span class="output computeroutput">Senha para steve@EXEMPLO.COM:</span>
</pre></div>
<p class="para">Quando um ticket tiver sido fornecido, os detalhes poderão ser vistos utilizando <span class="app application">klist</span>:</p>
<div class="screen"><pre class="contents "><span class="cmd command">klist</span>
<span class="output computeroutput">Armazenamento de ticket: FILE:/tmp/krb5cc_1000
Gerente padrão: steve@EXEMPLO.COM

Início válido     Expira            Gerente de serviço
24/07/08 05:18:56  24/07/08 15:18:56  krbtgt/EXEMPLO.COM@EXEMPLO.COM
        renovar antes de 07/25/08 05:18:57


Armazenamento de ticket Kerberos 4: /tmp/tkt1000
klist: Você não possui tickets armazenados</span>
</pre></div>
<p class="para">A seguir, use o <span class="app application">auth-client-config</span> para configurar o módulo <span class="app application">libpam-krb5</span> para requisitar um ticket durante o login:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo auth-client-config -a -p kerberos_example</span>
</pre></div>
<p class="para">Você deverá agora receber um ticket após autenticações de login bem sucedidas.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="kerberos-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Recursos</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">
          For more information on MIT's version of Kerberos, see the <a href="http://web.mit.edu/Kerberos/" class="ulink" title="http://web.mit.edu/Kerberos/">MIT Kerberos</a> site.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para">A página <a href="https://help.ubuntu.com/community/Kerberos" class="ulink" title="https://help.ubuntu.com/community/Kerberos">Ubuntu Wiki Kerberos</a> possui maiores detalhes.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">O livro de O'Reilly <a href="http://oreilly.com/catalog/9780596004033/" class="ulink" title="http://oreilly.com/catalog/9780596004033/">Kerberos: The Definitive Guide</a> é uma ótima referência para a configuração do Kerberos.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          Also, feel free to stop by the <span class="em emphasis">#ubuntu-server</span> 
	  and <span class="em emphasis">#kerberos</span>
	  IRC channels on <a href="http://freenode.net/" class="ulink" title="http://freenode.net/">Freenode</a>  
          if you have Kerberos questions.
          </p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-ldap.html" title="Samba e LDAP">Anterior</a><a class="nextlinks-next" href="kerberos-ldap.html" title="Kerberos e LDAP">Próximo</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
