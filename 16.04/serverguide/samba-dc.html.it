<!DOCTYPE html>
<html lang=it>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Come un controller di dominio</title>
<link rel="stylesheet" type="text/css" href="it.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Guida a Ubuntu Server">Guida a Ubuntu Server</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Proteggere server di file e di stampa">Indietro</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Integrazione con Active Directory">Avanti</a>
</div>
<div class="hgroup"><h1 class="title">Come un controller di dominio</h1></div>
<div class="region">
<div class="contents"><p class="para">Benché non possa funzionare come un controller di dominio primario (PDC) Active Directory, un server Samba può essere configurato per apparire come un controller di dominio in stile Windows NT4. Uno dei vantaggi di questa configurazione consiste nell'abilità di centralizzare le credenziali di utenti e computer, inoltre, Samba può utilizzare diversi backend per archiviare le informazioni.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-dc.html#samba-pdc-smbpasswd" title="Controller di dominio primario (PDC)">Controller di dominio primario (PDC)</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-bdc-smbpasswd" title="Controller di dominio di backup">Controller di dominio di backup</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-dc-resources" title="Risorse">Risorse</a></li>
</ul></div>
<div class="sect2 sect" id="samba-pdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Controller di dominio primario (PDC)</h2></div>
<div class="region"><div class="contents">
<p class="para">Questa sezione spiega come configurare Samba come controller di dominio primario (PDC) usando il backend predefinito «smbpasswd».</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

          <p class="para">
          First, install Samba, and <span class="app application">libpam-winbind</span> to sync the user accounts,
          by entering the following in a terminal prompt:
          </p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install samba libpam-winbind</span>
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Configurare Samba modificando il file <span class="file filename">/etc/samba/smb.conf</span>. La variabile <span class="em emphasis">security</span> dovrebbe essere impostata a <span class="em emphasis">user</span> e il <span class="em emphasis">workgroup</span> dovrebbe essere relativo alla propria organizzazione.</p>

<div class="code"><pre class="contents ">   workgroup = ESEMPIO
   ...
   security = user
</pre></div>

        </li>
<li class="steps">

          <p class="para">Nella sezione commentata <span class="quote">“Domains”</span> aggiungere o togliere il commento a quanto segue (l'ultima riga è stata divisa per adattarla al formato di questo documento):</p>

<div class="code"><pre class="contents ">   domain logons = yes
   logon path = \\%N\%U\profile
   logon drive = H:
   logon home = \\%N\%U
   logon script = logon.cmd
   add machine script = sudo /usr/sbin/useradd -N -g machines -c Machine -d
         /var/lib/samba -s /bin/false %u
</pre></div>

          <div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Per non usare i profili <span class="em emphasis">roaming</span>, non togliere il commento alle opzioni <span class="em emphasis">logon home</span> e <span class="em emphasis">logon path</span>.</p>
          </div></div></div></div>
 
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">domain logons</span>: fornisce il servizio netlogon facendo in modo che Samba si comporti come un controller di dominio.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon path</span>: posiziona il profilo degli utenti Windows all'interno della loro directory home. È possibile anche configurare una condivisione <span class="em emphasis">[profiles]</span> posizionando tutti i profili all'interno di una sola directory.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon drive</span>: specifica il percorso locale della directory home.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon home</span>: specifica la posizione della directory home.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon script</span>: determina quale script eseguire localmente una volta che un utente ha eseguito l'accesso. Lo script deve essere all'interno della condivisione <span class="em emphasis">[netlogon]</span>.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">add machine script</span>: uno script che crea automaticamente lo <span class="em emphasis">Machine Trust Account</span> necessario per accedere al dominio.</p>
              <p class="para">In questo esempio il gruppo <span class="em emphasis">machines</span> deve essere creato usando l'utilità <span class="app application">addgroup</span>. Per maggiori informazioni, consultare <a class="xref" href="user-management.html#adding-deleting-users" title="Aggiungere e rimuovere utenti">Aggiungere e rimuovere utenti</a>.</p>

            </li>
</ul></div>

        </li>
<li class="steps">
     
          <p class="para">Togliere il commento alla condivisione <span class="em emphasis">[homes]</span> per consentire la mappatura di <span class="em emphasis">logon home</span>:</p>

<div class="code"><pre class="contents ">[homes]
   comment = Home Directories
   browseable = no
   read only = no
   create mask = 0700
   directory mask = 0700
   valid users = %S
</pre></div>

        </li>
<li class="steps">

          <p class="para">Quando configurato come controller di dominio, è necessario configurare una condivisione <span class="em emphasis">[netlogon]</span>. Per abilitarla, togliere il commento a:</p>

<div class="code"><pre class="contents ">[netlogon]
   comment = Network Logon Service
   path = /srv/samba/netlogon
   guest ok = yes
   read only = yes
   share modes = no
</pre></div>

          <div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Il percorso della condivisione predefinita di <span class="em emphasis">netlogon</span> è <span class="file filename">/home/samba/netlogon</span>, ma in base allo «Filesystem Hierarchy Standard» (FHS), <a href="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM" class="ulink" title="http://www.pathname.com/fhs/pub/fhs-2.3.html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM">/srv</a> è la corretta posizione i cui dovrebbero essere tenuti i file specifici dei siti forniti dal sistema.</p>
          </div></div></div></div>

        </li>
<li class="steps">

          <p class="para">Creare la directory <span class="file filename">netlogon</span> e un file <span class="file filename">logon.cmd</span> per ora vuoto:</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mkdir -p /srv/samba/netlogon</span>
<span class="cmd command">sudo touch /srv/samba/netlogon/logon.cmd</span>
</pre></div>
 
          <p class="para">È possibile inserire qualsiasi comando di logon Windows in <span class="file filename">logon.cmd</span> per personalizzare l'ambiente del client.</p>

        </li>
<li class="steps">

          <p class="para">Riavviare Samba per abilitare il nuovo controller di dominio:</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Infine, sono richiesti alcuni comandi addizionali per impostare correttamente i permessi.</p>

          <p class="para">Con l'utente <span class="em emphasis">root</span> disabilitato in modo predefinito, per poter inserire una workstation nel dominio, un gruppo di sistema deve essere associato al gruppo Windows <span class="em emphasis">Domain Admins</span>. Usando l'utilità <span class="app application">net</span>, da un terminale digitare:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo net groupmap add ntgroup="Domain Admins" unixgroup=sysadmin rid=512 type=d</span>
</pre></div>

          <div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Modificare <span class="em emphasis">sysadmin</span> con un qualsiasi altro gruppo si voglia usare. Inoltre, l'utente usato per unirsi al dominio deve essere membro del gruppo <span class="em emphasis">sysadmin</span> oltre al gruppo <span class="em emphasis">admin</span>. Il gruppo <span class="em emphasis">admin</span> consente l'utilizzo di <span class="app application">sudo</span>.</p>
            <p class="para">Se l'utente non dispone ancora di credenziali Samba, è possibile crearle con l'utilità <span class="app application">smbpasswd</span>, modificando opportunamente il nome utente <span class="em emphasis">sysadmin</span>: <div class="screen"><pre class="contents "><span class="cmd command">sudo smbpasswd -a sysadmin</span>
</pre></div></p>
          </div></div></div></div>

          <p class="para">Inoltre, è necessario fornire i diritti al gruppo <span class="em emphasis">Domain Admins</span> per consentire ad <span class="em emphasis">add machine script</span> (e altre funzioni di amministrazione) di funzionare. Per fare ciò:</p>
<div class="screen"><pre class="contents "><span class="cmd command">net rpc rights grant -U sysadmin "EXAMPLE\Domain Admins" SeMachineAccountPrivilege \ SePrintOperatorPrivilege SeAddUsersPrivilege SeDiskOperatorPrivilege \ SeRemoteShutdownPrivilege</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Dovrebbe ora essere possibile unire i client Windows al dominio come in un dominio NT4 in esecuzione su un server Windows.</p>

        </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-bdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Controller di dominio di backup</h2></div>
<div class="region"><div class="contents">
<p class="para">Con la presenza di un controller di dominio primario (PDC) all'interno delle rete è utile avere anche un controller di dominio di backup (BDC). In questo modo i client potranno autenticarsi anche nel caso in cui il PDC non sia più disponibile.</p>
<p class="para">Quando si configura Samba come BDC, è necessario avere un metodo di sincronizzazione delle informazioni sugli account con il PDC. A questo scopo è possibile usare <span class="app application">scp</span>, <span class="app application">rsync</span> oppure <span class="app application">LDAP</span> come backend <span class="em emphasis">passdb</span>.</p>
<p class="para">Il metodo migliore per sincronizzare le informazioni sugli account consiste nell'usare LDAP, poiché entrambi i controller di dominio possono usare le stesse informazioni in tempo reale. Configurare un server LDAP potrebbe essere troppo complicato per un esiguo numero di utenti e computer. Per maggiori informazioni, consultare <a class="xref" href="samba-ldap.html" title="Samba e LDAP">Samba e LDAP</a>.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
   
          <p class="para">
          First, install <span class="app application">samba</span> and <span class="app application">libpam-winbind</span>.  From a terminal enter:
          </p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install samba libpam-winbind</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Modificare il file <span class="file filename">/etc/samba/smb.conf</span> e togliere il commento a quanto segue nella sezione <span class="em emphasis">[global]</span>:</p>

<div class="code"><pre class="contents ">   workgroup = ESEMPIO
   ...
   security = user
</pre></div>

        </li>
<li class="steps">

        <p class="para">Nella sezione <span class="em emphasis">Domains</span> togliere il commento o aggiungere quanto segue:</p>

<div class="code"><pre class="contents ">   domain logons = yes
   domain master = no
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Assicurarsi che un utente abbia i permessi di lettura sui file in <span class="file filename">/var/lib/samba</span>. Per esempio, per consentire agli utenti del gruppo <span class="em emphasis">admin</span> di eseguire <span class="app application">scp</span> sui file, digitare:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo chgrp -R admin /var/lib/samba</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Sincronizzare gli account utente usando <span class="app application">scp</span> per copiare la directory <span class="file filename">/var/lib/samba</span> dal PDC:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo scp -r NOME_UTENTE@PDC:/var/lib/samba /var/lib</span>
</pre></div>

          <div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Sostituire <span class="em emphasis">NOME_UTENTE</span> con un nome utente valido e <span class="em emphasis">PDC</span> con il nome host o l'indirizzo IP del controller di dominio primario.</p>
          </div></div></div></div>

        </li>
<li class="steps">
          
          <p class="para">Riavviare <span class="app application">samba</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>

        </li>
</ol></div></div>
<p class="para">È possibile verificare se il controller di dominio di backup è funzionante fermando il demone Samba sul PDC e quindi cercando di eseguire l'accesso su un client Windows all'interno del dominio.</p>
<p class="para">È utile ricordare anche che se è stata configurata l'opzione <span class="em emphasis">logon home</span> come directory sul PDC e quest'ultimo non è più disponibile, anche l'accesso al drive <span class="em emphasis">home</span> degli utenti non lo sarà. Per questo motivo è utile configurare <span class="em emphasis">logon home</span> affinché sia posizionato in un server di file separato da PDC e BDC.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-dc-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Risorse</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Per delle configurazioni più dettagliate riguardo Samba, consultare <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Samba HOWTO Collection</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">La guida è disponibile anche in <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">formato cartaceo</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il libro <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> di O'Reilly è un'altra buona lettura.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html">capitolo 4</a> della «Samba HOWTO Collection» spiega come configurare un controller di dominio primario.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il <a href="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html" class="ulink" title="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html">capitolo 5</a> della «Samba HOWTO Collection» spiega come configurare un controller di dominio di backup.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">La pagina <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">su Samba</a> della documentazione.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Proteggere server di file e di stampa">Indietro</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Integrazione con Active Directory">Avanti</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
