<!DOCTYPE html>
<html lang=uk>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>As a Domain Controller</title>
<link rel="stylesheet" type="text/css" href="uk.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Настанова користувача Ubuntu Сервер">Настанова користувача Ubuntu Сервер</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Securing File and Print Server">Назад</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Active Directory Integration">Далі</a>
</div>
<div class="hgroup"><h1 class="title">As a Domain Controller</h1></div>
<div class="region">
<div class="contents"><p class="para">Хоча Samba не може працювати у режимі основного контролера домену (Primary Domain Controller або PDC) Active Directory, сервер Samba можна налаштувати на роботу у режимі контролера домену у стилі Windows NT4. Основною перевагою такого налаштування є можливість централізованого керування реєстраційними даними користувачів і комп’ютерів. Крім того, у Samba передбачено можливість використання декількох серверів зберігання відомостей щодо користувачів.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-dc.html#samba-pdc-smbpasswd" title="Основний контролер домену">Основний контролер домену</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-bdc-smbpasswd" title="Резервний контролер домену">Резервний контролер домену</a></li>
<li class="links"><a class="xref" href="samba-dc.html#samba-dc-resources" title="Ресурси">Ресурси</a></li>
</ul></div>
<div class="sect2 sect" id="samba-pdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Основний контролер домену</h2></div>
<div class="region"><div class="contents">
<p class="para">У цьому розділі наведено настанови з налаштування Samba на роботу у режимі основного контролера домену (Primary Domain Controller або PDC) з використанням типового сервера smbpasswd.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">

          <p class="para">
          First, install Samba, and <span class="app application">libpam-winbind</span> to sync the user accounts,
          by entering the following in a terminal prompt:
          </p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install samba libpam-winbind</span>
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Далі, налаштуйте Samba внесенням змін до файла <span class="file filename">/etc/samba/smb.conf</span>. Режим <span class="em emphasis">захисту (security)</span> слід встановити у значення <span class="em emphasis">user</span>, а <span class="em emphasis">workgroup</span> має відповідати вашій установі:</p>

<div class="code"><pre class="contents ">   workgroup = EXAMPLE
   ...
   security = user
</pre></div>

        </li>
<li class="steps">

          <p class="para">
          In the commented <span class="quote">«Domains»</span> section add or uncomment the following (the last line has been split to fit the format of this document):
          </p>

<div class="code"><pre class="contents ">   domain logons = yes
   logon path = \\%N\%U\profile
   logon drive = H:
   logon home = \\%N\%U
   logon script = logon.cmd
   add machine script = sudo /usr/sbin/useradd -N -g machines -c Machine -d
         /var/lib/samba -s /bin/false %u
</pre></div>

          <div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Якщо <span class="em emphasis">Roaming Profiles</span> (профілі роумінгу) не буде використано, не вилучайте позначок коментування з рядків <span class="em emphasis">logon home</span> і <span class="em emphasis">logon path</span>.</p>
          </div></div></div></div>
 
          <div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">domain logons:</span> забезпечує роботу служби netlogon, що надає змогу Samba працювати у режимі контролера домену.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon path:</span> розташовує профіль користувача Windows до домашнього каталогу користувача. Крім того, можна налаштувати спільний ресурс <span class="em emphasis">[profiles]</span> для зберігання всіх профілів у одному каталозі.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon drive:</span> визначає локальний шлях до домашнього каталогу.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon home:</span> визначає адресу домашнього каталогу.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">logon script:</span> визначає скрипт, який буде виконано локально після входу користувача до системи. Скрипт має зберігатися на спільному ресурсі <span class="em emphasis">[netlogon]</span>.</p>
            </li>
<li class="list itemizedlist">
              <p class="para"><span class="em emphasis">add machine script:</span> скрипт, який автоматично створюватиме <span class="em emphasis">Machine Trust Account</span> (обліковий запис довіри до машини), потрібний для долучення робочої станції до домену.</p>
              <p class="para">У нашому прикладі групу <span class="em emphasis">machines</span> слід буде створити за допомогою команди <span class="app application">addgroup</span> Докладніше про це у розділі <a class="xref" href="user-management.html#adding-deleting-users" title="Adding and Deleting Users">Adding and Deleting Users</a>.</p>

            </li>
</ul></div>

        </li>
<li class="steps">
     
          <p class="para">Вилучіть позначку коментаря з пункту спільного ресурсу <span class="em emphasis">[homes]</span>, щоб надати серверу змогу створювати каталоги <span class="em emphasis">входу до системи</span>:</p>

<div class="code"><pre class="contents ">[homes]
   comment = Home Directories
   browseable = no
   read only = no
   create mask = 0700
   directory mask = 0700
   valid users = %S
</pre></div>

        </li>
<li class="steps">

          <p class="para">Якщо комп’ютер налаштовано на роботу у режимі контролера домену, лід налаштувати спільний ресурс <span class="em emphasis">[netlogon]</span>. Щоб увімкнути цей спільний ресурс, вилучіть позначку коментування з рядків:</p>

<div class="code"><pre class="contents ">[netlogon]
comment = Network Logon Service
path = /srv/samba/netlogon
guest ok = yes
read only = yes
share modes = no
</pre></div>

          <div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Початковою адресою спільного ресурсу <span class="em emphasis">netlogon</span> є <span class="file filename">/home/samba/netlogon</span>, але відповідно до стандарту ієрархії файлових систем (Filesystem Hierarchy Standard або FHS), правильним місцем для зберігання специфічних даних, що надаються системою, є <a href="http://www.pathname.com/fhs/pub/fhs-2.3.%20html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM" class="ulink" title="http://www.pathname.com/fhs/pub/fhs-2.3. html#SRVDATAFORSERVICESPROVIDEDBYSYSTEM">/srv</a>.</p>
          </div></div></div></div>

        </li>
<li class="steps">

          <p class="para">Тепер створіть каталог <span class="file filename">netlogon</span> і порожній (поки що) файл скрипту <span class="file filename">logon.cmd</span>:</p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo mkdir -p /srv/samba/netlogon</span>
<span class="cmd command">sudo touch /srv/samba/netlogon/logon.cmd</span>
</pre></div>
 
          <p class="para">У файлі <span class="file filename">logon.cmd</span> можна вказати будь-які звичайні команди скриптів входу Windows для налаштування клієнтського середовища.</p>

        </li>
<li class="steps">

          <p class="para">
          Restart Samba to enable the new domain controller:
          </p> 

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">
          Lastly, there are a few additional commands needed to setup the appropriate rights.
          </p>

          <p class="para">За умови, що у системі типово вимкнено групу <span class="em emphasis">root</span>, щоб долучити робочу станцію до домену, системну групу має бути відображено на групу Windows <span class="em emphasis">Domain Admins</span>. Скористаємося програмою <span class="app application">net</span> у вікні термінала:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo net groupmap add ntgroup="Domain Admins" unixgroup=sysadmin rid=512 type=d</span>
</pre></div>

          <div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Змініть <span class="em emphasis">sysadmin</span> на потрібну вам групу Користувач, який долучатиметься до домену, має бути учасником групи <span class="em emphasis">sysadmin</span>, а також учасником системної групи <span class="em emphasis">admin</span>. Учасникам групи <span class="em emphasis">admin</span> можна використовувати команду <span class="app application">sudo</span>.</p>
            <p class="para">
            If the user does not have Samba credentials yet, you can add them with
            the <span class="app application">smbpasswd</span> utility, change the <span class="em emphasis">sysadmin</span> username appropriately:

<div class="screen"><pre class="contents "><span class="cmd command">sudo smbpasswd -a sysadmin</span>
</pre></div>
            </p>
          </div></div></div></div>

          <p class="para">
          Also, rights need to be explicitly provided to the <span class="em emphasis">Domain Admins</span> group to allow the 
          <span class="em emphasis">add machine script</span> (and other admin functions) to work. This is achieved by executing:
          </p>
<div class="screen"><pre class="contents "><span class="cmd command">net rpc rights grant -U sysadmin "EXAMPLE\Domain Admins" SeMachineAccountPrivilege \
SePrintOperatorPrivilege SeAddUsersPrivilege SeDiskOperatorPrivilege \
SeRemoteShutdownPrivilege</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Тепер можна долучати клієнтські комп’ютери під керуванням Windows до домену, подібно до того, які ці комп’ютери долучаються до домену NT4 під керуванням сервера Windows.</p>

        </li>
</ol></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-bdc-smbpasswd"><div class="inner">
<div class="hgroup"><h2 class="title">Резервний контролер домену</h2></div>
<div class="region"><div class="contents">
<p class="para">Якщо у мережі є основний контролер домену (Primary Domain Controller або PDC), варто також створити резервний контролер домену (Backup Domain Controller або BDC). Створення такого контролера надасть змогу клієнтським комп’ютерам проходити розпізнавання, якщо PDC виявиться недоступним.</p>
<p class="para">Для налаштування Samba на роботу у режимі резервного контролера домену слід забезпечити синхронізацію даних щодо облікових записів з основним контролером домену (PDC). Виконати це завдання можна у декілька способів, зокрема з використанням <span class="app application">scp</span>, <span class="app application">rsync</span> або використанням <span class="app application">LDAP</span> у режимі <span class="em emphasis">сервера passdb</span>.</p>
<p class="para">Використання LDAP є найнадійнішим способом синхронізації даних щодо облікових записів, оскільки у такому режимі обидва контролери домену можуть одночасно користуватися даними у режимі реального часу Втім, налаштування сервера LDAP може виявитися занадто складним завданням, якщо вам потрібно обслуговувати незначну кількість облікових записів користувачів та комп’ютерів Докладніше про налаштування можна дізнатися зі сторінки Samba <a class="xref" href="samba-ldap.html" title="Samba and LDAP">Samba and LDAP</a>.</p>
<div class="steps"><div class="inner"><ol class="steps">
<li class="steps">
   
          <p class="para">
          First, install <span class="app application">samba</span> and <span class="app application">libpam-winbind</span>.  From a terminal enter:
          </p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install samba libpam-winbind</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Відкрийте у вікні текстового редактора файл <span class="file filename">/etc/samba/smb.conf</span> і вилучіть позначку коментаря з таких рядків у розділі <span class="em emphasis">[global]</span>:</p>

<div class="code"><pre class="contents ">   workgroup = EXAMPLE
   ...
   security = user
</pre></div>

        </li>
<li class="steps">

        <p class="para">У закоментованому розділі <span class="em emphasis">Domains</span> вилучіть позначку коментування з рядків або додайте рядки:</p>

<div class="code"><pre class="contents ">   domain logons = yes
   domain master = no
</pre></div>
        
        </li>
<li class="steps">

          <p class="para">Не забудьте надати користувачеві права на читання файлів у каталозі <span class="file filename">/var/lib/samba</span>. Наприклад, щоб дозволити користувачам з групи <span class="em emphasis">admin</span> виконувати команду <span class="app application">scp</span> над файлами, введіть таку команду:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo chgrp -R admin /var/lib/samba</span>
</pre></div>

        </li>
<li class="steps">

          <p class="para">Далі, синхронізуйте облікові записи користувачів за допомогою <span class="app application">scp</span> для копіювання каталогу <span class="file filename">/var/lib/samba</span> з основного контролера домену (PDC):</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo scp -r username@pdc:/var/lib/samba /var/lib</span>
</pre></div>

          <div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
            <p class="para">Замініть <span class="em emphasis">username</span> на коректне ім’я користувача, а <span class="em emphasis">pdc</span> — на назву вузла або IP-адресу основного контролера домену (PDC).</p>
          </div></div></div></div>

        </li>
<li class="steps">
          
          <p class="para">Нарешті, перезапустіть <span class="app application">samba</span>:</p>

<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>

        </li>
</ol></div></div>
<p class="para">Перевірте працездатність резервного контролера домену зупинкою фонової служби Samba на основному контролері домену (PDC) з наступною спробою увійти до клієнтського комп’ютера під керуванням Windows, долученого до домену.</p>
<p class="para">Якщо було налаштовано параметр <span class="em emphasis">logon home</span> на каталог на основному контролері домену, а зв’язок з основним контролером домену буде перервано, доступ до диска користувача <span class="em emphasis">Домівка</span> також буде закрито. З цієї причини, найкраще вказувати для <span class="em emphasis">logon home</span> каталог на окремому файловому сервері, на якому не працює основний чи резервний контролер домену.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-dc-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Ресурси</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Докладніше про налаштування Samba можна дізнатися з <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">збірки порад з Samba</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Крім того, з підручником можна ознайомитися у <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">паперовому форматі</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Ще одним чудовим підручником є <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Використання Samba</a> видавництва O'Reilly.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-pdc.html">Главу 4</a> збірки настанов з Samba присвячено налаштуванню основного контролера домену.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html" class="ulink" title="http://us3.samba.org/samba/docs/man/Samba-HOWTO-Collection/samba-bdc.html">Главу 5</a> збірки настанов з Samba присвячено налаштуванню резервного контролера домену.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          The <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Ubuntu Wiki Samba </a> page.
          </p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-fileprint-security.html" title="Securing File and Print Server">Назад</a><a class="nextlinks-next" href="samba-ad-integration.html" title="Active Directory Integration">Далі</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
