<!DOCTYPE html>
<html lang=fr>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Sécurisation du serveur de fichiers et d'impression</title>
<link rel="stylesheet" type="text/css" href="fr.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="http://www.ubuntu.com/partners">Partners</a></li>
<li><a href="http://www.ubuntu.com/support">Support</a></li>
<li><a href="http://www.ubuntu.com/community">Community</a></li>
<li><a href="http://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="http://community.ubuntu.com/contribute/documentation/">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Guide du serveur Ubuntu">Guide du serveur Ubuntu</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Serveur d'impression">Précédent</a><a class="nextlinks-next" href="samba-dc.html" title="En tant que contrôleur de domaine">Suivant</a>
</div>
<div class="hgroup"><h1 class="title">Sécurisation du serveur de fichiers et d'impression</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Profils de sécurité de Samba">Profils de sécurité de Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Security = User">Security = User</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Sécurité des Partages">Sécurité des Partages</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Profil AppArmor pour Samba">Profil AppArmor pour Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Ressources">Ressources</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Profils de sécurité de Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Les deux niveaux de sécurité disponibles pour le protocole réseau CIFS (Common Internet Filesystem) sont <span class="em emphasis">user-level</span> et <span class="em emphasis">share-level</span>. La mise en œuvre des <span class="em emphasis">options de sécurité</span> de Samba permet plus de flexibilité en fournissant quatre possibilités de sécurité au niveau de l'utilisateur plus une au niveau du partage :</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">
          <span class="em emphasis">security = user:</span> requires clients to supply a username and password to connect to shares. 
          Samba user accounts are separate from system accounts, but the <span class="app application">libpam-winbind</span> 
          package will sync system users and passwords with the Samba user database.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = domain:</span> permet au serveur Samba d'apparaître aux clients Windows comme un contrôleur principal de domaine (PDC : Primary Domain Controller), un contrôleur de domaines de sauvegarde (BDC : Backup Domain Controller) ou un serveur membre du domaine (DMS : Domain Member Server). Consultez <a class="xref" href="samba-dc.html" title="En tant que contrôleur de domaine">En tant que contrôleur de domaine</a> pour plus d'informations.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = ADS:</span> permet au serveur Samba de joindre un domaine Active Directory. Consultez <a class="xref" href="samba-ad-integration.html" title="Integration Active Directory">Integration Active Directory</a> pour plus de détails.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = server:</span> est une option qui date de l'époque où Samba ne pouvait pas devenir un serveur membre et ne devait pas être utilisé en raison de plusieurs problèmes de sécurité. Consultez la section <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.html#id349531">sécurité du serveur (en)</a> du guide Samba pour plus de détails.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security= share :</span> permet aux clients de se connecter aux partages sans fournir de nom d'utilisateur ni de mot de passe.</p>
        </li>
</ul></div>
<p class="para">Le choix du mode de sécurité dépendra de votre environnement et de ce que vous attendez de votre serveur Samba.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Security = User</h2></div>
<div class="region"><div class="contents">
<p class="para">Cette section permet de reconfigurer le serveur de fichiers et d'impression Samba défini dans <a class="xref" href="samba-fileserver.html" title="Serveur de fichiers">Serveur de fichiers</a> et dans <a class="xref" href="samba-printserver.html" title="Serveur d'impression">Serveur d'impression</a> de façon à imposer une identification.</p>
<p class="para">
      First, install the <span class="app application">libpam-winbind</span> package which will sync the system users to the Samba
      user database:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install libpam-winbind</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">
        If you chose the <span class="em emphasis">Samba Server</span> task during installation <span class="app application">libpam-winbind</span>
        is already installed.
        </p>
      </div></div></div></div>
<p class="para">Modifiez la section <span class="em emphasis">[share]</span> du fichier <span class="file filename">/etc/samba/smb.conf</span> :</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Pour terminer, redémarrez Samba afin que les nouveaux paramètres soient pris en compte :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>
<p class="para">Vous devrez désormais fournir un nom d'utilisateur et un mot de passe quand vous vous connecterez à un dossier ou une imprimante partagée.</p>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Si vous connectez un lecteur réseau au dossier partagé, vous pouvez cocher la case <span class="quote">« Reconnecter au démarrage »</span>. Vous n'aurez alors à saisir le nom d'utilisateur et le mot de passe qu'une seule fois, du moins jusqu'au changement de mot de passe.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Sécurité des Partages</h2></div>
<div class="region">
<div class="contents"><p class="para">Plusieurs options sont disponibles pour accroître la sécurité de chaque dossier partagé. En utilisant l'exemple <span class="em emphasis">[share]</span>, cette section couvre les options les plus fréquentes.</p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Groupes</h3></div>
<div class="region"><div class="contents">
<p class="para">Les Groupes définissent un ensemble d'ordinateurs ou d'utilisateurs qui ont un niveau d'accès commun à des ressources réseau particulières, et offrent une certaine granularité dans le contrôle d'accès à de telles ressources. Par exemple, si un groupe <span class="em emphasis">qa</span> est défini et contient les utilisateurs <span class="em emphasis">freda</span>, <span class="em emphasis">danika</span>, et <span class="em emphasis">rob</span>, et un second groupe <span class="em emphasis">support</span> est défini et contient les utilisateurs <span class="em emphasis">danika</span>, <span class="em emphasis">jeremy</span> et <span class="em emphasis">vincent</span>, alors les ressources réseau configurées pour autoriser l'accès au groupe <span class="em emphasis">qa</span> seront accessibles à freda, danika et rob, mais pas à jeremy ou à vincent. Comme l'utilisateur <span class="em emphasis">danika</span> appartient aux deux groupes <span class="em emphasis">qa</span> et <span class="em emphasis">support</span>, elle aura accès aux ressources configurées comme accessibles par les deux groupes, tandis que tous les autres utilisateurs n'auront accès qu'aux ressources autorisant explicitement le groupe dont ils font partie.</p>
<p class="para">Par défaut, Samba inspecte les groupes système locaux définis dans <span class="file filename">/etc/group</span> pour déterminer quels utilisateurs appartiennent à quels groupes. Pour de plus amples informations sur l'ajout et la suppression des utilisateurs dans les groupes, consultez <a class="xref" href="user-management.html#adding-deleting-users" title="Ajout et suppression d'utilisateurs">Ajout et suppression d'utilisateurs</a>.</p>
<p class="para">Pour définir un groupe dans le fichier de configuration de Samba, <span class="file filename">/etc/samba/smb.conf</span>, vous devez le préfacer avec le symbole « @ ». Par exemple, si vous souhaitez définir un groupe nommé <span class="em emphasis">sysadmin</span> dans une section spécifique de <span class="file filename">/etc/samba/smb.conf</span>, vous devrez saisir <span class="em em-bold emphasis">@sysadmin</span>.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Droits d'accès aux fichiers</h3></div>
<div class="region"><div class="contents">
<p class="para">Les permissions sur les fichiers définissent précisément les droits d'un ordinateur ou d'un utilisateur sur un dossier particulier, un fichier ou un groupe de fichiers. De telles permissions peuvent être définies en modifiant le fichier <span class="file filename">/etc/samba/smb.conf</span> et en précisant les permissions sur un dossier partagé.</p>
<p class="para">Par exemple, si vous avez défini un partage Samba appelé <span class="em emphasis">share</span> et que vous souhaitez donner des droits en <span class="em emphasis">lecture seule</span> à un groupe appelé <span class="em emphasis">qa</span>, ainsi que des droits en écriture au groupe <span class="em emphasis">sysadmin</span> et à l'utilisateur <span class="em emphasis">vincent</span>, vous devez modifier le fichier <span class="file filename">/etc/samba/smb.conf</span> et ajouter les lignes suivantes dans la section <span class="em emphasis">[share]</span> :</p>
<div class="code"><pre class="contents ">    read list = @qa
    write list = @sysadmin, vincent
</pre></div>
<p class="para">Un autre type de permissions dans Samba consiste à donner des permissions <span class="em emphasis">administratives</span> sur une ressource partagée spécifique. Les utilisateurs ayant des permissions administratives sur une ressource peuvent lire, écrire ou modifier toutes les informations contenues dans celle-ci.</p>
<p class="para">Par exemple, si vous voulez donner à l'utilisateur <span class="em emphasis">melissa</span> des permissions administratives sur le partage <span class="em emphasis">share</span>, vous devez modifier le fichier <span class="file filename">/etc/samba/smb.conf</span> et ajouter les lignes suivantes à la section <span class="em emphasis">[share]</span> :</p>
<div class="code"><pre class="contents ">    admin users = melissa
</pre></div>
<p class="para">Après avoir modifié<span class="file filename">/etc/samba/smb.conf</span>, redémarrez Samba pour que les nouveaux paramètres soient pris en compte :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Pour que <span class="em emphasis">read list</span> et <span class="em emphasis">write list</span> fonctionnent, le mode de sécurité de Samba <span class="em emphasis">ne doit pas</span>  être réglé sur <span class="em emphasis">security = share</span></p>
        </div></div></div></div>
<p class="para">Maintenant que Samba a été configuré pour définir quels groupes ont accès au répertoire partagé, les permissions du système de fichier doivent être mises à jour.</p>
<p class="para">Les permissions de fichiers traditionnelles de Linux ne correspondent pas exactement aux listes de contrôle d'accès (ACL) de Windows NT. Heureusement, les ACL POSIX sont disponibles sur les serveurs Ubuntu, permettant un contrôle plus fin des droits. Par exemple, pour activer les ACL sur un système de fichiers EXT3 <span class="file filename">/srv</span>, il faut éditer le fichier <span class="file filename">/etc/fstab</span> et ajouter l'option <span class="em emphasis">acl</span> :</p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv  ext3    noatime,relatime,acl 0       1
</pre></div>
<p class="para">Puis remontez la partition :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
          <p class="para">L'exemple ci-dessus suppose que <span class="file filename">/srv</span> est monté sur une partition dédiée. Si <span class="file filename">/srv</span>, ou tout autre endroit où vous auriez configuré votre répertoire partagé, appartient à la partition <span class="file filename">/</span>, un redémarrage de la machine pourrait être nécessaire.</p>
        </div></div></div></div>
<p class="para">Conformément à la configuration Samba ci-dessus, le groupe <span class="em emphasis">sysadmin</span> aura les droits en lecture, écriture et exécution sur <span class="file filename">/srv/samba/share</span>, le groupe <span class="em emphasis">qa</span> aura les droits en lecture et exécution, et les fichiers auront pour propriétaire l'utilisateur <span class="em emphasis">melissa</span>. Saisissez dans un terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R melissa /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
          <p class="para">La commande <span class="app application">setfacl</span> ci-dessus donne les droits <span class="em emphasis">execute</span> à tous les fichiers du répertoire <span class="file filename">/srv/samba/share</span>, que vous pouvez désirer ou non.</p>
        </div></div></div></div>
<p class="para">Maintenant, à partir d'un client Windows, vous devriez remarquer la mise en œuvre des nouvelles  permissions sur les fichiers. Consultez  les pages de manuel <span class="app application">acl</span> et <span class="app application">setfacl</span> pour plus d'informations sur la gestion des ACLs POSIX.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Profil AppArmor pour Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Ubuntu est fourni avec le module de sécurité <span class="app application">AppArmor</span>, qui prévoit des contrôles d'accès obligatoires. Le profil par défaut d'AppArmor pour Samba doit être adapté à votre configuration. Pour plus de détails sur AppArmor voir <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.</p>
<p class="para">Il existe des profils par défaut pour les démons Samba <span class="file filename">/usr/sbin/smbd</span> et <span class="file filename">/usr/sbin/nmbd</span>. Ces profils font partie du paquet <span class="app application">apparmor-profiles</span>. Pour installer ce paquet, saisissez ceci dans un terminal :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Ce paquet contient des profils pour plusieurs autres exécutables.</p>
      </div></div></div></div>
<p class="para">Par défaut les profils pour <span class="app application">smbd</span> et <span class="app application">nmbd</span> sont dans le mode <span class="em emphasis">complain</span> pour permettre à Samba de travailler sans modifier le profil et de journaliser les erreurs seulement. Pour placer le profil <span class="app application">smbd</span> dans le mode <span class="em emphasis">enforce</span> et ainsi faire fonctionner Samba comme prévu, le profil doit être modifié de façon à tenir compte de tous les répertoires partagés.</p>
<p class="para">Modifiez <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> en ajoutant les informations dans <span class="em emphasis">[share]</span> à partir de l'exemple du serveur de fichiers :</p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
  /srv/samba/share/** rwkix,
</pre></div>
<p class="para">Maintenant, placez le profil dans <span class="em emphasis">enforce</span> et rechargez-le :</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">Vous devriez pouvoir lire, écrire et exécuter les fichiers dans le dossier partagé et l'exécutable <span class="app application">smbd</span> n'aura accès qu'aux fichiers et dossiers configurés. Assurez vous d'avoir ajouté une entrée pour chaque dossier que vous voulez partager avec Samba. Quoi qu'il en soit, toutes les erreurs seront écrites dans le fichier journal <span class="file filename">/var/log/syslog</span>.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Ressources</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Pour des configurations plus élaborées de Samba, consultez les <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">guides pratiques Samba (en)</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Ce guide est également disponible en <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">format papier</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Le manuel O'Reilly <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Using Samba</a> (en anglais) est aussi une bonne référence.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Le <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html">chapitre 18</a> (en anglais) de la collection HOWTO de  Samba est dédié à la sécurité.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Pour plus d'informations sur Samba et sur les ACLs, consultez la page <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568">Samba ACLs</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Page du <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Wiki Ubuntu consacrée à Samba</a>.</p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Serveur d'impression">Précédent</a><a class="nextlinks-next" href="samba-dc.html" title="En tant que contrôleur de domaine">Suivant</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
