<!DOCTYPE html>
<html lang=uk>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Securing File and Print Server</title>
<link rel="stylesheet" type="text/css" href="uk.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../16.04" class="trail">Ubuntu 16.04</a> » <a class="trail" href="index.html" title="Настанова користувача Ubuntu Сервер">Настанова користувача Ubuntu Сервер</a> » <a class="trail" href="samba.html" title="Samba">Samba</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Сервер друку">Назад</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Далі</a>
</div>
<div class="hgroup"><h1 class="title">Securing File and Print Server</h1></div>
<div class="region">
<div class="contents"></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-mode" title="Режими захисту Samba">Режими захисту Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-user-security" title="Security = User">Security = User</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-share-security" title="Захист спільних ресурсів">Захист спільних ресурсів</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-apparmor" title="Профіль AppArmor Samba">Профіль AppArmor Samba</a></li>
<li class="links"><a class="xref" href="samba-fileprint-security.html#samba-security-resources" title="Ресурси">Ресурси</a></li>
</ul></div>
<div class="sect2 sect" id="samba-security-mode"><div class="inner">
<div class="hgroup"><h2 class="title">Режими захисту Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Існує два рівні захисту мережевого протоколу Common Internet Filesystem (CIFS): <span class="em emphasis">на рівні користувача</span> і <span class="em emphasis">на рівні ресурсу</span>. Реалізація <span class="em emphasis">режиму захисту</span> Samba є більш гнучкою: передбачено чотири способи реалізації захисту на рівні користувача і один спосіб реалізувати захист на рівні ресурсу:</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">
          <span class="em emphasis">security = user:</span> requires clients to supply a username and password to connect to shares. 
          Samba user accounts are separate from system accounts, but the <span class="app application">libpam-winbind</span> 
          package will sync system users and passwords with the Samba user database.
          </p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = domain:</span> за допомогою цього режиму можна зробити сервер Samba для клієнтських комп’ютерів Windows основним контролером домену (Primary Domain Controller або PDC), резервним контролером домену (Backup Domain Controller і BDC) або сервером учасників домену (Domain Member Server або DMS). Докладніше про це у розділі <a class="xref" href="samba-dc.html" title="As a Domain Controller">As a Domain Controller</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = ADS:</span> дозволяє серверу Samba долучатися до домену Active Directory як звичайному учаснику. Докладніше про це у розділі <a class="xref" href="samba-ad-integration.html" title="Active Directory Integration">Active Directory Integration</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = server:</span> цей режим залишився від часів, коли Samba не могла ставати учасником сервера, через проблеми з безпекою цим режимом не слід користуватися. Докладніше про це у розділі <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType.%20html#id349531" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/ServerType. html#id349531">Захист сервера</a> підручника з Samba.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><span class="em emphasis">security = share:</span> надає змогу клієнтським комп’ютерам встановлювати з’єднання зі спільними ресурсами без використання імені користувача і пароля.</p>
        </li>
</ul></div>
<p class="para">Кращий режим захисту залежить від середовища та завдань, які має виконувати сервер Samba.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-user-security"><div class="inner">
<div class="hgroup"><h2 class="title">Security = User</h2></div>
<div class="region"><div class="contents">
<p class="para">За допомогою цього розділу можна повторно налаштувати сервер роботи з файлами та принтерами Samba з <a class="xref" href="samba-fileserver.html" title="File Server">File Server</a> і <a class="xref" href="samba-printserver.html" title="Сервер друку">Сервер друку</a> на використання режиму розпізнавання.</p>
<p class="para">
      First, install the <span class="app application">libpam-winbind</span> package which will sync the system users to the Samba
      user database:
      </p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install libpam-winbind</span>
</pre></div>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
        <p class="para">
        If you chose the <span class="em emphasis">Samba Server</span> task during installation <span class="app application">libpam-winbind</span>
        is already installed.
        </p>
      </div></div></div></div>
<p class="para">Внесіть зміни до розділу <span class="em emphasis">[share]</span> файла <span class="file filename">/etc/samba/smb.conf</span>:</p>
<div class="code"><pre class="contents ">    guest ok = no
</pre></div>
<p class="para">Нарешті, перезапустіть Samba, щоб нові параметри набули чинності:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>
<p class="para">Тепер під час встановлення з’єднання з каталогами або принтерами спільного використання буде показано запит щодо імені користувача і пароля.</p>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Щоб відобразити вміст мережевого диска на спільний ресурс, слід позначити пункт «Повторно встановлювати з’єднання при вході». У разі позначення пункту система надсилатиме запит щодо імені користувача і пароля лише раз, принаймні до зміни пароля.</p>
      </div></div></div></div>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-share-security"><div class="inner">
<div class="hgroup"><h2 class="title">Захист спільних ресурсів</h2></div>
<div class="region">
<div class="contents"><p class="para">Передбачено декілька варіантів покращення захисту окремих каталогів спільного використання. За допомогою прикладу <span class="em emphasis">[share]</span> у цьому розділі висвітлено декілька загальних варіантів.</p></div>
<div class="sect3 sect" id="windows-networking-groups"><div class="inner">
<div class="hgroup"><h3 class="title">Групи</h3></div>
<div class="region"><div class="contents">
<p class="para">Групи визначають збірки комп’ютерів або користувачів з однаковим рівнем доступу до певних мережевих ресурсів, а також визначають рівень деталізації у керуванні доступу і визначає рівень деталізації у керуванні доступом до таких ресурсів. Наприклад, якщо визначено групу <span class="em emphasis">qa</span>, що містить користувачів <span class="em emphasis">freda</span>, <span class="em emphasis">danika</span> і <span class="em emphasis">rob</span>, і іншу групу <span class="em emphasis">support</span>, що містить користувачів <span class="em emphasis">danika</span>, <span class="em emphasis">jeremy</span> і <span class="em emphasis">vincent</span>, потім налаштовано певні мережеві ресурси на доступ для групи <span class="em emphasis">qa</span>, доступ буде надано користувачам freda, danika і rob, але не користувачам jeremy і vincent. Оскільки користувач <span class="em emphasis">danika</span> належить до обох груп, <span class="em emphasis">qa</span> і <span class="em emphasis">support</span>, він зможе отримати доступ до ресурсів, налаштованих на доступ до обох груп, а інші користувачі матимуть доступ лише до ресурсів, до яких явним чином надано доступ групі, учасником якої є ці користувачі.</p>
<p class="para">Типово, Samba шукає локальні групи системи, визначені у <span class="file filename">/etc/group</span> для розподілу користувачів за групами. Докладніші відомості щодо додавання та вилучення користувачів з груп можна знайти у розділі <a class="xref" href="user-management.html#adding-deleting-users" title="Adding and Deleting Users">Adding and Deleting Users</a>.</p>
<p class="para">Під час визначення груп у файлі налаштувань Samba, <span class="file filename">/etc/samba/smb.conf</span>, для кращого сприйняття слід додавати перед назвою групи символ «@». Наприклад, щоб визначити групу з назвою <span class="em emphasis">sysadmin</span> у певному розділі файла <span class="file filename">/etc/samba/smb.conf</span>, слід додати запис <span class="em em-bold emphasis">@sysadmin</span>.</p>
</div></div>
</div></div>
<div class="sect3 sect" id="samba-file-permissions"><div class="inner">
<div class="hgroup"><h3 class="title">Права доступу до файлів</h3></div>
<div class="region"><div class="contents">
<p class="para">Права доступу явно визначають права певного комп’ютера або користувача на виконання дій з каталогом, файлом або набором файлів. Такі права доступу можна визначити за допомогою редагування файла <span class="file filename">/etc/samba/smb.conf</span> з визначенням явних прав доступу до визначеного спільного файлового ресурсу.</p>
<p class="para">
        For example, if you have defined a Samba share called <span class="em emphasis">share</span> and wish to give 
        <span class="em emphasis">read-only</span> permissions to the group of users known as 
        <span class="em emphasis">qa</span>, but wanted to allow writing to the share by the group called 
        <span class="em emphasis">sysadmin</span> and the user named <span class="em emphasis">vincent</span>, 
        then you could edit the <span class="file filename">/etc/samba/smb.conf</span> file, and add the following entries under 
        the <span class="em emphasis">[share]</span> entry:
        </p>
<div class="code"><pre class="contents ">    read list = @qa
    write list = @sysadmin, vincent
</pre></div>
<p class="para">Ще однією можливістю задання прав доступу у Samba є визначення <span class="em emphasis">адміністративних</span> прав доступу до певного спільного ресурсу. Користувачі з адміністративними правами доступу можуть читати, писати та вносити зміни до будь-яких даних ресурсу, де користувачеві було надано явні адміністративні права доступу.</p>
<p class="para">Наприклад, щоб надати користувачеві <span class="em emphasis">melissa</span> адміністративних прав доступу до <span class="em emphasis">спільного ресурсу</span>, слід внести зміни до файла <span class="file filename">/etc/samba/smb.conf</span>, а саме, додати такий рядок у розділ <span class="em emphasis">[share]</span>:</p>
<div class="code"><pre class="contents ">    admin users = melissa
</pre></div>
<p class="para">Після внесення змін до <span class="file filename">/etc/samba/smb.conf</span> перезапустіть Samba, щоб зміни набули чинності:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo systemctl restart smbd.service nmbd.service</span>
</pre></div>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Щоб мати змогу працювати з <span class="em emphasis">read list</span> і <span class="em emphasis">write list</span>, режим захисту Samba <span class="em emphasis">не</span> слід встановлювати у значення <span class="em emphasis">security = share</span></p>
        </div></div></div></div>
<p class="para">Тепер, коли Samba налаштовано на обмеження переліку груп користувачів, які мають доступ до спільного каталогу, слід оновити права доступу до файлової системи.</p>
<p class="para">Традиційні права доступу до файлів Linux не дуже то і збігаються з списками керування доступом (ACL) Windows NT. На щастя на серверах з <span class="phrase">Ubuntu</span> можна скористатися ACL POSIX. За допомогою цих списків керування доступом можна здійснювати дуже точне керування. Для прикладу, щоб увімкнути ACL на <span class="file filename">/srv</span> з файловою системою EXT3, внесіть зміни до файла <span class="file filename">/etc/fstab</span>, а саме, додайте параметр <span class="em emphasis">acl</span>:</p>
<div class="code"><pre class="contents ">UUID=66bcdd2e-8861-4fb0-b7e4-e61c569fe17d /srv  ext3    noatime,relatime,acl 0       1
</pre></div>
<p class="para">Після цього повторно змонтуйте розділ:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo mount -v -o remount /srv</span>
</pre></div>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
          <p class="para">У наведеному вище прикладі припускалося, що каталог <span class="file filename">/srv</span> зберігається на окремому розділі. Якщо є <span class="file filename">/srv</span> або будь-який інший каталог, налаштування якого виконується, є частиною розділу <span class="file filename">/</span>, може знадобитися перезавантаження системи.</p>
        </div></div></div></div>
<p class="para">Відповідно до вказаних вище налаштувань Samba, групі <span class="em emphasis">sysadmin</span> буде надано права доступу на читання, запис та виконання файлів ресурсу <span class="file filename">/srv/samba/share</span>, групі <span class="em emphasis">qa</span> буде надано права на читання та виконання, а самі файли належатимуть користувачеві <span class="em emphasis">melissa</span>. Введіть у вікні термінала:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo chown -R melissa /srv/samba/share/</span>
<span class="cmd command">sudo chgrp -R sysadmin /srv/samba/share/</span>
<span class="cmd command">sudo setfacl -R -m g:qa:rx /srv/samba/share/</span>
</pre></div>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
          <p class="para">Наведена вище команда <span class="app application">setfacl</span> надає права на <span class="em emphasis">виконання</span> всіх файлів у каталозі <span class="file filename">/srv/samba/share</span>, що може бути бажаним або небажаним результатом.</p>
        </div></div></div></div>
<p class="para">За допомогою клієнтського комп’ютера Windows можна буде переконатися, що до файлів застосовано нові права доступу. Докладніше про ACL у POSIX можна дізнатися зі сторінок довідника (man) <span class="app application">acl</span> та <span class="app application">setfacl</span>.</p>
</div></div>
</div></div>
</div>
</div></div>
<div class="sect2 sect" id="samba-apparmor"><div class="inner">
<div class="hgroup"><h2 class="title">Профіль AppArmor Samba</h2></div>
<div class="region"><div class="contents">
<p class="para">Частиною <span class="phrase">Ubuntu</span> є модуль безпеки <span class="app application">AppArmor</span>, який забезпечує роботу обов’язкового керування доступом. У типовий профіль AppArmor для Samba слід внести зміни, що відповідають іншим налаштуванням. Докладніше з AppArmor можна ознайомитися за допомогою відповідної <a class="xref" href="apparmor.html" title="AppArmor">AppArmor</a>.</p>
<p class="para">У типовому комплекті AppArmor передбачено профілі для <span class="file filename">/usr/sbin/smbd</span> і <span class="file filename">/usr/sbin/nmbd</span>, виконуваних файлів фонових служб Samba. Ці профілі є частиною пакунка <span class="app application">apparmor-profiles</span>. Щоб встановити цей пакунок, віддайте таку команду у вікні термінала:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo apt install apparmor-profiles apparmor-utils</span>
</pre></div>
<div class="note" title="Примітка"><div class="inner"><div class="region"><div class="contents">
        <p class="para">У цьому пакунку містяться профілі для декількох інших виконуваних файлів.</p>
      </div></div></div></div>
<p class="para">За типових налаштувань профілі для <span class="app application">smbd</span> і <span class="app application">nmbd</span> працюють у режимі <span class="em emphasis">complain</span>. У такому режимі Samba може працювати без внесення змін до профілю, всі помилки лише записуватимуться до журналу. Щоб перевести профіль <span class="app application">smbd</span> у режим <span class="em emphasis">enforce</span> так, щоб це не вплинуло на працездатність Samba, слід зазначити у профілі всіх каталоги, які надаються у спільне використання.</p>
<p class="para">Внесіть зміни до <span class="file filename">/etc/apparmor.d/usr.sbin.smbd</span> додаванням відомостей до розділу <span class="em emphasis">[share]</span> з прикладу для сервера спільного доступу до файлів:</p>
<div class="code"><pre class="contents ">  /srv/samba/share/ r,
/srv/samba/share/** rwkix,
</pre></div>
<p class="para">Тепер скопіюйте профіль до <span class="em emphasis">enforce</span> і перезавантажте його:</p>
<div class="screen"><pre class="contents "><span class="cmd command">sudo aa-enforce /usr/sbin/smbd</span>
<span class="cmd command">cat /etc/apparmor.d/usr.sbin.smbd | sudo apparmor_parser -r</span>
</pre></div>
<p class="para">Тепер можна читати, записувати та виконувати файли у каталозі спільного використання у звичайному режимі, а виконуваний файл <span class="app application">smbd</span> матиме доступ лише до вказаних вами файлів та каталогів. Не забудьте вказати всі каталоги, які має надати у спільне використання Samba. Всі повідомлення про помилки записуватимуться до файла <span class="file filename">/var/log/syslog</span>.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="samba-security-resources"><div class="inner">
<div class="hgroup"><h2 class="title">Ресурси</h2></div>
<div class="region"><div class="contents"><div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">Докладніше про налаштування Samba можна дізнатися з <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">збірки порад з Samba</a></p>
        </li>
<li class="list itemizedlist">
          <p class="para">Крім того, з підручником можна ознайомитися у <a href="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228" class="ulink" title="http://www.amazon.com/exec/obidos/tg/detail/-/0131882228">паперовому форматі</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Ще одним чудовим підручником є <a href="http://www.oreilly.com/catalog/9780596007690/" class="ulink" title="http://www.oreilly.com/catalog/9780596007690/">Використання Samba</a> видавництва O'Reilly.</p>
        </li>
<li class="list itemizedlist">
          <p class="para"><a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/securing-samba.html">Главу 18</a> збірки настанов з Samba HOWTO присвячено питанням безпеки.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Щоб дізнатися більше про Samba і ACL, ознайомтеся зі <a href="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568" class="ulink" title="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/AccessControls.html#id397568">сторінкою ACL Samba</a>.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">
          The <a href="https://help.ubuntu.com/community/Samba" class="ulink" title="https://help.ubuntu.com/community/Samba">Ubuntu Wiki Samba </a> page.
          </p>
        </li>
</ul></div></div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="samba-printserver.html" title="Сервер друку">Назад</a><a class="nextlinks-next" href="samba-dc.html" title="As a Domain Controller">Далі</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer"><p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p></div>
</div>
</body>
</html>
