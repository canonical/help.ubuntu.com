<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>5.1. Booting the Installer on 32-bit hard-float ARMv7</title>
<link rel="stylesheet" type="text/css" href="install.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Ubuntu Installation Guide">
<link rel="up" href="ch05.html" title="Chapter 5. Booting the Installation System">
<link rel="prev" href="ch05.html" title="Chapter 5. Booting the Installation System">
<link rel="next" href="ch05s02.html" title="5.2. Accessibility">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">5.1. Booting the Installer on <span class="phrase">32-bit hard-float ARMv7</span>
</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch05.html"><img src="images/prev.png" alt="Prev"></a> </td>
<th width="60%" align="center">Chapter 5. Booting the Installation System</th>
<td width="20%" align="right"> <a accesskey="n" href="ch05s02.html"><img src="images/next.png" alt="Next"></a>
</td>
</tr>
</table>
<hr>
</div>
<div class="sect1">
<div class="titlepage"><div><div><h2 class="title">
<a name="idm45797065146480"></a>5.1. Booting the Installer on <span class="phrase">32-bit hard-float ARMv7</span>
</h2></div></div></div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="boot-image-formats"></a>5.1.1. Boot image formats</h3></div></div></div>
<p>
      On ARM-based systems in most cases one of two formats for boot images
      is used: a) standard Linux zImage-format kernels
      (<span class="quote">“<span class="quote">vmlinuz</span>”</span>) in conjunction with standard Linux initial
      ramdisks (<span class="quote">“<span class="quote">initrd.gz</span>”</span>) or b) uImage-format kernels
      (<span class="quote">“<span class="quote">uImage</span>”</span>) in conjunction with corresponding initial
      ramdisks (<span class="quote">“<span class="quote">uInitrd</span>”</span>).
    </p>
<p>
      uImage/uInitrd are image formats designed for the U-Boot firmware that
      is used on many ARM-based systems (mostly 32-bit ones). Older U-Boot versions can only
      boot files in uImage/uInitrd format, so these are often used on
      older armel systems. Newer U-Boot versions can - besides booting
      uImages/uInitrds - also boot standard Linux kernels and ramdisk images,
      but the command syntax to do that is slightly different from that
      for booting uImages.
    </p>
<p>
      For systems using a multiplatform kernel, besides kernel and initial
      ramdisk a so-called device-tree file (or device-tree blob,
      <span class="quote">“<span class="quote">dtb</span>”</span>) is needed. It is specific to each supported system
      and contains a description of the particular hardware. The dtb
      should be supplied on the device by the firmware, but in practice a
      newer one often needs to be loaded.
    </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="armhf-console-setup"></a>5.1.2. Console configuration</h3></div></div></div>
<p>
      The images use
      the (platform-specific) default console that is defined by
      U-Boot in the <span class="quote">“<span class="quote">console</span>”</span> variable.  In most cases
      that is a serial console, so on those platforms you by default
      need a serial console cable to use the installer.
    </p>
<p>
      On platforms which also support a video console, you can modify the
      U-Boot <span class="quote">“<span class="quote">console</span>”</span> variable accordingly if you would like
      the installer to start on the video console.
    </p>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="boot-tftp"></a>5.1.3. Booting by TFTP</h3></div></div></div>
<p>

Booting from the network requires that you have a network
connection and a TFTP network boot server (and probably also a
DHCP, RARP, or BOOTP server for automatic network configuration).

</p>
<p>

The server-side setup to support network booting is described in <a class="xref" href="ch04s03.html" title="4.3. Preparing Files for TFTP Net Booting">Section 4.3, “Preparing Files for TFTP Net Booting”</a>.

</p>
<div class="sect3">
<div class="titlepage"><div><div><h4 class="title">
<a name="boot-tftp-uboot"></a>5.1.3.1. TFTP-booting in U-Boot</h4></div></div></div>
<p>
        Network booting on systems using the U-Boot firmware consists of
        three steps: a) configuring the network, b) loading the images
        (kernel/initial ramdisk/dtb) into memory and c) actually executing
        the previosly loaded code.
      </p>
<p>
        First you have to configure the network, either automatically via
        DHCP by running
</p>
<div class="informalexample"><pre class="screen">
setenv autoload no
dhcp
</pre></div>
<p>
        or manually by setting several environment variables
</p>
<div class="informalexample"><pre class="screen">
setenv ipaddr &lt;ip address of the client&gt;
setenv netmask &lt;netmask&gt;
setenv serverip &lt;ip address of the tftp server&gt;
setenv dnsip &lt;ip address of the nameserver&gt;
setenv gatewayip &lt;ip address of the default gateway&gt;
</pre></div>
<p>
        If you prefer, you can make these settings permanent by running
</p>
<div class="informalexample"><pre class="screen">
saveenv
</pre></div>
<p>
      </p>
<p>
        Afterwards you need to load the images (kernel/initial
        ramdisk/dtb) into memory. This is done with the tftpboot command,
        which has to be provided with the address at which the image
        shall be stored in memory. Unfortunately the memory map can vary
        from system to system, so there is no general rule which addresses
        can be used for this.                           
      </p>
<p>
        On some systems, U-Boot predefines a set of environment variables
        with suitable load addresses: kernel_addr_r, ramdisk_addr_r and
        fdt_addr_r. You can check whether they are defined by running
</p>
<div class="informalexample"><pre class="screen">
printenv kernel_addr_r ramdisk_addr_r fdt_addr_r
</pre></div>
<p>
        If they are not defined, you have to check your system's
        documentation for appropriate values and set them manually.  For
        systems based on Allwinner SunXi SOCs (e.g.  the Allwinner A10,
        architecture name <span class="quote">“<span class="quote">sun4i</span>”</span> or the Allwinner A20,
        architecture name <span class="quote">“<span class="quote">sun7i</span>”</span>), you can e.g.  use the
        follwing values:
</p>
<div class="informalexample"><pre class="screen">
setenv kernel_addr_r 0x46000000
setenv fdt_addr_r 0x47000000
setenv ramdisk_addr_r 0x48000000
</pre></div>
<p>
      </p>
<p>
        When the load addresses are defined, you can load the images
        into memory from the previously defined tftp server with
</p>
<div class="informalexample"><pre class="screen">
tftpboot ${kernel_addr_r} &lt;filename of the kernel image&gt;
tftpboot ${fdt_addr_r} &lt;filename of the dtb&gt;
tftpboot ${ramdisk_addr_r} &lt;filename of the initial ramdisk image&gt;
</pre></div>
<p>
      </p>
<p>
        The third part is setting the kernel commandline and actually
        executing the loaded code.  U-Boot passes the content of the
        <span class="quote">“<span class="quote">bootargs</span>”</span> environment variable as commandline to the
        kernel, so any parameters for the kernel and the installer - such as
        the console device (see <a class="xref" href="ch05s03.html#boot-console" title="5.3.1. Boot console">Section 5.3.1, “Boot console”</a>) or
        preseeding options (see <a class="xref" href="ch05s03.html#installer-args" title="5.3.2. Ubuntu Installer Parameters">Section 5.3.2, “Ubuntu Installer Parameters”</a> and <a class="xref" href="apb.html" title="Appendix B. Automating the installation using preseeding">Appendix B, <i>Automating the installation using preseeding</i></a>) - can be set with a command like
</p>
<div class="informalexample"><pre class="screen">
setenv bootargs console=ttyS0,115200 rootwait panic=10
</pre></div>
<p>
        The exact command to execute the previously loaded code depends on
        the image format used.  With uImage/uInitrd, the command is
</p>
<div class="informalexample"><pre class="screen">
bootm ${kernel_addr_r} ${ramdisk_addr_r} ${fdt_addr_r}
</pre></div>
<p>
       and with native Linux images it is
</p>
<div class="informalexample"><pre class="screen">
bootz ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr_r}
</pre></div>
<p>
      </p>
<p>
        Note: When booting standard linux images, it is important to load
        the initial ramdisk image after the kernel and the dtb as U-Boot
        sets the filesize variable to the size of the last file loaded and
        the bootz command requires the size of the ramdisk image to work
        correctly.  In case of booting a platform-specific kernel, i.e.  a
        kernel without device-tree, simply omit the ${fdt_addr_r} parameter. 
        </p>
</div>
</div>
<div class="sect2">
<div class="titlepage"><div><div><h3 class="title">
<a name="boot-hd-media"></a>5.1.4. Booting from a USB stick in U-Boot</h3></div></div></div>
<p>
    
      Many modern U-Boot versions have USB support and allow booting from
      USB mass storage devices such as USB sticks.  Unfortunately the exact
      steps required to do that can vary quite a bit from device to device.
      
    </p>
<p>
    
      U-Boot v2014.10 has introduced a common commandline handling and
      autoboot framework.  This allows building generic boot images that
      work on any system implementing this framework.  The <code class="classname">debian-installer</code> supports
      installation from a USB stick on such systems, but unfortunately not
      all platforms have adopted this new framework yet.

    </p>
<p>
      The autoboot framework in modern U-Boot versions works similar to the
      boot ordering options in a PC BIOS, i.e.  it checks a list of possible
      boot devices for a valid boot image and starts the first one it finds. 
      If there is no operating system installed, plugging in the USB stick
      and powering up the system should result in starting the installer. 
      You can also initiate the USB-boot process any time from the U-Boot
      prompt by entering the <span class="quote">“<span class="quote">run bootcmd_usb0</span>”</span> command.
    </p>
<p>
      One problem that can come up when booting from a USB stick while using
      a serial console can be a console baudrate mismatch.  If a console
      variable is defined in U-Boot, the <code class="classname">debian-installer</code> boot script automatically
      passes it to the kernel to set the primary console device and, if
      applicable, the console baudrate.  Unfortunately the handling of the
      console variable varies from platform to platform - on some platforms,
      the console variable includes the baudrate (as in
      <span class="quote">“<span class="quote">console=ttyS0,115200</span>”</span>), while on other platforms the
      console variable contains only the device (as in
      <span class="quote">“<span class="quote">console=ttyS0</span>”</span>).  The latter case leads to a garbled
      console output when the default baudrate differs between U-Boot and
      the kernel.  Modern U-Boot versions often use 115200 baud while the
      kernel still defaults to the traditional 9600 baud. If this happens,
      you should manually set the console variable to contain the correct
      baudrate for your system and then start the installer with the
      <span class="quote">“<span class="quote">run bootcmd_usb0</span>”</span> command.
    </p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch05.html"><img src="images/prev.png" alt="Prev"></a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch05.html"><img src="images/up.png" alt="Up"></a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch05s02.html"><img src="images/next.png" alt="Next"></a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 5. Booting the Installation System </td>
<td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td>
<td width="40%" align="right" valign="top"> 5.2. Accessibility</td>
</tr>
</table>
</div>
</body>
</html>
