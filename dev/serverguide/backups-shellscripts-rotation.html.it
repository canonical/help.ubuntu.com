<!DOCTYPE html>
<html lang=it>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Rotazione degli archivi</title>
<link rel="stylesheet" type="text/css" href="it.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body id="home">
<script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
        _uacct = "UA-1018242-8";
        urchinTracker();
      </script><script>
      function englishPageVersion() {
        var href = window.location.href;
        if (href.slice(-1) == "/") {
                window.location = "index.html.en";
        } else {
                window.location = href.replace(/\.html.*/, ".html.en");
        }
         return false;
      }
      function browserPreferredLanguage() {
        var href = window.location.href;
        if (href.slice(-1) == "/") {
                window.location = href;
        } else {
                window.location = href.replace(/\.html.*/, ".html");
        }
        return false;
      }
      </script><div id="container">
<div id="container-inner">
<div id="mothership"><ul>
<li><a href="https://partners.ubuntu.com">Partners</a></li>
<li><a href="https://www.ubuntu.com/support/community-support">Support</a></li>
<li><a href="https://community.ubuntu.com">Community</a></li>
<li><a href="https://www.ubuntu.com">Ubuntu.com</a></li>
</ul></div>
<div id="header">
<h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
<ul id="main-menu">
<li><a class="main-menu-item current" href="../../">Official Documentation</a></li>
<li><a href="https://help.ubuntu.com/community/CommunityHelpWiki">Community Help Wiki</a></li>
<li><a href="https://community.ubuntu.com/t/contribute/26">Contribute</a></li>
</ul>
</div>
<div id="menu-search"><div id="search-box">
<noscript><form action="https://www.google.com/cse" id="cse-search-box"><div>
<input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq"><input type="hidden" name="ie" value="UTF-8"><input type="text" name="q" size="21"><input type="submit" name="sa" value="Search">
</div></form></noscript>
<script>
                document.write('<form action="../../search.html" id="cse-search-box">');
                document.write('  <div>');
                document.write('    <input type="hidden" name="cof" value="FORID:9">');
                document.write('    <input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq">');
                document.write('    <input type="hidden" name="ie" value="UTF-8">');
                document.write('    <input type="text" name="q" size="21">');
                document.write('    <input type="submit" name="sa" value="Search">');
                document.write('  </div>');
                document.write('</form>');
              </script>
</div></div>
<div class="trails"><div class="trail">
<a href="../../18.04" class="trail">Ubuntu 18.04</a> » <a class="trail" href="index.html.it" title="Guida a Ubuntu Server">Guida a Ubuntu Server</a> » <a class="trail" href="backups.html.it" title="Backup">Backup</a> » </div></div>
<div id="cwt-content" class="clearfix content-area"><div id="page">
<div id="content">
<div class="links nextlinks">
<a class="nextlinks-prev" href="backup-shellscripts.html.it" title="Script shell">Indietro</a><a class="nextlinks-next" href="bacula.html.it" title="Bacula">Avanti</a>
</div>
<div class="hgroup"><h1 class="title">Rotazione degli archivi</h1></div>
<div class="region">
<div class="contents"><p class="para">Lo script in <a class="xref" href="backup-shellscripts.html.it" title="Script shell">Script shell</a> consente solamente sette archivi differenti. Per un server i cui dati non cambiano molto spesso, questo può essere sufficiente, ma se il server dispone di grossi quantitativi di dati, è necessario avere un più complesso schema di rotazione.</p></div>
<div class="links sectionlinks" role="navigation"><ul>
<li class="links"><a class="xref" href="backups-shellscripts-rotation.html.it#backups-nfs-rotation" title="Rotazione degli archivi NFS">Rotazione degli archivi NFS</a></li>
<li class="links"><a class="xref" href="backups-shellscripts-rotation.html.it#backup-shellscript-tapedrive" title="Dispositivi a nastro">Dispositivi a nastro</a></li>
</ul></div>
<div class="sect2 sect" id="backups-nfs-rotation"><div class="inner">
<div class="hgroup"><h2 class="title">Rotazione degli archivi NFS</h2></div>
<div class="region"><div class="contents">
<p class="para">In questa sezione, lo script verrà leggermente modificato per implementare uno schema di rotazione del tipo progenitore-genitore-figlio (mensile-settimanale-giornaliero):</p>
<div class="list itemizedlist"><ul class="list itemizedlist">
<li class="list itemizedlist">
          <p class="para">La rotazione eseguirà un backup <span class="em emphasis">giornaliero</span> dalla domenica al venerdì.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il sabato, viene eseguito un backup <span class="em emphasis">settimanale</span> consentendo di avere così quattro backup settimanali al mese.</p>
        </li>
<li class="list itemizedlist">
          <p class="para">Il backup <span class="em emphasis">mensile</span> è eseguito il primo giorno del mese, ruotando due backup mensili se il mese è pari o dispari.</p>
        </li>
</ul></div>
<p class="para">Questo è il nuovo script:</p>
<div class="code"><pre class="contents ">#!/bin/bash
####################################
#
# Backup to NFS mount script with
# grandfather-father-son rotation.
#
####################################

# What to backup. 
backup_files="/home /var/spool/mail /etc /root /boot /opt"

# Where to backup to.
dest="/mnt/backup"

# Setup variables for the archive filename.
day=$(date +%A)
hostname=$(hostname -s)

# Find which week of the month 1-4 it is.
day_num=$(date +%-d)
if (( $day_num &lt;= 7 )); then
        week_file="$hostname-week1.tgz"
elif (( $day_num &gt; 7 &amp;&amp; $day_num &lt;= 14 )); then
        week_file="$hostname-week2.tgz"
elif (( $day_num &gt; 14 &amp;&amp; $day_num &lt;= 21 )); then
        week_file="$hostname-week3.tgz"
elif (( $day_num &gt; 21 &amp;&amp; $day_num &lt; 32 )); then
        week_file="$hostname-week4.tgz"
fi

# Find if the Month is odd or even.
month_num=$(date +%m)
month=$(expr $month_num % 2)
if [ $month -eq 0 ]; then
        month_file="$hostname-month2.tgz"
else
        month_file="$hostname-month1.tgz"
fi

# Create archive filename.
if [ $day_num == 1 ]; then
	archive_file=$month_file
elif [ $day != "Saturday" ]; then
        archive_file="$hostname-$day.tgz"
else 
	archive_file=$week_file
fi

# Print start status message.
echo "Backing up $backup_files to $dest/$archive_file"
date
echo

# Backup the files using tar.
tar czf $dest/$archive_file $backup_files

# Print end status message.
echo
echo "Backup finished"
date

# Long listing of files in $dest to check file sizes.
ls -lh $dest/
</pre></div>
<p class="para">Lo script può essere eseguito attraverso gli stessi metodi descritti in <a class="xref" href="backup-shellscripts.html.it#backup-executing-shellscript" title="Eseguire lo script">Eseguire lo script</a>.</p>
<p class="para">È utile, nel caso si verifichino disastri, che il dispositivo di backup sia in una località diversa. Nello script di esempio l'unità di backup è un server che fornisce una condivisione NFS: spostare questo server in un'altra località potrebbe non essere fattibile. In base alla velocità di connessione, potrebbe essere utile considerare di copiare il file d'archivio attraverso un collegamento WAN su un server remoto.</p>
<p class="para">Un'altra opzione consiste nel copiare l'archivio su di un disco esterno che può essere spostato. Poiché il prezzo dei dischi portatili esterni è sempre in diminuzione, l'utilizzo di due dischi per ogni livello dell'archivio può risultare altamente vantaggioso: in questo modo è possibile avere un disco esterno collegato al server di backup e un altro in un'altra località.</p>
</div></div>
</div></div>
<div class="sect2 sect" id="backup-shellscript-tapedrive"><div class="inner">
<div class="hgroup"><h2 class="title">Dispositivi a nastro</h2></div>
<div class="region"><div class="contents">
<p class="para">Invece di usare una condivisione NFS, è possibile utilizzare un dispositivo a nastro collegato al server. Un dispositivo di questo tipo semplifica la rotazione degli archivi e lo spostamento dello stesso dispositivo in un'altra locazione.</p>
<p class="para">Quando viene usato un dispositivo a nastro, la parte dello script relativa al nome del file non è necessaria, in quanto il dato è inviato direttamente al dispositivo, ma sono necessari alcuni comandi per manipolare il nastro. Ciò viene effettuato usando <span class="app application">mt</span>, un'utilità di controllo di nastri magnetici parte del pacchetto <span class="app application">cpio</span>.</p>
<p class="para">Questo è lo script modificato per l'uso di un dispositivo a nastro:</p>
<div class="code"><pre class="contents ">#!/bin/bash
####################################
#
# Backup to tape drive script.
#
####################################

# What to backup. 
backup_files="/home /var/spool/mail /etc /root /boot /opt"

# Where to backup to.
dest="/dev/st0"

# Print start status message.
echo "Backing up $backup_files to $dest"
date
echo

# Make sure the tape is rewound.
mt -f $dest rewind

# Backup the files using tar.
tar czf $dest $backup_files

# Rewind and eject the tape.
mt -f $dest rewoffl

# Print end status message.
echo
echo "Backup finished"
date
</pre></div>
<div class="note" title="Annotazione"><div class="inner"><div class="region"><div class="contents">
        <p class="para">Il nome del device predefinito per un dispositivo a nastro SCSI è <span class="file filename">/dev/st0</span>, utilizzare il percorso al device appropriato per il proprio sistema.</p>
      </div></div></div></div>
<p class="para">Ripristinare i dati da un dispositivo a nastro funziona allo stesso modo di ripristinare da un file. Riavvolgere il nastro e usare il percorso del dispositivo al posto del percorso al file. Per esempio, per ripristinare il file <span class="file filename">/etc/hosts</span> in <span class="file filename">/tmp/etc/hosts</span>:</p>
<div class="screen"><pre class="contents "><span class="cmd command">mt -f /dev/st0 rewind</span>
<span class="cmd command">tar -xzf /dev/st0 -C /tmp etc/hosts</span>
</pre></div>
</div></div>
</div></div>
</div>
<div class="links nextlinks">
<a class="nextlinks-prev" href="backup-shellscripts.html.it" title="Script shell">Indietro</a><a class="nextlinks-next" href="bacula.html.it" title="Bacula">Avanti</a>
</div>
<div class="clear"></div>
</div>
<div id="pagebottom"></div>
</div></div>
</div>
<div id="footer">
<p style="padding-bottom: 0.4em">You can choose the <b>displayed language</b> by adding a language suffix to the web address
          so it ends with e.g. <tt>.html.en</tt> or <tt>.html.de</tt>.<br>
          If the web address has no language suffix, the preferred language specified in your web browser's settings is used. For your convenience:<br>
          [ <a title="English page version" href="#" onClick="englishPageVersion();">Change to English Language</a> | 
          <a title="Language selected by browser" href="#" onClick="browserPreferredLanguage()">Change to Browser's Preferred Language</a> ]</p>
<p>The material in this document is available under a free license, see <a href="../../legal.html">Legal</a> for details.<br>
          For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>.
          To report errors in this serverguide documentation, <a href="https://bugs.launchpad.net/serverguide">file a bug report</a>.</p>
</div>
</div>
</body>
</html>
